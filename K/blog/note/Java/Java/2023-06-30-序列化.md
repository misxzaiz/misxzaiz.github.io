# 序列化与Transient



## 一、Java序列化

Java序列化是指将对象转换为**字节流**的过程，以便在网络上进行传输或将其保存到文件中。序列化后的字节流可以在需要时被反序列化为原始对象。

1. 序列化的作用：序列化允许将Java对象转换为字节流，以便在网络上传输、存储到磁盘上或将对象持久化保存到数据库中。

2. 序列化的实现方法：Java中提供了Serializable接口和Externalizable接口来支持序列化。Serializable是一个**标记接口**，实现该接口的类即可进行序列化。Externalizable是一个继承自Serializable的接口，它提供了更灵活的控制序列化和反序列化过程的能力。

3. 序列化的步骤：要进行序列化，首先需要创建一个输出流（如ObjectOutputStream），然后将需要序列化的对象写入输出流中。输出流将对象转换为字节流。反序列化时，需要创建一个输入流（如ObjectInputStream），然后从输入流中读取字节流，并将其转换回原始对象。
4. 序列化的注意事项：
   - 需要序列化的类必须实现Serializable接口。
   - 静态字段和transient字段默认不会被序列化。
   - 序列化会将整个对象图进行序列化，因此如果对象包含引用其他对象的成员变量，那么这些对象也必须是可序列化的。
   - 序列化版本号（serialVersionUID）可以用于控制序列化和反序列化的兼容性，应该显式声明并保持一致。
5. 序列化的应用：
   - 通过序列化可以实现分布式系统中的对象传输和远程方法调用（RMI），从而在不同的Java虚拟机之间进行通信。
   - 可以使用序列化实现对象的深拷贝。
   - 序列化还可以用于缓存、会话管理等场景，将对象保存在持久化存储中以提高性能。

总的来说，Java序列化是一种将对象转换为字节流的机制，它在网络通信、对象持久化和远程方法调用等方面有着广泛的应用。但需要注意版本兼容性、字段选择和安全性等问题。

## 二、使用实例

在这个示例中，我们定义了一个名为Person的Java类，并实现了Serializable接口来支持序列化。Person类具有name、age和country三个属性，并重写了toString方法。

```java
import java.io.Serializable;

public class Person implements Serializable {
    // 自定义序列号版本，不使用JVM默认生成的序列号版本
    public static final long serialVersionUID = 42L;
    private String name;
    private int age = 0;
    // 使用 transient 就不参与序列化
    private transient String password;
    // 序列化会保存静态变量的初始值”cn2“
    static String country = "cn2";

    public Person(String name, int age, String password, String country) {
        this.name = name;
        this.age = age;
        this.password = password;
        this.country = country;
    }

    @Override
    public String toString() {
        return "Person{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", password=" + password +
                ", country='" + country + '\'' +
                '}';
    }
}
```

在ObjOutSer类中，我们将一个Person对象序列化并写入文件"D:/serTest.txt"中。首先创建一个File对象，然后创建一个FileOutputStream对象和一个ObjectOutputStream对象。然后使用oos.writeObject方法将Person对象写入输出流中，最后关闭输出流。

```java
import java.io.*;

public class ObjOutSer {
    public static void main(String[] args) throws Exception {
        File file = new File("D:/serTest.txt");
        ObjectOutputStream oos = null;
        OutputStream os = new FileOutputStream(file);
        oos = new ObjectOutputStream(os);
        oos.writeObject(new Person("Tom", 21, "1234", "cn1"));
        oos.close();
        os.close();
    }
}
```

在ObjInSer类中，我们从文件"D:/serTest.txt"中读取序列化的Person对象。同样，我们首先创建一个File对象，然后创建一个FileInputStream对象和一个ObjectInputStream对象。使用ois.readObject方法从输入流中读取对象，然后关闭输入流。最后，我们打印出读取到的对象。

```java
import java.io.*;

public class ObjInSer {
    public static void main(String[] args) throws Exception {
        File file = new File("D:/serTest.txt");
        ObjectInputStream ois = null;
        InputStream is = new FileInputStream(file);
        ois = new ObjectInputStream(is);
        Object obj = ois.readObject();
        ois.close();
        is.close();
        System.out.println(obj);
    }
}
```

结果：

被transient的password被设置为默认值null，同时静态变量country的值为初始值"cn2"

```
Person{name='Tom', age=21, password=null, country='cn2'}
```



## 三、序列化版本号

序列化的版本号在Java中扮演着重要的角色。可以通过 serialVersionUID 字段来指定序列化类的版本号，它是一个长整型常量。

下面是关于序列化版本号的总结：

1. 版本号的作用：序列化版本号用于标识序列化类的版本。当反序列化一个对象时，JVM会比较序列化对象的版本号与当前类的版本号是否一致，如果不一致则可能会抛出 InvalidClassException 异常。
2. 默认生成规则：如果未显式指定 serialVersionUID，JVM会根据类的结构自动生成一个版本号。这个自动生成的版本号基于类的名称、字段、方法和继承关系等。
3. 显式指定规则：可以通过在类中定义一个名为 serialVersionUID 的静态字段来显式地指定版本号。例如：`private static final long serialVersionUID = 42L;`。显式指定版本号的好处是可以确保在类结构发生变化时，版本号也会相应改变。
4. 版本号冲突解决：在进行对象的反序列化时，如果序列化对象的版本号与当前类的版本号不一致，可能会导致版本冲突。为了解决冲突，可以通过手动指定 serialVersionUID 或者使用特殊的序列化机制（如 Externalizable 接口）来处理。
5. 反序列化兼容性：在序列化类发生变化时，为了保持与旧版本对象的兼容性，应该遵循一些规则。例如，在类中新增字段时，可以使用 transient 关键字标记它们，并在读取对象后进行适当的处理。

通过正确管理版本号，可以确保序列化和反序列化操作的稳定性和兼容性，从而提高代码的可维护性和可扩展性。

## 四、Transient

transient 关键字在 Java 中用于修饰类的**成员变量**。

下面是关于 transient 关键字的总结：

1. 作用：transient 关键字用于指定某个成员变量**不参与对象的序列化过程**。被 transient 修饰的成员变量将被忽略，不会被保存到持久化存储中。
2. 序列化与反序列化：在将一个对象序列化为字节流时，transient 修饰的成员变量不会被包含在序列化数据中。而在从字节流**反序列化一个对象时，transient 修饰的成员变量会被赋予默认值**。
3. 默认值赋值规则：如果一个类中的成员变量被 transient 修饰，当对象被反序列化时，这些成员变量将被赋予以下默认值：
   - 对于基本数据类型：0、false、或者对应类型的默认值。
   - 对于引用类型：null。
4. 使用场景：transient 关键字常用于需要**保护敏感信息**的类中，比如密码字段、临时缓存字段等。通过将这些字段标记为 transient，在序列化和反序列化过程中避免将敏感信息泄露出去。
5. 特殊情况：当一个对象的类实现了 **Externalizable 接口**时，**transient 关键字无效**。因为 Externalizable 接口需要自定义序列化和反序列化过程，可以控制序列化和反序列化哪些字段。

总的来说，transient 关键字可以用来控制对象序列化的过程，通过忽略某些敏感字段或临时字段，提高数据安全性和灵活性。
