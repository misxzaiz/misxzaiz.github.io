<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的</title>
    <link rel="stylesheet" href="../../css/element.css" />
    <script src="../../js/vue@3.js"></script>
    <script src="../../js/element-plus.js"></script>
    <script src="../../js/axios.min.js"></script>
    <script src="../../index.js"></script>
    <script src="../../module/interfaceacting220819.js"></script>
    <script src="../../module/antidomxss_v640.js"></script>
    <script src="../module/footer.js"></script>
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../index.css">
    <style>

        .avatar {
            display: grid;
            place-items: center;
        }
        .time {
            font-size: 12px;
            color: #999;
        }

        .bottom {
            margin-top: 13px;
            line-height: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .button {
            padding: 0;
            min-height: auto;
        }

        .image {
            width: 100%;
            display: block;
        }

        .table {
            border-collapse: collapse;
            width: 100%;
        }

        .table th,
        .table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .table th {
            background-color: #f2f2f2;
        }

        .table-container {
            overflow-x: auto;
        }

        .table {
            border-collapse: collapse;
            width: 100%;
            white-space: nowrap;
        }

        .table th,
        .table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .table th {
            background-color: #f2f2f2;
        }
        input[type="file"] {
            color: transparent;
            background-color: transparent;
            border: none;
            cursor: pointer;
        }
        
    </style>
</head>
<body>
    <div id="app">
        <div>
            <el-button type="primary" class="home-button" @click="href('../../index.html')">主页</el-button>
        </div>
        
        <!-- <el-button @click="href('../login/login.html')">登录</el-button> -->
        <!-- <el-button @click="href('../login/register.html')">注册</el-button> -->
        <div style="margin: 5%;display: flex; justify-content: flex-end; align-items: center;">
            <div style="margin-right: 8px;" >
                <input type="file" @change="handleFileUpload"/>
            </div>

            <div style="margin-left: 0;">
                <el-button type="primary" @click="importList()">导入</el-button>
            </div>

        </div>

        <!-- <el-button type="primary" @click="exportList()">导出</el-button> -->
        <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>uid</th>
                  <th>username</th>
                  <th>phone</th>
                  <th>email</th>
                  <th>role</th>
                </tr>
              </thead>
              <tbody>
                    <tr v-for="(item, index) in List" :key="index">
                    <td>{{ item.uid }}</td>
                    <td>{{ item.username }}</td>
                    <td>{{ item.phone }}</td>
                    <td>{{ item.email }}</td>
        
                    <td v-if="item.roleId == 1">超级管理员</td>
                    <td v-else-if="item.roleId == 2">管理员</td>
                    <td v-else="item.roleId == 3">用户</td>
                  </tr>
                </tbody>
              </table>

              <!-- <td v-if="item.roleId == 1">超级管理员</td>
              <td v-else-if="item.roleId == 2">管理员</td>
              <td v-else="item.roleId == 3">用户</td> -->
            <!-- <el-row> -->

                <!-- <el-col :span="22" v-for="(item, index) in List" :key="item.id" style="margin: 2%;">
                    {{item}}
                </el-col> -->
            <!-- </el-row> -->
        </div>

        <!-- <foot-bar :active-btn="4"></foot-bar> -->
    </div>

    <script>
        console.log(reqUrl)
        const App = {
            data() {
                return {
                    file: null,
                    List: {},
                }
            },
            methods: {
                handleFileUpload(event) {
                    this.file = event.target.files[0]; // 获取上传的文件
                },
                importList() {
                    const formData = new FormData();
                    formData.append('file', this.file); // 将文件添加到 FormData 对象
                    axios.post('/web/user/import', formData, {
                        headers: {
                        'Content-Type': 'multipart/form-data' // 设置请求头，告诉服务器是多部分数据
                        }
                    })
                    .then(response => {
                        console.log(response.data); // 处理上传成功的响应
                    })
                    .catch(error => {
                        console.error(error); // 处理上传失败的错误
                    });
                    
                },
                exportList() {
                    let that = this;
                    axios.post("/web/user/export")
                        .then(res => {
                            this.$message.success(res.data.message);
                            sessionStorage.removeItem("token");
                            localStorage.removeItem("token")
                            localStorage.removeItem("userDto")
                        })
                        .catch(err => {
                            this.$message.error(err)
                        });
                },
                goBack() {
                    window.history.back();
                },
                href(url) {
                    window.location.href=url
                },
                getUserList() {
                    let that = this
                    axios.get("/web/user/list")
                        .then(res => {
                            that.List = res.data.data
                            this.$message.success(res.data.message)
                        })
                        .catch(err => {
                            console.log(err);
                            this.$message.error(err)
                        });
                },
            },
            mounted() {
                this.userDto = userDto
                this.getUserList()
                // this.getFileUserList()
            }
        };
        const app = Vue.createApp(App);
        app.use(ElementPlus);
        app.component('foot-bar', footBarComponent);
        app.mount("#app");
    </script>
</body>
</html>