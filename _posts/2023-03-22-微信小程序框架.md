---
layout:			post
title:			"微信小程序框架"
subtitle: 		"逻辑层、渲染层、flex布局"
author:			"XiaoZaiz"
header-style: 	text
catalog:      	true
tags:
    - 微信小程序
    - 框架

---

# 微信小程序框架

## 一、逻辑层

### 1.1 App(Object object) 注册程序

说明：`App` 的参数 `object` 是一个对象，使用`{}`包裹。

| Object 属性                                                  | 类型     |  说明    |  API  |
| ------------------------------------------------------------ | -------- | ---- | ------------------------------------------------------------ |
| onLaunch(Object object) | function | 生命周期回调——监听小程序初始化。<br />小程序初始化完成时触发，全局只触发一次。 | [wx.getLaunchOptionsSync](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/life-cycle/wx.getLaunchOptionsSync.html)() |
| onShow(Object object) | function | 生命周期回调——监听小程序启动或切前台。<br />小程序启动，或从后台进入前台显示时触发。 | [wx.onAppShow](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAppShow.html)() |
| onHide() | function | 生命周期回调——监听小程序切后台。<br />小程序从前台进入后台时触发。 | [wx.onAppHide](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAppHide.html)() |
| onError(String error) | function | 错误监听函数。<br />小程序发生脚本错误或 API 调用报错时触发。 | [wx.onError](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onError.html)() |
| onPageNotFound(Object object) | function | 页面不存在监听函数。<br />小程序要打开的页面不存在时触发。 | [wx.onPageNotFound](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onPageNotFound.html)() |
| onUnhandledRejection(Object object) | function | 未处理的 Promise 拒绝事件监听函数。<br />小程序有未处理的 Promise 拒绝时触发。 | [wx.onUnhandledRejection](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html) () |
| onThemeChange(Object object) | function | 监听系统主题变化。<br />系统切换主题时触发。 | [wx.onThemeChange](https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onThemeChange.html) () |
| globalData | Object | 自定义全局变量 |  |
| **其他自定义参数** | **Any** | 开发者可以添加任意的函数或数据变量到 `Object` 参数中，用 `this` 可以访问。 |  |

#### 

### 1.2 getApp()方法

说明：在小程序的其他`js`文件中均可以使用全局的`getApp()`方法获取小程序实例。

示例：`let app = getApp()`

### 1.3 Page(OBJECT)注册页面



| 属性                                                         | 类型         | 说明                                                         |
| :----------------------------------------------------------- | :----------- | :----------------------------------------------------------- |
| [data](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#data) | Object       | 页面的初始数据<br />`data` 是页面第一次渲染使用的**初始数据**。<br />页面加载时，`data` 将会以`JSON`字符串的形式由逻辑层传至渲染层，因此`data`中的数据必须是可以转成`JSON`的类型：字符串，数字，布尔值，对象，数组。 |
| options                                                      | Object       | 页面的组件选项，同 [`Component` 构造器](https://developers.weixin.qq.com/miniprogram/dev/api/xr-frame/classes/Component.html) 中的 `options` ，需要基础库版本 [2.10.1](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
| [behaviors](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/behaviors.html) | String Array | 类似于mixins和traits的组件间代码复用机制，参见 [behaviors](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/behaviors.html)，需要基础库版本 [2.9.2](https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html) |
#### 生命周期回调函数                                           
| 属性                                                         | 类型         | 说明                                                         |
| :----------------------------------------------------------- | :----------- | :----------------------------------------------------------- |
| [onLoad](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onLoad-Object-query) | function     | 生命周期回调—监听页面加载<br />**页面加载时触发。一个页面只会调用一次，可以在 onLoad 的参数中获取打开当前页面路径中的参数。** |
| [onShow](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShow) | function     | 生命周期回调—监听页面显示<br />页面显示/切入前台时触发。     |
| [onReady](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onReady) | function     | 生命周期回调—监听页面初次渲染完成<br />页面初次渲染完成时触发。一个页面只会调用一次，代表页面已经准备妥当，可以和视图层进行交互。<br />注意：对界面内容进行设置的 API 如[wx.setNavigationBarTitle](https://developers.weixin.qq.com/miniprogram/dev/api/ui/navigation-bar/wx.setNavigationBarTitle.html)，请在`onReady`之后进行。详见[生命周期](https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page-life-cycle.html) |
| [onHide](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onHide) | function     | 生命周期回调—监听页面隐藏<br />页面隐藏/切入后台时触发。 如 [wx.navigateTo](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html) 或底部 `tab` 切换到其他页面，小程序切入后台等。 |
| [onUnload](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onUnload) | function     | 生命周期回调—监听页面卸载<br />页面卸载时触发。如[wx.redirectTo](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.redirectTo.html)或[wx.navigateBack](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateBack.html)到其他页面时。 |
| [onRouteDone](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onRouteDone) | function     | 生命周期回调—监听路由动画完成<br />路由动画完成时触发。如 [wx.navigateTo](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html) 页面完全推入后 或 [wx.navigateBack](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateBack.html) 页面完全恢复时。 |
#### 页面事件处理函数
| 属性                                                         | 类型         | 说明                                                         |
| :----------------------------------------------------------- | :----------- | :----------------------------------------------------------- |
| [onPullDownRefresh](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onPullDownRefresh) | function     | 监听用户下拉动作<br />监听用户下拉刷新事件。<br />需要在`app.json`的[`window`](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#window)选项中或[页面配置](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)中开启`enablePullDownRefresh`。<br />可以通过[wx.startPullDownRefresh](https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.startPullDownRefresh.html)触发下拉刷新，调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。<br />当处理完数据刷新后，[wx.stopPullDownRefresh](https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.stopPullDownRefresh.html)可以停止当前页面的下拉刷新。 |
| [onReachBottom](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onReachBottom) | function     | 页面上拉触底事件的处理函数<br />监听用户上拉触底事件。<br />可以在`app.json`的[`window`](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#window)选项中或[页面配置](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html)中设置触发距离`onReachBottomDistance`。<br />在触发距离内滑动期间，本事件只会被触发一次。 |
| [onShareAppMessage](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareAppMessage-Object-object) | function     | 用户点击右上角转发<br />监听用户点击页面内转发按钮（[button](https://developers.weixin.qq.com/miniprogram/dev/component/button.html) 组件 `open-type="share"`）或右上角菜单“转发”按钮的行为，并自定义转发内容。<br />**注意：只有定义了此事件处理函数，右上角菜单才会显示“转发”按钮**<br />此事件处理函数需要 return 一个 Object，用于自定义转发内容 |
| [onShareTimeline](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onShareTimeline) | function     | 用户点击右上角转发到朋友圈<br />监听右上角菜单“分享到朋友圈”按钮的行为，并自定义分享内容。<br />**注意：只有定义了此事件处理函数，右上角菜单才会显示“分享到朋友圈”按钮**<br />事件处理函数返回一个 Object，用于自定义分享内容，不支持自定义页面路径 |
| [onAddToFavorites](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onAddToFavorites-Object-object) | function     | **自定义转发内容**用户点击右上角收藏<br />监听用户点击右上角菜单“收藏”按钮的行为，并自定义收藏内容。<br />此事件处理函数需要 return 一个 Object，用于自定义收藏内容。 |
| [onPageScroll](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onPageScroll-Object-object) | function     | 页面滚动触发事件的处理函数<br />监听用户滑动页面事件。<br />**注意：请只在需要的时候才在 page 中定义此方法，不要定义空方法。以减少不必要的事件派发对渲染层-逻辑层通信的影响。<br />** **注意：请避免在 onPageScroll 中过于频繁的执行 `setData` 等引起[逻辑层-渲染层通信](https://developers.weixin.qq.com/miniprogram/dev/framework/performance/tips.html)的操作。尤其是每次传输大量数据，会影响通信耗时。** |
| [onResize](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onResize-Object-object) | function     | 页面尺寸改变时触发，详见 [响应显示区域变化](https://developers.weixin.qq.com/miniprogram/dev/framework/view/resizable.html#在手机上启用屏幕旋转支持)<br />小程序屏幕旋转时触发。 |
| [onTabItemTap](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onTabItemTap-Object-object) | function     | 当前是 tab 页时，点击 tab 时触发                             |
| [onSaveExitState](https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onSaveExitState) | function     | 页面销毁前保留状态回调<br />每当小程序可能被销毁之前，页面回调函数 `onSaveExitState` 会被调用，可以进行[退出状态](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html#_4-退出状态)的保存。 |
#### 组件事件处理函数
`Page` 中还可以定义组件事件处理函数。在渲染层的组件中加入[事件绑定](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html)，当事件被触发时，就会执行 Page 中定义的事件处理函数。

| 属性                                                         | 类型         | 说明                                                         |
| :----------------------------------------------------------- | :----------- | :----------------------------------------------------------- |
| Page.route                                                   | String       | 到当前页面的路径                                             |
| Page.prototype.setData(Object data, Function callback)       |              | `setData` 函数用于将数据从逻辑层发送到视图层（异步），同时改变对应的 `this.data` 的值（同步）。 |
#### 其他
| 属性                                                         | 类型         | 说明                                                         |
| :----------------------------------------------------------- | :----------- | :----------------------------------------------------------- |
| 其他                                                         | any          | 开发者可以添加任意的函数或数据到 `Object` 参数中，在页面的函数中用 `this` 可以访问。**这部分属性会在页面实例创建时进行一次深拷贝**。 |
| 自定义页面变量                                               |              |                                                              |

### 1.4 页面间通信

如果一个页面由另一个页面通过 [`wx.navigateTo`](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html) 打开，这两个页面间将建立一条数据通道：

- 被打开的页面可以通过 `this.getOpenerEventChannel()` 方法来获得一个 `EventChannel` 对象；
- `wx.navigateTo` 的 `success` 回调中也包含一个 `EventChannel` 对象。

这两个 `EventChannel` 对象间可以使用 `emit` 和 `on` 方法相互发送、监听事件。

### 1.5 setData()

### 1.6 页面路由

