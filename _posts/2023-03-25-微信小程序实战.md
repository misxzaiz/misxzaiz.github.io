---
layout:			post
title:			"微信小程序实战"
subtitle: 		"前后端交互，文章展示系统"
author:			"XiaoZaiz"
header-style: 	text
catalog:      	true
tags:
    - 微信小程序
    - 前后端交互
    - Java
    - SpringBoot1
---

## 效果展示

![](img/in-post/miniprogram/2023-03-25-微信小程序实战/结果展示1 "图片title")
![](img/in-post/miniprogram/2023-03-25-微信小程序实战/结果展示2 "图片title")
![](img/in-post/miniprogram/2023-03-25-微信小程序实战/结果展示3 "图片title")
![](img/in-post/miniprogram/2023-03-25-微信小程序实战/结果展示4 "图片title")
![](img/in-post/miniprogram/2023-03-25-微信小程序实战/结果展示5 "图片title")

## 需求

### 1. 页面需求

#### 1.1 主页 (index)

- **搜索栏 (search-box)**：提供进入搜索页的入口
- **轮播图 (slideshow)**：用于文章内容的展示，提供进入相关内容页的入口
- **导航栏及内容 (navigation-bar)**：提供分类浏览功能，点击后展示相关文章列表

#### 1.2 内容页 (content)

- **文章标题 (article-title)**
- **文章作者 (article-author)**
- **发布时间（article-time）**
- **文章内容 (article-content)**

#### 1.3 搜索页 (search)

- **搜索框 (search-box)**：输入关键词能够实时筛选出匹配的文章列表
- **搜索结果展示 (search-results)**：用于展示根据关键词检索出来的文章列表，包括标题、概述及所属分类信息

### 2. 功能需求

- **点击跳转**：用户能够通过点击文章列表进入对应的文章详情页

## 实现流程

### 1. 新建页面（app.json)

```json
  "pages":[
    "pages/index/index",
    "pages/content/content",
    "pages/search/search"
  ]
```

### 2. 主页（index）

- **搜索栏 (search-box)**：提供进入搜索页的入口
- **轮播图 (slideshow)**：用于文章内容的展示，提供进入相关内容页的入口
- **导航栏及内容 (navigation-bar)**：提供分类浏览功能，点击后展示相关文章列表

#### 2.1 搜索栏 (search-box)

##### index.wxml

```html
<!--pages/index/index.wxml-->
<view class="search-box">
  <!-- Logo -->
  <image src="/image/XiaoZaiz.png" mode="widthFix"/>
  <!-- 搜索栏：跳转搜索页 -->
  <navigator url="/pages/search/search">
    <input type="text" placeholder="搜索" bindtap="onSearch"/>
  </navigator>
  <!-- 积分 -->
  <text>积分</text>
  <!-- 我的 -->
  <text>我的</text>
</view>
```

##### index.wxss

```css
/* 搜索栏（search-box） */
.search-box {
  display: flex;
  flex-wrap: nowrap;
  justify-content: space-between;
  align-items: center;
  height: 82rpx;
  background-color: rgb(255, 255, 255);
  border-bottom: 1rpx solid rgb(255, 255, 255);
  padding: 0 20rpx;
}

.search-box image {
  width: 20%;
}

.search-box input{
  flex: 1;
  height: 40rpx;
  border: 1rpx solid rgb(119, 119, 119);
  border-radius: 20rpx;
  margin-left: 10rpx;
  padding: 0 30rpx;
}

.search-box text {
  width: 20%;
  font-size: 24rpx;
  text-align: center;
}
```

#### 2.2 导航栏（navigation-bar）

##### app.js

设置全局变量

```js
// app.js
App({
  globalData: {
    // 获取文章信息api的前缀
    url: "http://8.130.73.113",
    // 导航栏标签的json数据的位置
    tagjsonurl: "https://misxzaiz.github.io/json/tag.json"
  }
})
```

##### index.js

```js
// pages/index/index.js
// 获取app实例
const app = getApp()
Page({
  data: {
    // 标签列表
    navList:[],
    // 当前标签
    tag: '最新'
  },
  // 当点击其他标签时，同步更新tag，用例作为判断条件，判断是否更新导航栏下面内容的显示
  onClick: function(e) {
    // item是在被监听的点击元素的data-*属性设置的
    let item = e.currentTarget.dataset.item;
    this.setData({
      tag: item
    })
  },
  // 生命周期函数
  onLoad() {
    // 初始化标签列表的数据
    wx.request({
      url: app.globalData.tagjsonurl,
      success: (res) => {
        this.setData({
          navList: res.data
        })
      }
    })
  }
})
```

##### index.wxml

```html
<!-- 导航栏及内容区（navigation-bar） -->
<scroll-view class="nav-bar" scroll-x="true">
  <!-- wx:for：渲染导航栏标签 -->
  <view wx:for="{{ navList }}" class="nav-item">
    <!-- bindtap：设置点击事件监听
    data-item：同步更新当前标签tag信息 -->
    <view bindtap="onClick" data-item="{{item}}">
      {{item}}
    </view>
  </view>
</scroll-view>
```

##### index.wxss

```css
/* 导航栏及内容区（navigation-bar） */
.nav-bar {
  height: 80rpx;
  line-height: 80rpx;
  white-space: nowrap; 
}
.nav-item {
  font-size: 32rpx;
  padding: 0 30rpx;
  line-height: 50rpx;
  color: #666;
  display: inline-flex;
}
```

#### 2.3 文章列表（articles-list）

##### index.wxml

```html
<!-- 文章信息列表articles-list -->
<view class="container">
  <scroll-view scroll-y="true">
    <block wx:for="{{articles}}" wx:key="index">
      <navigator url="{{ '/pages/content/content?id=' + item.id  }}">
        <view class="item">
          <view class="title">{{ item.title }}</view>
          <text style="padding-right: 20rpx;" class="text">{{ item.created_at }}</text>
          <text class="text">{{ item.author }}</text>
        </view>
      </navigator>
    </block>
  </scroll-view>
</view>
```

##### index.js

```js
// pages/index/index.js
const app = getApp()
Page({
  data: {
    navList:[],
    tag: '最新',
    articles: []
  },
  onClick: function(e) {
    let item = e.currentTarget.dataset.item;
    this.setData({
      tag: item
    })
    this.searchArticle()
  },
  onLoad() {
    wx.request({
      url: app.globalData.tagjsonurl,
      success: (res) => {
        this.setData({
          navList: res.data
        })
      }
    })
    this.searchArticle()
  },
  searchArticle: function() {
    let that = this;
    let URL = ''
    if(this.data.tag == '最新'){
      URL = app.globalData.url + '/article/allbutnocontent'
    }else{
      URL = app.globalData.url + '/article/articles/' + this.data.tag
    }
    wx.request({
      url: URL,
      success: function(res) {
        // 在响应成功后遍历返回的数据并处理时间
        res.data.forEach(function(item) {
          // 将时间字符串转换成Date对象
          var dateObj = new Date(item.created_at);
          // 从Date对象中获取月份和日期，并组装成新的字符串
          var monthDay = (dateObj.getMonth() + 1).toString().padStart(2, '0') + '-' + dateObj.getDate().toString().padStart(2, '0');  
          // 将新的格式化后的日期重新赋值给数组对应的元素的time属性
          item.created_at = monthDay;
        });
        that.setData({
          articles: res.data
        });
      }
    })
  }
})
```

##### index.wxss

```css
.container {
  padding: 0 20rpx 20rpx 20rpx;
  background-color: #F9F9F9;
}
.item {
  margin-top: 20rpx;
  background-color: #FFFFFF;
  box-shadow: 2rpx 2rpx 5rpx rgba(200, 200, 200, 0.3);
  border-radius: 8rpx;
  padding: 20rpx;
  font-size: 28rpx;
  color: #333333;
  line-height: 40rpx;
}

.title {
  height: 80rpx;
  font-weight: bold;
  font-size: larger;
}
.text {
  color: rgb(92, 92, 92);
}
```

#### 2.4 轮播图 (slideshow)

##### index.wxml

```html
<!-- 轮播图 (slideshow)  -->
<div wx:if="{{ tag == '最新'}}">
  <swiper>
    <swiper-item>
      <!-- 点击会跳到相应的详情页 -->
      <navigator url="#">
        <!-- <image src="#" mode="scaleToFill" class="swiper_image"/> -->
        <view class="swiper_image" style="text-align: center;line-height: 300rpx;font-size: xx-large;font-weight: bolder;background-color: bisque;color: brown;">
          广告位招租！
        </view>
      </navigator>
    </swiper-item>
    <swiper-item>
      <navigator url="#">
        <!-- <image src="#" mode="scaleToFill" class="swiper_image"/> -->
        <view class="swiper_image" style="text-align: center;line-height: 300rpx;font-size: xx-large;font-weight: bolder;background-color: rgb(116, 206, 121);color: brown;">
          广告位招租！
        </view>
      </navigator>
    </swiper-item>
  </swiper>
</div>
```

##### index.wxss

```css
/* 轮播图 */
.swiper_image {
  height: 350rpx;
  width: 90%;
  padding: 0 5% 0 5%;
}
```

### 3. 内容页（content）

#### 3.1 内容页

##### content.wxml

```html
<!--pages/content/content.wxml-->
<view style="padding: 20rpx;">
  <view class="title">
    <text>{{ article.title }}</text>
  </view>
  <view style="color: rgb(151, 151, 151);height: 60rpx;">
    <text style="padding-right: 20rpx;">{{ article.created_at }}</text>
    <text>{{ article.author }}</text>
  </view>
  <view>
    <rich-text nodes="{{ article.content }}"></rich-text>
  </view>
</view>

```

##### content.js

```js
// pages/content/content.js
// 获取app实例
const app = getApp()
Page({
  /**
   * 页面的初始数据
   */
  data: {
    article: {}
  },
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad(options) {
    let that = this;
    wx.request({
      url: app.globalData.url + '/article/' + options.id,
      success: function(res){
        // 将时间字符串转换成Date对象
        let dateObj = new Date(res.data.created_at);
        // 从Date对象中获取月份和日期，并组装成新的字符串
        let monthDay = (dateObj.getMonth() + 1).toString().padStart(2, '0') + '-' + dateObj.getDate().toString().padStart(2, '0');
        // 将新的格式化后的日期重新赋值给数组对应的元素的time属性
        res.data.created_at = monthDay;
        that.setData({
          article: res.data
        })
      }
    })
  }
})
```

##### content.wxss

```css
/* pages/content/content.wxss */
.title {
  height: 150rpx;
  font-weight: bold;
  font-size: x-large;
}
.created_at {
  padding-right: 20rpx;
}
```

### 4. 搜索页（search）

#### 4.1 搜索页

##### search.wxml

```html
<!--pages/search/search.wxml-->
<view class="container">
  <input placeholder="请输入关键词" bindconfirm="searchArticle" class="input"/>
  <scroll-view scroll-y="true">
    <block wx:for="{{articles}}" wx:key="index">
      <navigator url="{{ '/pages/content/content?id=' + item.id  }}">
        <view class="item">
          <view class="title">{{ item.title }}</view>
          <text style="padding-right: 20rpx;" class="text">{{ item.created_at }}</text>
          <text class="text">{{ item.author }}</text>
        </view>
      </navigator>
    </block>
  </scroll-view>
</view>
```

##### search.js

```js
const app = getApp()
Page({
  data: {
    articles: []
  },
  searchArticle: function(e) {
    var that = this;
    wx.request({
      url: app.globalData.url + '/article/articles/' + e.detail.value,
      success: function(res) {
        // 在响应成功后遍历返回的数据并处理时间
        res.data.forEach(function(item) {
          // 将时间字符串转换成Date对象
          var dateObj = new Date(item.created_at);
          // 从Date对象中获取月份和日期，并组装成新的字符串
          var monthDay = (dateObj.getMonth() + 1).toString().padStart(2, '0') + '-' + dateObj.getDate().toString().padStart(2, '0');  
          // 将新的格式化后的日期重新赋值给数组对应的元素的time属性
          item.created_at = monthDay;
        });
        that.setData({
          articles: res.data
        });
      }
    })
  }
})
```

##### search.wxss

```css
/* pages/search/search.wxss */
.container {
  padding: 20rpx;
  background-color: #F9F9F9;
}

.input {
  width: 100%;
  height: 80rpx;
  border-radius: 10rpx;
  padding-left: 20rpx;
  font-size: 30rpx;
  border: none;
  background-color: #FFFFFF;
  box-shadow: 2rpx 2rpx 10rpx rgba(200, 200, 200, 0.3);
  outline: none;
}

.item {
  margin-top: 20rpx;
  background-color: #FFFFFF;
  box-shadow: 2rpx 2rpx 5rpx rgba(200, 200, 200, 0.3);
  border-radius: 8rpx;
  padding: 20rpx;
  font-size: 28rpx;
  color: #333333;
  line-height: 40rpx;
}

.title {
  height: 80rpx;
  font-weight: bold;
  font-size: larger;
}
.text {
  color: rgb(92, 92, 92);
}
```





