# 优惠卷

- Redis 全局唯一 id：优惠卷订单号，不是优惠卷 id ，是用户抢完卷后的得到的优惠卷订单号
- 下单时业务处理：
  - 是否在抢卷时间
  - 优惠卷数量是否充足

【基本】抢卷流程：

1. 提交优惠卷 id，用户 id 在 ThreadLocal 获取
2. 判断是否在抢卷时间
3. 判断优惠卷库存是否充足
4. 扣减库存
5. 创建优惠卷订单（包含用户、优惠卷等信息）

【超卖问题·版本号法】乐观锁：

1. 在扣减库存前判断版本号（库存）是否大于0，如果大于0，就使库存减1

【一人一单】

1. 判断用户是否已经抢到卷（优惠卷订单）
2. 初步（单体系统）：对用户加锁（避免高并发下一个用户抢到多张卷）
3. 改进（集群）：分布式锁



