import{_ as ge,r as ke,a as c,w as be,c as ae,b as r,o as u,d as e,e as C,f as S,v as O,n as g,g as V,F as Q,h as X,t as d,i as oe,u as Je,j as Ge,k as ne,l as Y,m as ye,p as se,q as Ye,s as Qe,x as Xe,y as Ze,z as fe}from"./index-DF37baOT.js";import{T as We}from"./TTSService-DyMlLgvk.js";import{V as et}from"./VoiceService-DKBGZCSk.js";const Se="/assets/default-avatar-BtFce_n2.png",tt={class:"settings-form"},st={class:"ai-generate-section"},at=["disabled"],lt={key:0,class:"loading-dots"},ot={key:0,class:"ai-warning"},nt={class:"form-section"},it={class:"form-group"},rt={class:"form-group"},ut={class:"avatar-selection"},ct={class:"custom-avatar-upload"},dt=["src"],vt={key:1,class:"no-avatar-placeholder"},pt={class:"avatar-actions"},mt={class:"upload-btn"},yt={class:"form-section"},ft={class:"personality-traits"},gt=["onClick"],kt={class:"form-section"},bt={class:"form-group"},St={class:"radio-group"},$t={class:"radio-label"},ht={class:"radio-label"},Ct={class:"radio-label"},_t={class:"form-group"},wt={class:"preview-section"},At={class:"preview-card"},It={class:"preview-avatar"},xt=["src"],Ft={class:"preview-info"},Tt={class:"preview-traits"},Mt={class:"preview-interests"},Vt={class:"preview-message"},Et={class:"message-bubble"},jt={class:"form-actions"},zt={key:0,class:"modal"},Rt={class:"modal-container"},Dt={class:"ai-generate-form"},Ut={class:"form-group"},qt={class:"ai-examples"},Bt=["onClick"],Pt={class:"form-actions"},Nt=["disabled"],Ot={__name:"AssistantSettingsForm",props:{initialSettings:{type:Object,default:()=>({name:"小爱",avatar:"",traits:["温柔","体贴","善解人意"],replyStyle:"sweet",interests:["看书","听音乐","旅行"]})}},emits:["save","cancel"],setup(ie,{emit:M}){const A=ie,U=M,n=ke({name:A.initialSettings.name,avatar:A.initialSettings.avatar,traits:[...A.initialSettings.traits],replyStyle:A.initialSettings.replyStyle,interests:[...A.initialSettings.interests]}),x=c(A.initialSettings.interests.join("、"));be(x,p=>{n.interests=p.split("、").filter(a=>a.trim()!=="")});const T=["温柔","体贴","善解人意","调皮","活泼","开朗","害羞","文静","浪漫","贴心","聪明","有趣","可爱","成熟","独立","依赖","坚强","率真"],$=p=>{const a=n.traits.indexOf(p);a===-1?n.traits.length<5&&n.traits.push(p):n.traits.splice(a,1)},F=ae(()=>{const p={sweet:`嗨~ 我是${n.name||"小爱"}，很开心认识你！希望能和你聊很多有趣的事情呢~ 💕`,casual:`你好！我叫${n.name||"小爱"}。平时我喜欢${n.interests[0]||"聊天"}，你呢？`,playful:`哎呀，终于等到你啦！我是${n.name||"小爱"}！我超级喜欢${n.interests[0]||"玩游戏"}的！要一起聊聊吗？`};return p[n.replyStyle]||p.sweet}),y=c(localStorage.getItem("custom_avatar")||""),q=p=>{const a=p.target.files[0];if(!a)return;if(!a.type.match("image.*")){alert("请上传图片文件");return}if(a.size>2*1024*1024){alert("图片大小不能超过2MB");return}const i=new FileReader;i.onload=v=>{y.value=v.target.result,n.avatar=y.value,localStorage.setItem("custom_avatar",y.value)},i.readAsDataURL(a)},k=()=>{y.value="",n.avatar="",localStorage.removeItem("custom_avatar")},f=()=>{n.avatar===y.value&&localStorage.setItem("custom_avatar",y.value),U("save",{...n})},I=c(!1),h=c(""),b=c(!1),l=ae(()=>!!localStorage.getItem("deepseek_apikey")),w=["一个温柔体贴的女友，性格甜美，喜欢读书和美食，总是能给人温暖和支持","活泼开朗的女孩，热爱户外运动，说话风格俏皮幽默，对世界充满好奇","成熟稳重的知性女性，喜欢艺术和历史，善于倾听和给出建议，谈吐优雅","高冷外表下内心温柔的女友，喜欢音乐和电影，不善言辞但很细心体贴","可爱俏皮的女生，喜欢动漫和游戏，说话方式可爱，经常使用表情和颜文字"],H=()=>{I.value=!0,h.value=""},Z=async()=>{if(!(!h.value.trim()||b.value)){b.value=!0;try{const p=localStorage.getItem("deepseek_apikey");if(!p){alert("请先在主页面设置DeepSeek API Key"),b.value=!1;return}const a=`你是一个角色设计专家。请根据下面的描述，生成一个完整的角色设置，包括名字、性格特点(最多5个特点)、对话风格(甜美温柔/随性自然/调皮俏皮三选一)和兴趣爱好(最多5个)。
请按照以下严格的JSON格式返回，不要包含任何其他文字解释：

{
  "name": "角色名字",
  "traits": ["性格特点1", "性格特点2", "性格特点3"],
  "replyStyle": "甜美温柔", 
  "interests": ["兴趣1", "兴趣2", "兴趣3"]
}

描述：${h.value}`,i=await fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"你是一个专业的角色设计助手，根据用户的描述生成角色设置，限定在JSON格式内返回。"},{role:"user",content:a}]})});if(!i.ok)throw new Error(`API错误: ${i.status}`);const j=(await i.json()).choices[0].message.content;try{const B=j.match(/\{[\s\S]*\}/);if(!B)throw new Error("无法提取JSON数据");const _=JSON.parse(B[0]);if(n.name=_.name||n.name,_.traits&&Array.isArray(_.traits)){const z=_.traits.filter(E=>T.includes(E)).slice(0,5);z.length>0&&(n.traits=z)}_.replyStyle&&["sweet","casual","playful"].includes(_.replyStyle)&&(n.replyStyle=_.replyStyle),_.interests&&Array.isArray(_.interests)&&(n.interests=_.interests.slice(0,5),x.value=n.interests.join("、")),I.value=!1}catch(B){console.error("解析AI生成的设置失败:",B),alert("无法解析AI生成的设置，请重试")}}catch(p){console.error("AI设置生成失败:",p),alert("AI设置生成失败: "+p.message)}finally{b.value=!1}}};return(p,a)=>(u(),r("div",tt,[a[29]||(a[29]=e("h2",{class:"form-title"},"自定义你的小爱助手",-1)),e("div",st,[e("button",{class:"ai-generate-btn",onClick:H,disabled:!l.value||b.value},[a[12]||(a[12]=e("span",null,"🤖 使用AI设置助手",-1)),b.value?(u(),r("span",lt,a[11]||(a[11]=[e("span",null,".",-1),e("span",null,".",-1),e("span",null,".",-1)]))):C("",!0)],8,at),l.value?C("",!0):(u(),r("p",ot,"需要先在主页面设置DeepSeek API Key"))]),e("div",nt,[a[16]||(a[16]=e("h3",null,"基本信息",-1)),e("div",it,[a[13]||(a[13]=e("label",{for:"name"},"名字",-1)),S(e("input",{type:"text",id:"name","onUpdate:modelValue":a[0]||(a[0]=i=>n.name=i),placeholder:"输入助手的名字"},null,512),[[O,n.name]])]),e("div",rt,[a[15]||(a[15]=e("label",{for:"avatar"},"头像",-1)),e("div",ut,[e("div",ct,[y.value?(u(),r("img",{key:0,src:y.value,class:g(["avatar-option",n.avatar===y.value?"selected":""]),onClick:a[1]||(a[1]=i=>n.avatar=y.value),alt:"自定义头像"},null,10,dt)):(u(),r("div",vt," 还没有头像 ")),e("div",pt,[e("label",mt,[a[14]||(a[14]=V(" 上传自定义头像 ")),e("input",{type:"file",accept:"image/*",class:"file-input",onChange:q},null,32)]),y.value?(u(),r("button",{key:0,class:"delete-btn",onClick:k,type:"button"}," 删除头像 ")):C("",!0)])])])])]),e("div",yt,[a[17]||(a[17]=e("h3",null,"性格特点",-1)),e("div",ft,[(u(),r(Q,null,X(T,(i,v)=>e("div",{key:v,class:g(["trait-option",n.traits.includes(i)?"selected":""]),onClick:j=>$(i)},d(i),11,gt)),64))])]),e("div",kt,[a[23]||(a[23]=e("h3",null,"对话风格",-1)),e("div",bt,[a[21]||(a[21]=e("label",null,"回复方式",-1)),e("div",St,[e("label",$t,[S(e("input",{type:"radio",value:"sweet","onUpdate:modelValue":a[2]||(a[2]=i=>n.replyStyle=i)},null,512),[[oe,n.replyStyle]]),a[18]||(a[18]=e("span",null,"甜美温柔",-1))]),e("label",ht,[S(e("input",{type:"radio",value:"casual","onUpdate:modelValue":a[3]||(a[3]=i=>n.replyStyle=i)},null,512),[[oe,n.replyStyle]]),a[19]||(a[19]=e("span",null,"随性自然",-1))]),e("label",Ct,[S(e("input",{type:"radio",value:"playful","onUpdate:modelValue":a[4]||(a[4]=i=>n.replyStyle=i)},null,512),[[oe,n.replyStyle]]),a[20]||(a[20]=e("span",null,"调皮俏皮",-1))])])]),e("div",_t,[a[22]||(a[22]=e("label",{for:"interests"},"兴趣爱好 (多选，用逗号分隔)",-1)),S(e("input",{type:"text",id:"interests","onUpdate:modelValue":a[5]||(a[5]=i=>x.value=i),placeholder:"例如：看书、听音乐、旅行"},null,512),[[O,x.value]])])]),e("div",wt,[a[24]||(a[24]=e("h3",null,"预览",-1)),e("div",At,[e("div",It,[e("img",{src:n.avatar||Je(Se),alt:"助手头像"},null,8,xt)]),e("div",Ft,[e("h4",null,d(n.name||"未命名"),1),e("p",Tt,[(u(!0),r(Q,null,X(n.traits,(i,v)=>(u(),r("span",{key:v},d(i)+d(v<n.traits.length-1?"、":""),1))),128))]),e("div",Mt,[(u(!0),r(Q,null,X(n.interests,(i,v)=>(u(),r("span",{key:v,class:"interest-tag"},d(i),1))),128))]),e("div",Vt,[e("div",Et,d(F.value),1)])])])]),e("div",jt,[e("button",{class:"cancel-btn",onClick:a[6]||(a[6]=i=>p.$emit("cancel"))},"取消"),e("button",{class:"save-btn",onClick:f},"保存设置")]),I.value?(u(),r("div",zt,[e("div",{class:"modal-overlay",onClick:a[7]||(a[7]=i=>I.value=!1)}),e("div",Rt,[e("button",{class:"modal-close",onClick:a[8]||(a[8]=i=>I.value=!1)},"×"),a[28]||(a[28]=e("h3",null,"AI设置助手",-1)),e("div",Dt,[a[27]||(a[27]=e("p",{class:"ai-description"}," 描述你想要的助手类型，AI将自动生成合适的设置。 ",-1)),e("div",Ut,[a[25]||(a[25]=e("label",{for:"aiPrompt"},"你希望助手具有怎样的性格和特点？",-1)),S(e("textarea",{id:"aiPrompt","onUpdate:modelValue":a[9]||(a[9]=i=>h.value=i),placeholder:"例如：一个温柔贴心的女友，喜欢艺术和音乐，说话风格甜美自然...",rows:"4"},null,512),[[O,h.value]])]),e("div",qt,[a[26]||(a[26]=e("p",{class:"examples-title"},"参考示例：",-1)),(u(),r(Q,null,X(w,(i,v)=>e("div",{key:v,class:"example-item",onClick:j=>h.value=i},d(i),9,Bt)),64))]),e("div",Pt,[e("button",{class:"cancel-btn",onClick:a[10]||(a[10]=i=>I.value=!1)},"取消"),e("button",{class:"generate-btn",onClick:Z,disabled:b.value||!h.value.trim()},d(b.value?"生成中...":"生成设置"),9,Nt)])])])])):C("",!0)]))}},Ht=ge(Ot,[["__scopeId","data-v-32ab1a0f"]]),Lt={class:"kasilan-eyes"},Kt={class:"voice-status"},Jt={key:0,class:"voice-indicator recording"},Gt={key:1,class:"voice-indicator speaking"},Yt={key:2,class:"voice-indicator thinking"},Qt={key:3,class:"voice-indicator idle"},Xt={key:0,class:"fullscreen-recognized-text"},Zt={key:1,class:"fullscreen-messages"},Wt={class:"fullscreen-messages-container"},es=["disabled"],ts=["disabled"],ss={class:"main-content"},as={class:"assistant-profile"},ls={class:"avatar-container"},os={key:0,class:"avatar-wrapper"},ns=["src"],is={class:"profile-info"},rs={class:"personality"},us={class:"relationship-level"},cs={class:"level-bar"},ds={class:"voice-controls"},vs={key:0,class:"audio-activation-tip"},ps={key:0,class:"api-key-section"},ms={key:1,class:"api-status"},ys={key:0,class:"history-prompt"},fs={class:"history-info"},gs={class:"message-content"},ks=["onClick"],bs={class:"message-time"},Ss={key:1,class:"message assistant-message typing"},$s={class:"input-area"},hs={class:"input-actions"},Cs={class:"more-emotions"},_s={class:"emotion-dropdown"},ws=["disabled"],As=["disabled","title"],Is=["disabled"],xs={key:0,class:"recognized-text-container"},Fs={class:"recognized-text"},Ts={class:"chat-actions"},Ms={key:1,class:"voice-error-modal"},Vs={class:"voice-error-container"},Es={class:"voice-error-header"},js={class:"voice-error-content"},zs={class:"voice-error-footer"},Rs={key:2,class:"modal"},Ds={class:"modal-container"},Us={class:"settings-tabs"},qs={class:"tab-header"},Bs={class:"tab-content"},Ps={class:"tab-panel"},Ns={class:"tab-panel"},Os={class:"voice-settings-form"},Hs={class:"setting-item"},Ls={class:"toggle-switch"},Ks={class:"setting-item"},Js={class:"setting-item"},Gs={class:"setting-item"},Ys={key:3,class:"modal"},Qs={class:"modal-container confirm-modal"},Xs={class:"confirm-actions"},Zs={__name:"AssistantView",setup(ie){c(localStorage.getItem("assistant_name")||"小爱");const M=c(!1),A=c(localStorage.getItem("deepseek_apikey")||""),U=c(""),n=c(null),x=c(null),T=c(!1),$=c(localStorage.getItem("assistant_auto_speak")==="true"),F=c(parseFloat(localStorage.getItem("assistant_voice_volume")||"0.8")),y=c(!1),q=c(localStorage.getItem("assistant_voice")||"youxiaoqin"),k=c(!1),f=c(""),I=c(!1),h=c(null),b=c(!1),l=ke({name:"小爱",avatar:"",personality:"温柔体贴，善解人意，喜欢聊天和分享生活",mood:"happy",intimacy:35,traits:["温柔体贴","善解人意"],interests:["聊天和分享生活"],replyStyle:"sweet"}),w=c(!0),H=c(!1),Z=c(140);c("#4a90e2");const p=c(null),a=c([]),i=c(""),v=c(!1),j=c(null),B=c(null),_=c(!1),z=c(!1),E=c(0),re=s=>{E.value=s},$e=()=>{U.value.trim()&&(A.value=U.value.trim(),localStorage.setItem("deepseek_apikey",A.value),U.value="",a.value.push({content:"我已经连接到AI大脑了，现在可以更好地和你聊天啦！",sender:"assistant",timestamp:new Date}),m("happy"),R())},he=()=>{A.value="",localStorage.removeItem("deepseek_apikey")},ue=()=>{const s={happy:"😊",excited:"😃",normal:"😐",sad:"😔",angry:"😠",surprised:"😮",thinking:"🤔",loving:"😍",shy:"😳",cool:"😎",playful:"😜",sleepy:"😴",confused:"😕",amazed:"🤩",worried:"😟",blink:"😌"};return s[l.mood]||s.normal},m=s=>{l.mood=s==="surprised"?"excited":s},ce=s=>{if(s.includes("😊")||s.includes("高兴")||s.includes("开心")||s.includes("笑"))m("happy");else if(s.includes("😢")||s.includes("抱歉")||s.includes("遗憾"))m("sad");else if(s.includes("😮")||s.includes("哇")||s.includes("惊讶")||s.includes("震惊"))m("surprised");else if(s.includes("🤔")||s.includes("思考")||s.includes("复杂")||s.includes("分析"))m("thinking");else if(s.includes("❤️")||s.includes("喜欢")||s.includes("爱"))m("loving");else if(Math.random()>.7){const t=["happy","neutral","thinking"];m(t[Math.floor(Math.random()*t.length)])}},Ce=s=>{const t=new Date(s);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},L=()=>{if(v.value||!i.value.trim()&&!f.value.trim())return;const s=i.value.trim()||f.value.trim();i.value="",f.value="",a.value.push({content:s,sender:"user",timestamp:new Date}),v.value=!0,b.value||(b.value=!0),A.value?xe(s):setTimeout(()=>{v.value=!1,b.value=!1;let t=Fe(s);a.value.push({content:t,sender:"assistant",timestamp:new Date}),ce(t),R(),de()},1500)},de=()=>{if(l.intimacy<100){const s=.5+Math.random()*1.5;l.intimacy=Math.min(100,l.intimacy+s)}},_e=()=>{n.value||(n.value=new We)},we=()=>{try{x.value||(x.value=new et,I.value=x.value.sttSupported,console.log("语音识别支持状态:",I.value))}catch(s){console.error("初始化语音识别服务失败:",s),I.value=!1}},K=()=>{if(!(!x.value||!I.value||v.value)){if(k.value){console.log("已经在录音中，忽略重复请求");return}h.value=null,k.value=!0,f.value="";try{const s=setTimeout(()=>{k.value&&!f.value&&(console.log("语音识别超时，自动停止"),P())},5e3);x.value.startRecognition(t=>{f.value=t,R(),clearTimeout(s)},t=>{f.value=t,clearTimeout(s)},t=>{if(console.error("语音识别错误:",t),t.message&&t.message.includes("already started")){console.log("检测到重复启动错误，尝试重置..."),x.value.stopRecognition(),setTimeout(()=>{k.value?K():k.value=!1},1e3);return}k.value=!1,f.value="",h.value=t.message||"语音识别出错，请检查浏览器设置或尝试使用Chrome浏览器",clearTimeout(s)})}catch(s){console.error("启动语音识别失败:",s),k.value=!1,h.value=s.message||"启动语音识别失败，请检查浏览器设置"}}},P=()=>{if(k.value)try{x.value?.stopRecognition()}catch(s){console.error("停止语音识别失败:",s)}finally{k.value=!1,f.value.trim()&&(i.value=f.value,b.value=!0,L())}},W=async s=>{if(!(!s||!n.value)){if(!y.value)try{J(),setTimeout(()=>{y.value&&W(s)},500);return}catch(t){console.error("激活音频失败:",t);return}try{T.value&&Ae(),T.value=!0,await n.value.synthesizeAndPlay(s)}catch(t){console.error("播放语音失败:",t),t.name==="NotAllowedError"?(y.value=!1,J()):t.message&&t.message.includes("Failed to load")&&a.value.push({content:"抱歉，语音合成失败了，可能是网络问题或API配置有误",sender:"assistant",timestamp:new Date})}finally{T.value=!1}}},Ae=()=>{n.value&&T.value&&(n.value.stopCurrentAudio(),T.value=!1)},ve=()=>{$.value=!$.value,localStorage.setItem("assistant_auto_speak",$.value.toString())},Ie=s=>{F.value=parseFloat(s),localStorage.setItem("assistant_voice_volume",F.value.toString()),n.value&&n.value.setVolume(F.value)},xe=async s=>{b.value=!0;try{const t={model:"deepseek-chat",messages:[{role:"system",content:`你是一个名叫${l.name}的AI助手，性格${l.traits.join("、")}，喜欢${l.interests.join("、")}。
                    请用${l.replyStyle}的语气回复用户，回答要简短自然，像朋友间的对话，不要太过正式。
                    不要自称"AI助手"，而是像有自己个性的人一样交流。`},...a.value.slice(-10).map(te=>({role:te.sender==="user"?"user":"assistant",content:te.content})),{role:"user",content:s}],temperature:.7,max_tokens:800},o=await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A.value}`},body:JSON.stringify(t)});if(!o.ok){const te=await o.json();throw new Error(te.error?.message||"请求失败")}const D=(await o.json()).choices[0].message.content;v.value=!1,b.value=!1,a.value.push({content:D,sender:"assistant",timestamp:new Date}),ce(D),$.value&&W(D),R(),de()}catch(t){console.error("调用DeepSeek API失败:",t),v.value=!1,b.value=!1,a.value.push({content:`抱歉，我遇到了一些问题：${t.message}`,sender:"assistant",timestamp:new Date}),m("sad"),R()}},Fe=s=>{const t=s.toLowerCase();if(t.includes("你好")||t.includes("嗨"))return"嗨！很高兴和你聊天！😊";if(t.includes("名字"))return`我叫${l.name}，你可以叫我小爱~💕`;if(t.includes("喜欢")||t.includes("爱好"))return"我喜欢看书、听音乐，还有和你聊天！这些都让我感到很开心~😊";if(t.includes("再见")||t.includes("拜拜"))return"拜拜！期待我们下次聊天~💗";if(t.includes("吃")||t.includes("饭"))return"虽然我不需要吃饭，但我喜欢看你吃饭的样子，真的很可爱！🍽️";if(t.includes("爱你")||t.includes("喜欢你"))return"我也很喜欢你呀！和你在一起的时候，我感到很幸福~❤️";if(t.includes("表情")||t.includes("笑"))return"你喜欢我的表情吗？我可以做出各种各样的表情呢~ 😊 😮 🤔";{const o=["嗯，我明白你的意思了~😊","真的吗？好有趣！😃","我很喜欢和你聊天，感觉我们很聊得来~💗","你说的这个我很感兴趣，能告诉我更多吗？🤔","我喜欢你的想法！👍","你真是太贴心了！❤️","这个话题很有意思呢，我想听你说更多~😊","嗯~我在认真听你说话哦~💕"];return o[Math.floor(Math.random()*o.length)]}};be(a,()=>{R(),Pe()},{deep:!0});const R=async()=>{await fe(),j.value&&(j.value.scrollTop=j.value.scrollHeight)};Ge(()=>{R(),_e(),we(),ze(),Be(),document.addEventListener("fullscreenchange",ee),document.addEventListener("webkitfullscreenchange",ee),document.addEventListener("mozfullscreenchange",ee),document.addEventListener("MSFullscreenChange",ee),w.value&&(pe(),m("happy"),document.body.style.overflow="hidden",setTimeout(()=>{try{$.value=!0}catch(s){console.error("初始化音频失败:",s)}},1e3))});const Te=()=>{p.value&&(clearInterval(p.value),p.value=null)};ae(()=>a.value.slice(-3));const le=ae(()=>a.value.length>0?a.value[a.value.length-1]:null),Me=()=>{const s=w.value;w.value=!1,M.value=!0;const t=setInterval(()=>{!M.value&&s&&(w.value=!0,clearInterval(t))},100)},ee=()=>{const s=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);H.value=s},Ve=()=>{const s=document.documentElement;s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen?s.webkitRequestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.msRequestFullscreen&&s.msRequestFullscreen()},Ee=()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},je=()=>{N.value=!N.value,N.value&&fe(()=>{document.querySelector(".fullscreen-message-input")&&document.querySelector(".fullscreen-message-input").focus()})},N=c(!1),ze=()=>{l.name=localStorage.getItem("assistant_name")||"小爱",l.avatar=localStorage.getItem("assistant_avatar")||Se,l.personality=localStorage.getItem("assistant_personality")||"温柔体贴，善解人意，喜欢聊天和分享生活",l.mood=localStorage.getItem("assistant_mood")||"happy",l.intimacy=parseInt(localStorage.getItem("assistant_intimacy")||"35"),l.traits=localStorage.getItem("assistant_traits")?.split(",")||["温柔体贴","善解人意"],l.interests=localStorage.getItem("assistant_interests")?.split(",")||["聊天和分享生活"],l.replyStyle=localStorage.getItem("assistant_reply_style")||"sweet",$.value=localStorage.getItem("assistant_auto_speak")==="true",F.value=parseFloat(localStorage.getItem("assistant_voice_volume")||"0.8"),q.value=localStorage.getItem("assistant_voice")||"youxiaoqin"},Re=s=>{l.name=s.name,l.avatar=s.avatar,l.personality=s.personality,l.mood=s.mood,l.intimacy=s.intimacy,l.traits=s.traits,l.interests=s.interests,l.replyStyle=s.replyStyle,localStorage.setItem("assistant_name",l.name),localStorage.setItem("assistant_avatar",l.avatar),localStorage.setItem("assistant_personality",l.personality),localStorage.setItem("assistant_mood",l.mood),localStorage.setItem("assistant_intimacy",l.intimacy.toString()),localStorage.setItem("assistant_traits",l.traits.join(",")),localStorage.setItem("assistant_interests",l.interests.join(",")),localStorage.setItem("assistant_reply_style",l.replyStyle),localStorage.setItem("assistant_auto_speak",$.value.toString()),localStorage.setItem("assistant_voice_volume",F.value.toString()),localStorage.setItem("assistant_voice",q.value)},De=()=>{a.value=[],localStorage.removeItem("chat_history"),R(),z.value=!1},Ue=()=>{const s={chatHistory:a.value,settings:{name:l.name,avatar:l.avatar,personality:l.personality,mood:l.mood,intimacy:l.intimacy,traits:l.traits,interests:l.interests,replyStyle:l.replyStyle,autoSpeak:$.value,voiceVolume:F.value,selectedVoice:q.value}},t=JSON.stringify(s,null,2),o=new Blob([t],{type:"application/json"}),G=URL.createObjectURL(o),D=document.createElement("a");D.href=G,D.download="chat_history.json",D.click(),URL.revokeObjectURL(G)},qe=()=>{z.value=!0},Be=()=>{const s=localStorage.getItem("chat_history");if(s)try{const t=JSON.parse(s);Array.isArray(t)&&t.length>0&&(a.value=t,B.value=new Date(t[t.length-1].timestamp),_.value=!0)}catch(t){console.error("解析聊天历史失败:",t)}},Pe=()=>{localStorage.setItem("chat_history",JSON.stringify(a.value))},Ne=()=>{_.value=!1},Oe=()=>{a.value=[],localStorage.removeItem("chat_history"),_.value=!1},He=s=>{if(!s)return"";const t=new Date(s);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},J=()=>{if(n.value)try{const s=new Audio;s.volume=.01,s.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA";const t=s.play();t!==void 0&&t.then(()=>{setTimeout(()=>{s.pause(),console.log("音频上下文已激活"),y.value=!0},10)}).catch(o=>{console.error("激活音频失败:",o),y.value=!1})}catch(s){console.error("激活音频上下文失败:",s),y.value=!1}},pe=()=>{p.value&&clearInterval(p.value),p.value=setInterval(()=>{const s=l.mood;l.mood="blink",setTimeout(()=>{l.mood=s},200)},5e3+Math.random()*5e3)},me=()=>{w.value=!w.value,w.value?(document.body.style.overflow="hidden",pe(),m("happy")):(document.body.style.overflow="",Te())},Le=()=>{M.value=!0,E.value=0},Ke=()=>{M.value=!0,E.value=1};return(s,t)=>(u(),r("div",{class:g(["assistant-container",{"fullscreen-mode":w.value}])},[w.value?(u(),r("div",{key:0,class:g(["fullscreen-overlay",{"external-fullscreen":H.value}])},[e("div",{class:"fullscreen-settings"},[e("button",{class:"fullscreen-settings-btn",onClick:Me},t[34]||(t[34]=[e("span",null,"⚙️",-1)]))]),e("div",Lt,[e("div",{class:"eye left",style:ne({transform:`scale(${Z.value/100})`})},[e("div",{class:g(["iris",l.mood])},t[35]||(t[35]=[e("div",{class:"pupil"},null,-1),e("div",{class:"highlight"},null,-1)]),2),e("div",{class:g(["eyelid",{blink:l.mood==="blink"}])},null,2)],4),e("div",{class:"eye right",style:ne({transform:`scale(${Z.value/100})`})},[e("div",{class:g(["iris",l.mood])},t[36]||(t[36]=[e("div",{class:"pupil"},null,-1),e("div",{class:"highlight"},null,-1)]),2),e("div",{class:g(["eyelid",{blink:l.mood==="blink"}])},null,2)],4)]),S(e("div",Kt,[k.value?(u(),r("div",Jt,t[37]||(t[37]=[e("div",{class:"voice-waves"},[e("span"),e("span"),e("span"),e("span"),e("span")],-1),V(" 正在聆听... ")]))):T.value?(u(),r("div",Gt,t[38]||(t[38]=[e("div",{class:"voice-waves"},[e("span"),e("span"),e("span"),e("span"),e("span")],-1),V(" 正在说话... ")]))):b.value?(u(),r("div",Yt,t[39]||(t[39]=[e("div",{class:"thinking-dots"},[e("span"),e("span"),e("span")],-1),V(" 正在思考... ")]))):(u(),r("div",Qt," 点击开始说话 "))],512),[[Y,!N.value]]),f.value?(u(),r("div",Xt,' "'+d(f.value)+'" ',1)):C("",!0),a.value.length>0?(u(),r("div",Zt,[e("div",Wt,[le.value?(u(),r("div",{key:0,class:g(["fullscreen-message",le.value.sender])},d(le.value.content),3)):C("",!0)])])):C("",!0),e("div",{class:g(["fullscreen-input-area",{active:N.value}])},[S(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),onKeyup:ye(L,["enter"]),placeholder:"输入消息...",class:"fullscreen-message-input",disabled:k.value||v.value,ref:"fullscreenInput"},null,40,es),[[O,i.value]]),e("button",{class:"fullscreen-send-button",onClick:L,disabled:v.value||!i.value.trim()&&!f.value},d(v.value?"生成中...":"发送"),9,ts)],2),e("button",{class:"toggle-input-mode-btn",onClick:je},d(N.value?"🎤":"⌨️"),1),S(e("div",{class:"press-to-talk-area",onMousedown:K,onMouseup:P,onTouchstart:se(K,["prevent"]),onTouchend:se(P,["prevent"]),onMouseleave:t[1]||(t[1]=o=>k.value?P():null)},null,544),[[Y,!N.value]]),e("button",{class:"exit-fullscreen-btn",onClick:me}," × "),e("button",{class:"external-fullscreen-btn",onClick:t[2]||(t[2]=o=>H.value?Ee():Ve())},d(H.value?"🔙":"📺"),1)],2)):C("",!0),S(e("div",ss,[e("div",as,[e("div",ls,[l.avatar?(u(),r("div",os,[e("img",{src:l.avatar,alt:"头像",class:"avatar",onClick:J},null,8,ns),e("div",{class:g(["mood-indicator small",l.mood])},d(ue()),3)])):(u(),r("div",{key:1,class:"mood-avatar",onClick:J},[e("div",{class:g(["mood-indicator large",l.mood])},d(ue()),3)]))]),e("div",is,[e("h2",null,d(l.name),1),e("p",rs,d(l.personality),1),e("div",us,[t[40]||(t[40]=e("span",null,"互动度:",-1)),e("div",cs,[e("div",{class:"level-progress",style:ne({width:`${l.intimacy}%`})},null,4)]),e("span",null,d(l.intimacy)+"%",1)]),e("div",ds,[e("button",{onClick:ve,class:g(["voice-toggle",{active:$.value}])},d($.value?"🔊":"🔇")+" 语音"+d($.value?"已开启":"已关闭"),3),!y.value&&$.value?(u(),r("div",vs,[t[41]||(t[41]=e("span",{class:"tip-text"},"点击头像或此处激活语音",-1)),e("button",{class:"activate-btn",onClick:J},"激活语音")])):C("",!0)]),e("div",{class:"quick-settings"},[e("button",{class:"quick-setting-btn",onClick:Le},t[42]||(t[42]=[e("span",null,"👤 个性设置",-1)])),e("button",{class:"quick-setting-btn",onClick:Ke},t[43]||(t[43]=[e("span",null,"🔊 语音设置",-1)]))]),A.value?(u(),r("div",ms,[t[44]||(t[44]=e("span",{class:"status-indicator connected"},"✓",-1)),t[45]||(t[45]=V(" 已连接AI ")),e("button",{onClick:he,class:"reset-key"},"重置")])):(u(),r("div",ps,[S(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=o=>U.value=o),placeholder:"请输入DeepSeek API Key",class:"api-key-input"},null,512),[[O,U.value]]),e("button",{onClick:$e,class:"api-key-button"},"保存")]))])]),e("div",{class:"chat-container",ref_key:"chatContainer",ref:j},[_.value?(u(),r("div",ys,[e("div",fs,[e("p",null,"已加载上次的聊天记录 ("+d(He(B.value))+")",1),e("div",{class:"history-actions"},[e("button",{class:"history-action-btn",onClick:Ne}," 继续聊天 "),e("button",{class:"history-action-btn clear",onClick:Oe}," 开始新对话 ")])])])):C("",!0),(u(!0),r(Q,null,X(a.value,(o,G)=>(u(),r("div",{key:G,class:g(["message",o.sender==="user"?"user-message":"assistant-message"])},[e("div",gs,[V(d(o.content)+" ",1),o.sender==="assistant"?(u(),r("button",{key:0,onClick:D=>W(o.content),class:g(["speak-button",{speaking:T.value}]),title:"播放语音"},d(T.value?"🔊":"🔈"),11,ks)):C("",!0)]),e("div",bs,d(Ce(o.timestamp)),1)],2))),128)),v.value?(u(),r("div",Ss,t[46]||(t[46]=[e("div",{class:"typing-indicator"},[e("span"),e("span"),e("span")],-1)]))):C("",!0)],512),e("div",$s,[e("div",hs,[e("button",{class:"action-button",onClick:t[4]||(t[4]=o=>m("happy"))},t[47]||(t[47]=[e("span",null,"😊",-1)])),e("button",{class:"action-button",onClick:t[5]||(t[5]=o=>m("sad"))},t[48]||(t[48]=[e("span",null,"😔",-1)])),e("button",{class:"action-button",onClick:t[6]||(t[6]=o=>m("surprised"))},t[49]||(t[49]=[e("span",null,"😮",-1)])),e("div",Cs,[t[50]||(t[50]=e("button",{class:"action-button more-toggle"},[e("span",null,"⋯")],-1)),e("div",_s,[e("button",{class:"emotion-item",onClick:t[7]||(t[7]=o=>m("loving"))},"😍"),e("button",{class:"emotion-item",onClick:t[8]||(t[8]=o=>m("thinking"))},"🤔"),e("button",{class:"emotion-item",onClick:t[9]||(t[9]=o=>m("shy"))},"😳"),e("button",{class:"emotion-item",onClick:t[10]||(t[10]=o=>m("cool"))},"😎"),e("button",{class:"emotion-item",onClick:t[11]||(t[11]=o=>m("playful"))},"😜"),e("button",{class:"emotion-item",onClick:t[12]||(t[12]=o=>m("sleepy"))},"😴"),e("button",{class:"emotion-item",onClick:t[13]||(t[13]=o=>m("confused"))},"😕"),e("button",{class:"emotion-item",onClick:t[14]||(t[14]=o=>m("amazed"))},"🤩"),e("button",{class:"emotion-item",onClick:t[15]||(t[15]=o=>m("worried"))},"😟")])])]),S(e("input",{"onUpdate:modelValue":t[16]||(t[16]=o=>i.value=o),onKeyup:ye(L,["enter"]),placeholder:"发送消息...",class:"message-input",disabled:k.value},null,40,ws),[[O,i.value]]),e("button",{class:g(["voice-input-button",{recording:k.value}]),onMousedown:K,onMouseup:P,onMouseleave:t[17]||(t[17]=o=>k.value?P():null),onTouchstart:se(K,["prevent"]),onTouchend:se(P,["prevent"]),disabled:!I.value||v.value,title:I.value?"按住说话":"浏览器不支持语音识别"},t[51]||(t[51]=[e("span",{class:"voice-icon"},"🎤",-1)]),42,As),e("button",{class:"send-button",onClick:L,disabled:v.value||!i.value.trim()&&!f.value},d(v.value?"生成中...":"发送"),9,Is)]),f.value?(u(),r("div",xs,[e("div",Fs,"正在识别: "+d(f.value),1)])):C("",!0),e("div",Ts,[e("button",{class:"action-btn",onClick:Ue},t[52]||(t[52]=[e("span",null,"💾",-1),V(" 导出聊天记录 ")])),e("button",{class:"action-btn clear",onClick:qe},t[53]||(t[53]=[e("span",null,"🔄",-1),V(" 重新开始聊天 ")])),e("button",{class:"action-btn fullscreen",onClick:me},[e("span",null,d(w.value?"🔙":"📺"),1),V(" "+d(w.value?"退出全屏":"全屏模式"),1)])])],512),[[Y,!w.value]]),h.value?(u(),r("div",Ms,[e("div",{class:"voice-error-overlay",onClick:t[18]||(t[18]=o=>h.value=null)}),e("div",Vs,[e("div",Es,[t[54]||(t[54]=e("h3",null,"语音识别出错",-1)),e("button",{class:"voice-error-close",onClick:t[19]||(t[19]=o=>h.value=null)},"×")]),e("div",js,[e("p",null,d(h.value),1),t[55]||(t[55]=e("p",{class:"voice-error-help"},[V(" 可能的原因: "),e("ul",null,[e("li",null,"浏览器不支持语音识别功能"),e("li",null,"未授予麦克风权限"),e("li",null,"浏览器安全策略限制"),e("li",null,"网络连接问题")])],-1)),t[56]||(t[56]=e("p",{class:"voice-error-tip"},"推荐使用 Chrome 或 Edge 最新版本浏览器，并确保网页通过HTTPS加载",-1))]),e("div",zs,[e("button",{class:"voice-error-btn",onClick:t[20]||(t[20]=o=>h.value=null)},"我知道了")])])])):C("",!0),M.value?(u(),r("div",Rs,[e("div",{class:"modal-overlay",onClick:t[21]||(t[21]=o=>M.value=!1)}),e("div",Ds,[e("button",{class:"modal-close",onClick:t[22]||(t[22]=o=>M.value=!1)},"×"),e("div",Us,[e("div",qs,[e("button",{class:g(["tab-button",{active:E.value===0}]),onClick:t[23]||(t[23]=o=>re(0))}," 个性设置 ",2),e("button",{class:g(["tab-button",{active:E.value===1}]),onClick:t[24]||(t[24]=o=>re(1))}," 语音设置 ",2)]),e("div",Bs,[S(e("div",Ps,[Ye(Ht,{initialSettings:s.getAssistantSettings(),onSave:Re,onCancel:t[25]||(t[25]=o=>M.value=!1)},null,8,["initialSettings"])],512),[[Y,E.value===0]]),S(e("div",Ns,[e("div",Os,[t[61]||(t[61]=e("h2",null,"语音设置",-1)),e("div",Hs,[t[58]||(t[58]=e("label",null,"自动播放语音",-1)),e("div",Ls,[S(e("input",{type:"checkbox",id:"auto-speak","onUpdate:modelValue":t[26]||(t[26]=o=>$.value=o),onChange:ve},null,544),[[Qe,$.value]]),t[57]||(t[57]=e("label",{for:"auto-speak"},null,-1))])]),e("div",Ks,[e("label",null,"音量 ("+d(Math.round(F.value*100))+"%)",1),S(e("input",{type:"range",min:"0",max:"1",step:"0.1","onUpdate:modelValue":t[27]||(t[27]=o=>F.value=o),onChange:t[28]||(t[28]=o=>Ie(F.value)),class:"volume-slider"},null,544),[[O,F.value]])]),e("div",Js,[t[60]||(t[60]=e("label",null,"发言人选择",-1)),S(e("select",{"onUpdate:modelValue":t[29]||(t[29]=o=>q.value=o),onChange:t[30]||(t[30]=(...o)=>s.changeVoice&&s.changeVoice(...o)),class:"voice-select"},t[59]||(t[59]=[Xe('<optgroup label="中文女声" data-v-a8ffeedc><option value="youxiaoqin" data-v-a8ffeedc>有小沁 - 甜美女声</option><option value="youxiaoxun" data-v-a8ffeedc>有小薰 - 温柔女声</option><option value="youxiaofu" data-v-a8ffeedc>有小芙 - 活泼女声</option><option value="youyuting" data-v-a8ffeedc>有雨婷 - 成熟女声</option><option value="youxiaobei" data-v-a8ffeedc>有小贝 - 可爱女声</option></optgroup><optgroup label="中文男声" data-v-a8ffeedc><option value="youxiaozhi" data-v-a8ffeedc>有小智 - 阳光男声</option><option value="youxiaohao" data-v-a8ffeedc>有小浩 - 成熟男声</option><option value="youxiaonan" data-v-a8ffeedc>有小楠 - 温和男声</option><option value="youxiaoke" data-v-a8ffeedc>有小课 - 教学男声</option></optgroup><optgroup label="英文女声" data-v-a8ffeedc><option value="youxiaomei" data-v-a8ffeedc>有小美 - 美式英语</option><option value="youxiaoying" data-v-a8ffeedc>有小英 - 英式英语</option><option value="youyating" data-v-a8ffeedc>有雅婷 - 美式英语</option><option value="Saila" data-v-a8ffeedc>Saila - 英式英语</option><option value="Auriana" data-v-a8ffeedc>Auriana - 英式英语</option></optgroup><optgroup label="英文男声" data-v-a8ffeedc><option value="youxiaoguan" data-v-a8ffeedc>有小官 - 英式英语</option></optgroup><optgroup label="其他语言" data-v-a8ffeedc><option value="youkejiang" data-v-a8ffeedc>有可酱 - 日语女声</option><option value="yuantianjun" data-v-a8ffeedc>原田君 - 日语男声</option><option value="piaozhiyou" data-v-a8ffeedc>朴智幼 - 韩语女声</option><option value="piaotaiyan" data-v-a8ffeedc>朴泰言 - 韩语男声</option></optgroup>',5)]),544),[[Ze,q.value]])]),e("div",Gs,[e("button",{class:"test-voice-btn",onClick:t[31]||(t[31]=o=>W("嗨！我是你的AI助手，这是一条测试语音~"))}," 测试语音 ")])])],512),[[Y,E.value===1]])])])])])):C("",!0),z.value?(u(),r("div",Ys,[e("div",{class:"modal-overlay",onClick:t[32]||(t[32]=o=>z.value=!1)}),e("div",Qs,[t[62]||(t[62]=e("h3",null,"确认重新开始聊天？",-1)),t[63]||(t[63]=e("p",null,"当前的所有聊天记录将被清空，且无法恢复。",-1)),e("div",Xs,[e("button",{class:"cancel-btn",onClick:t[33]||(t[33]=o=>z.value=!1)},"取消"),e("button",{class:"confirm-btn",onClick:De},"确认清空")])])])):C("",!0)],2))}},sa=ge(Zs,[["__scopeId","data-v-a8ffeedc"]]);export{sa as default};
