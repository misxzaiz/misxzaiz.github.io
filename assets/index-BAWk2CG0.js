import{_ as Ce,r as D,o as Be,U as et,c as $,f as K,a as M,h as ke,t as q,F as Me,d as Te,n as Pe,j as Ke,g as Se,V as Fn,b as Kt,R as On,W as Gn,u as Hn}from"./index-0g_e_Ani.js";import{M as L,V as z,C as ce,F as $t,P as Un,a as Le,b as kt,c as vt,W as Bn,U as ut,d as Ct,S as Vt,B as zn,e as qe,T as jn,f as dt,g as Wt,L as Xt,h as He,i as Ze,j as ue,k as qt,l as le,m as ye,n as Kn,o as $n,D as Yt,I as Vn,Q as Jt,p as Wn,O as Zt,q as Qt,r as Xn,s as xe,t as qn,u as en,N as Yn,v as Jn,w as Zn,x as ft,y as tn,R as Qe,z as Qn,A as es,E as Ye,G as at,H as ts,J as nn,K as Ge,X as De,Y as ns,Z as Ue,_ as ss,$ as os,a0 as as,a1 as is,a2 as Je,a3 as ae,a4 as ht,a5 as rs,a6 as cs,a7 as ls,a8 as us,a9 as ds,aa as sn,ab as fs,ac as Dt,ad as It,ae as Pt,af as Nt,ag as mt,ah as hs,ai as ms,aj as ps,ak as gs,al as vs,am as ws,an as ys,ao as xs,ap as $e,aq as Ms,ar as me,as as H,at as ve,au as Ts,av as Ae,aw as Ft,ax as _s,ay as bs,az as Ot,aA as Es}from"./OrbitControls-Bho-J9CF.js";const As={class:"game-2048"},Rs={class:"game-header"},Ss={class:"scores"},Ls={class:"score"},ks={class:"score-value"},Cs={class:"score"},Ds={class:"score-value"},Is={class:"controls-hint"},Ps={class:"controls-row"},Ns={class:"controls-row"},Fs={key:0,class:"merge-message"},Os={key:1,class:"game-over-message"},Gs=30,Hs={__name:"Game2048",setup(g){const t=D([]),e=D(0),s=D(0),n=D(!1),a=D(""),o=D(!1),r=D(null),i=D(null),c=["这波合并，老板看了都说好！","合并得这么丝滑，你是摸鱼高手吧！","这操作，这意识，你是卷王吧！","合并得这么溜，你是游戏界的摸鱼达人！","这波合并我给99分，多一分怕你骄傲！","合并得这么帅，你是游戏界的颜值担当！","这波操作太秀了，我的膝盖已经跪下了！","合并得这么优雅，你是游戏界的艺术家！","这操作太丝滑了，简直像德芙巧克力！","合并得这么完美，你是游戏界的数学家吧！","这波操作我给跪了，太强了！","合并得这么流畅，你是游戏界的钢琴家吧！","这操作太帅了，我要给你打call！","合并得这么精准，你是游戏界的狙击手吧！","这波操作我给满分，太厉害了！","合并得这么优雅，你是游戏界的芭蕾舞者吧！","这操作太丝滑了，简直像德芙巧克力！","合并得这么完美，你是游戏界的数学家吧！","这波操作我给跪了，太强了！","合并得这么流畅，你是游戏界的钢琴家吧！"],l=()=>{a.value=c[Math.floor(Math.random()*c.length)],o.value=!0,setTimeout(()=>{o.value=!1},2e3)},d=()=>{t.value=Array(4).fill().map(()=>Array(4).fill(0)),f(),f(),e.value=0,n.value=!1},f=()=>{const y=[];if(t.value.forEach((h,p)=>{h.forEach((R,m)=>{R===0&&y.push({i:p,j:m})})}),y.length>0){const{i:h,j:p}=y[Math.floor(Math.random()*y.length)],R=Math.random()<.9?2:4;t.value[h][p]=R,r.value={i:h,j:p,value:R},setTimeout(()=>{r.value=null},300)}};let w=0,E=0;const v=y=>{w=y.touches[0].clientX,E=y.touches[0].clientY},T=y=>{const h=y.changedTouches[0].clientX,p=y.changedTouches[0].clientY,R=h-w,m=p-E;Math.sqrt(R*R+m*m)<Gs||(Math.abs(R)>Math.abs(m)?R>0?b("right"):b("left"):m>0?b("down"):b("up"))},b=y=>{if(n.value)return;JSON.stringify(t.value);let h=!1;switch(y){case"left":h=k();break;case"right":h=N();break;case"up":h=A();break;case"down":h=F();break}h&&setTimeout(()=>{f(),V()},150)},k=()=>{let y=!1;for(let h=0;h<4;h++){const p=t.value[h].filter(m=>m!==0);for(let m=0;m<p.length-1;m++)p[m]===p[m+1]&&(p[m]*=2,e.value+=p[m],p.splice(m+1,1),y=!0,i.value={i:h,j:m,value:p[m]},setTimeout(()=>{i.value=null},300),l());const R=p.concat(Array(4-p.length).fill(0));JSON.stringify(t.value[h])!==JSON.stringify(R)&&(y=!0),t.value[h]=R}return y},N=()=>{let y=!1;for(let h=0;h<4;h++){const p=t.value[h].filter(m=>m!==0);for(let m=p.length-1;m>0;m--)p[m]===p[m-1]&&(p[m]*=2,e.value+=p[m],p.splice(m-1,1),y=!0,i.value={i:h,j:m,value:p[m]},setTimeout(()=>{i.value=null},300),l());const R=Array(4-p.length).fill(0).concat(p);JSON.stringify(t.value[h])!==JSON.stringify(R)&&(y=!0),t.value[h]=R}return y},A=()=>{let y=!1;for(let h=0;h<4;h++){let p=t.value.map(m=>m[h]).filter(m=>m!==0);for(let m=0;m<p.length-1;m++)p[m]===p[m+1]&&(p[m]*=2,e.value+=p[m],p.splice(m+1,1),y=!0,i.value={i:m,j:h,value:p[m]},setTimeout(()=>{i.value=null},300),l());const R=p.concat(Array(4-p.length).fill(0));for(let m=0;m<4;m++)t.value[m][h]!==R[m]&&(y=!0),t.value[m][h]=R[m]}return y},F=()=>{let y=!1;for(let h=0;h<4;h++){let p=t.value.map(m=>m[h]).filter(m=>m!==0);for(let m=p.length-1;m>0;m--)p[m]===p[m-1]&&(p[m]*=2,e.value+=p[m],p.splice(m-1,1),y=!0,i.value={i:m,j:h,value:p[m]},setTimeout(()=>{i.value=null},300),l());const R=Array(4-p.length).fill(0).concat(p);for(let m=0;m<4;m++)t.value[m][h]!==R[m]&&(y=!0),t.value[m][h]=R[m]}return y},V=()=>{for(let y=0;y<4;y++)for(let h=0;h<4;h++)if(t.value[y][h]===0)return;for(let y=0;y<4;y++)for(let h=0;h<4;h++)if(h<3&&t.value[y][h]===t.value[y][h+1]||y<3&&t.value[y][h]===t.value[y+1][h])return;n.value=!0,e.value>s.value&&(s.value=e.value)},U=y=>{switch(y.key){case"ArrowLeft":b("left");break;case"ArrowRight":b("right");break;case"ArrowUp":b("up");break;case"ArrowDown":b("down");break}};return Be(()=>{d(),window.addEventListener("keydown",U),window.addEventListener("touchstart",v),window.addEventListener("touchend",T)}),et(()=>{window.removeEventListener("keydown",U),window.removeEventListener("touchstart",v),window.removeEventListener("touchend",T)}),(y,h)=>(K(),$("div",As,[M("div",Rs,[M("div",Ss,[M("div",Ls,[h[8]||(h[8]=M("span",{class:"score-label"},"分数",-1)),M("span",ks,q(e.value),1)]),M("div",Cs,[h[9]||(h[9]=M("span",{class:"score-label"},"最高分",-1)),M("span",Ds,q(s.value),1)])]),M("button",{class:"new-game-button",onClick:d},"新游戏")]),M("div",{class:Pe(["game-board",{"game-over":n.value}])},[(K(!0),$(Me,null,Te(t.value,(p,R)=>(K(),$("div",{key:R,class:"board-row"},[(K(!0),$(Me,null,Te(p,(m,ee)=>{var Q,Z,J,de,ie,ne;return K(),$("div",{key:ee,class:Pe(["board-cell",{[`cell-${m}`]:m!==0,empty:m===0,"cell-new":m===((Q=r.value)==null?void 0:Q.value)&&R===((Z=r.value)==null?void 0:Z.i)&&ee===((J=r.value)==null?void 0:J.j),"cell-merged":m===((de=i.value)==null?void 0:de.value)&&R===((ie=i.value)==null?void 0:ie.i)&&ee===((ne=i.value)==null?void 0:ne.j)}])},q(m||""),3)}),128))]))),128))],2),M("div",Is,[M("div",Ps,[M("div",{class:"key",onClick:h[0]||(h[0]=p=>b("up")),onTouchstart:h[1]||(h[1]=Ke(p=>b("up"),["prevent"]))},"↑",32)]),M("div",Ns,[M("div",{class:"key",onClick:h[2]||(h[2]=p=>b("left")),onTouchstart:h[3]||(h[3]=Ke(p=>b("left"),["prevent"]))},"←",32),M("div",{class:"key",onClick:h[4]||(h[4]=p=>b("down")),onTouchstart:h[5]||(h[5]=Ke(p=>b("down"),["prevent"]))},"↓",32),M("div",{class:"key",onClick:h[6]||(h[6]=p=>b("right")),onTouchstart:h[7]||(h[7]=Ke(p=>b("right"),["prevent"]))},"→",32)]),h[10]||(h[10]=M("div",{class:"controls-text"},"点击方向键或使用键盘移动方块",-1))]),o.value?(K(),$("div",Fs,q(a.value),1)):ke("",!0),n.value?(K(),$("div",Os,[h[11]||(h[11]=M("h2",null,"游戏结束",-1)),M("p",null,"最终得分: "+q(e.value),1),M("button",{onClick:d},"再玩一次")])):ke("",!0)]))}},Us=Ce(Hs,[["__scopeId","data-v-112f6cb7"]]),Bs={class:"snake-game"},zs={class:"game-header"},js={class:"scores"},Ks={class:"score"},$s={class:"score-value"},Vs={class:"score"},Ws={class:"score-value"},Xs={key:0,class:"game-over-message"},qs={key:1,class:"start-message"},Ve=20,We=20,Ys=150,Js={__name:"SnakeGame",setup(g){const t=D([]),e=D({x:0,y:0}),s=D("right"),n=D(0),a=D(0),o=D(!1),r=D(!1),i=D(null),c=D(""),l=D(!1),d=["这波吃豆子，我给满分！","吃豆子这么溜，你是贪吃蛇界的扛把子！","这操作，这意识，绝绝子！","吃豆子这么帅，你是游戏界的颜值担当！","这波吃豆子我给99分，多一分怕你骄傲！","吃豆子这么丝滑，你是游戏高手吧！"],f=()=>{c.value=d[Math.floor(Math.random()*d.length)],l.value=!0,setTimeout(()=>{l.value=!1},2e3)},w=()=>{t.value=[{x:10,y:10},{x:9,y:10},{x:8,y:10}],s.value="right",n.value=0,o.value=!1,r.value=!1,E()},E=()=>{let y;do y={x:Math.floor(Math.random()*Ve),y:Math.floor(Math.random()*Ve)};while(t.value.some(h=>h.x===y.x&&h.y===y.y));e.value=y},v=()=>{i.value||(r.value=!0,i.value=setInterval(b,Ys))},T=()=>{i.value&&(clearInterval(i.value),i.value=null,r.value=!1)},b=()=>{const y={...t.value[0]};switch(s.value){case"up":y.y--;break;case"down":y.y++;break;case"left":y.x--;break;case"right":y.x++;break}if(y.x<0||y.x>=Ve||y.y<0||y.y>=Ve||t.value.some(h=>h.x===y.x&&h.y===y.y)){k();return}t.value.unshift(y),y.x===e.value.x&&y.y===e.value.y?(n.value++,E(),f()):t.value.pop()},k=()=>{clearInterval(i.value),i.value=null,o.value=!0,n.value>a.value&&(a.value=n.value)},N=y=>{if(!r.value){v();return}switch(y.key){case"ArrowUp":s.value!=="down"&&(s.value="up");break;case"ArrowDown":s.value!=="up"&&(s.value="down");break;case"ArrowLeft":s.value!=="right"&&(s.value="left");break;case"ArrowRight":s.value!=="left"&&(s.value="right");break;case" ":r.value?T():v();break}};let A=0,F=0;const V=y=>{A=y.touches[0].clientX,F=y.touches[0].clientY},U=y=>{if(!r.value){v();return}const h=y.changedTouches[0].clientX,p=y.changedTouches[0].clientY,R=h-A,m=p-F;Math.abs(R)>Math.abs(m)?R>0&&s.value!=="left"?s.value="right":R<0&&s.value!=="right"&&(s.value="left"):m>0&&s.value!=="up"?s.value="down":m<0&&s.value!=="down"&&(s.value="up")};return Be(()=>{w(),window.addEventListener("keydown",N),window.addEventListener("touchstart",V),window.addEventListener("touchend",U)}),et(()=>{i.value&&clearInterval(i.value),window.removeEventListener("keydown",N),window.removeEventListener("touchstart",V),window.removeEventListener("touchend",U)}),(y,h)=>(K(),$("div",Bs,[M("div",zs,[M("div",js,[M("div",Ks,[h[1]||(h[1]=M("span",{class:"score-label"},"分数",-1)),M("span",$s,q(n.value),1)]),M("div",Vs,[h[2]||(h[2]=M("span",{class:"score-label"},"最高分",-1)),M("span",Ws,q(a.value),1)])]),M("button",{class:"control-button",onClick:h[0]||(h[0]=p=>r.value?T():v())},q(r.value?"暂停":"开始"),1)]),M("div",{class:Pe(["game-board",{"game-over":o.value}])},[(K(!0),$(Me,null,Te(t.value,p=>(K(),$("div",{key:`${p.x}-${p.y}`,class:"snake-segment",style:Se({left:`${p.x*We}px`,top:`${p.y*We}px`})},null,4))),128)),M("div",{class:"food",style:Se({left:`${e.value.x*We}px`,top:`${e.value.y*We}px`})},null,4)],2),o.value?(K(),$("div",Xs,[h[3]||(h[3]=M("h2",null,"游戏结束",-1)),M("p",null,"最终得分: "+q(n.value),1),M("button",{onClick:w},"再玩一次")])):ke("",!0),!r.value&&!o.value?(K(),$("div",qs,h[4]||(h[4]=[M("h2",null,"贪吃蛇",-1),M("p",null,"按空格键或点击屏幕开始游戏",-1),M("p",null,"使用方向键或滑动控制蛇的移动",-1)]))):ke("",!0)]))}},Zs=Ce(Js,[["__scopeId","data-v-077b0bbb"]]),Qs={class:"memory-game"},eo={class:"game-header"},to={class:"scores"},no={class:"score"},so={class:"score-value"},oo={class:"score"},ao={class:"score-value"},io=["onClick"],ro={class:"card-inner"},co={class:"card-back"},lo={key:0,class:"match-message"},uo={key:1,class:"game-over-message"},fo={__name:"MemoryGame",setup(g){const t=D([]),e=D([]),s=D(0),n=D(0),a=D(!1),o=D(0),r=D(""),i=D(!1),c=["🐶","🐱","🐭","🐹","🐰","🐻","🐼"],l=["这波翻牌，我给满分！","翻牌这么溜，你是记忆界的扛把子！","这操作，这意识，绝绝子！","翻牌这么帅，你是游戏界的颜值担当！","这波翻牌我给99分，多一分怕你骄傲！","翻牌这么丝滑，你是游戏高手吧！"],d=()=>{r.value=l[Math.floor(Math.random()*l.length)],i.value=!0,setTimeout(()=>{i.value=!1},2e3)},f=()=>{const E=[...c,...c];t.value=E.sort(()=>Math.random()-.5).map((v,T)=>({id:T,emoji:v,isFlipped:!1,isMatched:!1})),e.value=[],s.value=0,n.value=0,a.value=!1},w=E=>{if(!(E.isMatched||E.isFlipped||e.value.length>=2)&&(E.isFlipped=!0,e.value.push(E),e.value.length===2)){n.value++;const[v,T]=e.value;v.emoji===T.emoji?(v.isMatched=!0,T.isMatched=!0,s.value++,d(),s.value===c.length&&(a.value=!0,(n.value<o.value||o.value===0)&&(o.value=n.value)),e.value=[]):setTimeout(()=>{v.isFlipped=!1,T.isFlipped=!1,e.value=[]},1e3)}};return(E,v)=>(K(),$("div",Qs,[M("div",eo,[M("div",to,[M("div",no,[v[0]||(v[0]=M("span",{class:"score-label"},"步数",-1)),M("span",so,q(n.value),1)]),M("div",oo,[v[1]||(v[1]=M("span",{class:"score-label"},"最佳成绩",-1)),M("span",ao,q(o.value||"-"),1)])]),M("button",{class:"new-game-button",onClick:f},"新游戏")]),M("div",{class:Pe(["game-board",{"game-over":a.value}])},[(K(!0),$(Me,null,Te(t.value,T=>(K(),$("div",{key:T.id,class:Pe(["card",{flipped:T.isFlipped,matched:T.isMatched}]),onClick:b=>w(T)},[M("div",ro,[v[2]||(v[2]=M("div",{class:"card-front"},"?",-1)),M("div",co,q(T.emoji),1)])],10,io))),128))],2),i.value?(K(),$("div",lo,q(r.value),1)):ke("",!0),a.value?(K(),$("div",uo,[v[3]||(v[3]=M("h2",null,"恭喜！",-1)),M("p",null,"你用了 "+q(n.value)+" 步完成了游戏",1),M("button",{onClick:f},"再玩一次")])):ke("",!0)]))}},ho=Ce(fo,[["__scopeId","data-v-26b9557c"]]);class mo extends L{constructor(t,e={}){super(t),this.isWater=!0;const s=this,n=e.textureWidth!==void 0?e.textureWidth:512,a=e.textureHeight!==void 0?e.textureHeight:512,o=e.clipBias!==void 0?e.clipBias:0,r=e.alpha!==void 0?e.alpha:1,i=e.time!==void 0?e.time:0,c=e.waterNormals!==void 0?e.waterNormals:null,l=e.sunDirection!==void 0?e.sunDirection:new z(.70707,.70707,0),d=new ce(e.sunColor!==void 0?e.sunColor:16777215),f=new ce(e.waterColor!==void 0?e.waterColor:8355711),w=e.eye!==void 0?e.eye:new z(0,0,0),E=e.distortionScale!==void 0?e.distortionScale:20,v=e.side!==void 0?e.side:$t,T=e.fog!==void 0?e.fog:!1,b=new Un,k=new z,N=new z,A=new z,F=new Le,V=new z(0,0,-1),U=new kt,y=new z,h=new z,p=new kt,R=new Le,m=new vt,ee=new Bn(n,a),Q={name:"MirrorShader",uniforms:ut.merge([Ct.fog,Ct.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Le},sunColor:{value:new ce(8355711)},sunDirection:{value:new z(.70707,.70707,0)},eye:{value:new z},waterColor:{value:new ce(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>
					#include <fog_fragment>	
				}`},Z=new Vt({name:Q.name,uniforms:ut.clone(Q.uniforms),vertexShader:Q.vertexShader,fragmentShader:Q.fragmentShader,lights:!0,side:v,fog:T});Z.uniforms.mirrorSampler.value=ee.texture,Z.uniforms.textureMatrix.value=R,Z.uniforms.alpha.value=r,Z.uniforms.time.value=i,Z.uniforms.normalSampler.value=c,Z.uniforms.sunColor.value=d,Z.uniforms.waterColor.value=f,Z.uniforms.sunDirection.value=l,Z.uniforms.distortionScale.value=E,Z.uniforms.eye.value=w,s.material=Z,s.onBeforeRender=function(J,de,ie){if(N.setFromMatrixPosition(s.matrixWorld),A.setFromMatrixPosition(ie.matrixWorld),F.extractRotation(s.matrixWorld),k.set(0,0,1),k.applyMatrix4(F),y.subVectors(N,A),y.dot(k)>0)return;y.reflect(k).negate(),y.add(N),F.extractRotation(ie.matrixWorld),V.set(0,0,-1),V.applyMatrix4(F),V.add(A),h.subVectors(N,V),h.reflect(k).negate(),h.add(N),m.position.copy(y),m.up.set(0,1,0),m.up.applyMatrix4(F),m.up.reflect(k),m.lookAt(h),m.far=ie.far,m.updateMatrixWorld(),m.projectionMatrix.copy(ie.projectionMatrix),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(m.projectionMatrix),R.multiply(m.matrixWorldInverse),b.setFromNormalAndCoplanarPoint(k,N),b.applyMatrix4(m.matrixWorldInverse),U.set(b.normal.x,b.normal.y,b.normal.z,b.constant);const ne=m.projectionMatrix;p.x=(Math.sign(U.x)+ne.elements[8])/ne.elements[0],p.y=(Math.sign(U.y)+ne.elements[9])/ne.elements[5],p.z=-1,p.w=(1+ne.elements[10])/ne.elements[14],U.multiplyScalar(2/U.dot(p)),ne.elements[2]=U.x,ne.elements[6]=U.y,ne.elements[10]=U.z+1-o,ne.elements[14]=U.w,w.setFromMatrixPosition(ie.matrixWorld);const nt=J.getRenderTarget(),st=J.xr.enabled,ot=J.shadowMap.autoUpdate;s.visible=!1,J.xr.enabled=!1,J.shadowMap.autoUpdate=!1,J.setRenderTarget(ee),J.state.buffers.depth.setMask(!0),J.autoClear===!1&&J.clear(),J.render(de,m),s.visible=!0,J.xr.enabled=st,J.shadowMap.autoUpdate=ot,J.setRenderTarget(nt);const ze=ie.viewport;ze!==void 0&&J.state.viewport(ze)}}}class tt extends L{constructor(){const t=tt.SkyShader,e=new Vt({name:t.name,uniforms:ut.clone(t.uniforms),vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,side:zn,depthWrite:!1});super(new qe(1,1,1),e),this.isSky=!0}}tt.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new z},up:{value:new z(0,1,0)}},vertexShader:`
		uniform vec3 sunPosition;
		uniform float rayleigh;
		uniform float turbidity;
		uniform float mieCoefficient;
		uniform vec3 up;

		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		// constants for atmospheric scattering
		const float e = 2.71828182845904523536028747135266249775724709369995957;
		const float pi = 3.141592653589793238462643383279502884197169;

		// wavelength of used primaries, according to preetham
		const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
		// this pre-calculation replaces older TotalRayleigh(vec3 lambda) function:
		// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
		const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

		// mie stuff
		// K coefficient for the primaries
		const float v = 4.0;
		const vec3 K = vec3( 0.686, 0.678, 0.666 );
		// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
		const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

		// earth shadow hack
		// cutoffAngle = pi / 1.95;
		const float cutoffAngle = 1.6110731556870734;
		const float steepness = 1.5;
		const float EE = 1000.0;

		float sunIntensity( float zenithAngleCos ) {
			zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
			return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
		}

		vec3 totalMie( float T ) {
			float c = ( 0.2 * T ) * 10E-18;
			return 0.434 * c * MieConst;
		}

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			gl_Position.z = gl_Position.w; // set z to camera.far

			vSunDirection = normalize( sunPosition );

			vSunE = sunIntensity( dot( vSunDirection, up ) );

			vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

			float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

			// extinction (absorption + out scattering)
			// rayleigh coefficients
			vBetaR = totalRayleigh * rayleighCoefficient;

			// mie coefficients
			vBetaM = totalMie( turbidity ) * mieCoefficient;

		}`,fragmentShader:`
		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		uniform float mieDirectionalG;
		uniform vec3 up;

		// constants for atmospheric scattering
		const float pi = 3.141592653589793238462643383279502884197169;

		const float n = 1.0003; // refractive index of air
		const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

		// optical length at zenith for molecules
		const float rayleighZenithLength = 8.4E3;
		const float mieZenithLength = 1.25E3;
		// 66 arc seconds -> degrees, and the cosine of that
		const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

		// 3.0 / ( 16.0 * pi )
		const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
		// 1.0 / ( 4.0 * pi )
		const float ONE_OVER_FOURPI = 0.07957747154594767;

		float rayleighPhase( float cosTheta ) {
			return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
		}

		float hgPhase( float cosTheta, float g ) {
			float g2 = pow( g, 2.0 );
			float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
			return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
		}

		void main() {

			vec3 direction = normalize( vWorldPosition - cameraPosition );

			// optical length
			// cutoff angle at 90 to avoid singularity in next formula.
			float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
			float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
			float sR = rayleighZenithLength * inverse;
			float sM = mieZenithLength * inverse;

			// combined extinction factor
			vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

			// in scattering
			float cosTheta = dot( direction, vSunDirection );

			float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
			vec3 betaRTheta = vBetaR * rPhase;

			float mPhase = hgPhase( cosTheta, mieDirectionalG );
			vec3 betaMTheta = vBetaM * mPhase;

			vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
			Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

			// nightsky
			float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
			float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
			vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
			vec3 L0 = vec3( 0.1 ) * Fex;

			// composition + solar disc
			float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
			L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

			vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

			vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

			gl_FragColor = vec4( retColor, 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};function Gt(g,t){if(t===jn)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),g;if(t===dt||t===Wt){let e=g.getIndex();if(e===null){const o=[],r=g.getAttribute("position");if(r!==void 0){for(let i=0;i<r.count;i++)o.push(i);g.setIndex(o),e=g.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),g}const s=e.count-2,n=[];if(t===dt)for(let o=1;o<=s;o++)n.push(e.getX(0)),n.push(e.getX(o)),n.push(e.getX(o+1));else for(let o=0;o<s;o++)o%2===0?(n.push(e.getX(o)),n.push(e.getX(o+1)),n.push(e.getX(o+2))):(n.push(e.getX(o+2)),n.push(e.getX(o+1)),n.push(e.getX(o)));n.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=g.clone();return a.setIndex(n),a.clearGroups(),a}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),g}class po extends Xt{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new xo(e)}),this.register(function(e){return new Mo(e)}),this.register(function(e){return new ko(e)}),this.register(function(e){return new Co(e)}),this.register(function(e){return new Do(e)}),this.register(function(e){return new _o(e)}),this.register(function(e){return new bo(e)}),this.register(function(e){return new Eo(e)}),this.register(function(e){return new Ao(e)}),this.register(function(e){return new yo(e)}),this.register(function(e){return new Ro(e)}),this.register(function(e){return new To(e)}),this.register(function(e){return new Lo(e)}),this.register(function(e){return new So(e)}),this.register(function(e){return new vo(e)}),this.register(function(e){return new Io(e)}),this.register(function(e){return new Po(e)})}load(t,e,s,n){const a=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=He.extractUrlBase(t);o=He.resolveURL(c,this.path)}else o=He.extractUrlBase(t);this.manager.itemStart(t);const r=function(c){n?n(c):console.error(c),a.manager.itemError(t),a.manager.itemEnd(t)},i=new Ze(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,function(c){try{a.parse(c,o,function(l){e(l),a.manager.itemEnd(t)},r)}catch(l){r(l)}},s,r)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,s,n){let a;const o={},r={},i=new TextDecoder;if(typeof t=="string")a=JSON.parse(t);else if(t instanceof ArrayBuffer)if(i.decode(new Uint8Array(t,0,4))===on){try{o[O.KHR_BINARY_GLTF]=new No(t)}catch(d){n&&n(d);return}a=JSON.parse(o[O.KHR_BINARY_GLTF].content)}else a=JSON.parse(i.decode(t));else a=t;if(a.asset===void 0||a.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Xo(a,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const d=this.pluginCallbacks[l](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,o[d.name]=!0}if(a.extensionsUsed)for(let l=0;l<a.extensionsUsed.length;++l){const d=a.extensionsUsed[l],f=a.extensionsRequired||[];switch(d){case O.KHR_MATERIALS_UNLIT:o[d]=new wo;break;case O.KHR_DRACO_MESH_COMPRESSION:o[d]=new Fo(a,this.dracoLoader);break;case O.KHR_TEXTURE_TRANSFORM:o[d]=new Oo;break;case O.KHR_MESH_QUANTIZATION:o[d]=new Go;break;default:f.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(o),c.setPlugins(r),c.parse(s,n)}parseAsync(t,e){const s=this;return new Promise(function(n,a){s.parse(t,e,n,a)})}}function go(){let g={};return{get:function(t){return g[t]},add:function(t,e){g[t]=e},remove:function(t){delete g[t]},removeAll:function(){g={}}}}const O={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class vo{constructor(t){this.parser=t,this.name=O.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let s=0,n=e.length;s<n;s++){const a=e[s];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(t){const e=this.parser,s="light:"+t;let n=e.cache.get(s);if(n)return n;const a=e.json,i=((a.extensions&&a.extensions[this.name]||{}).lights||[])[t];let c;const l=new ce(16777215);i.color!==void 0&&l.setRGB(i.color[0],i.color[1],i.color[2],le);const d=i.range!==void 0?i.range:0;switch(i.type){case"directional":c=new Yt(l),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new $n(l),c.distance=d;break;case"spot":c=new Kn(l),c.distance=d,i.spot=i.spot||{},i.spot.innerConeAngle=i.spot.innerConeAngle!==void 0?i.spot.innerConeAngle:0,i.spot.outerConeAngle=i.spot.outerConeAngle!==void 0?i.spot.outerConeAngle:Math.PI/4,c.angle=i.spot.outerConeAngle,c.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return c.position.set(0,0,0),pe(c,i),i.intensity!==void 0&&(c.intensity=i.intensity),c.name=e.createUniqueName(i.name||"light_"+t),n=Promise.resolve(c),e.cache.add(s,n),n}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,s=this.parser,a=s.json.nodes[t],r=(a.extensions&&a.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(i){return s._getNodeRef(e.cache,r,i)})}}class wo{constructor(){this.name=O.KHR_MATERIALS_UNLIT}getMaterialType(){return De}extendParams(t,e,s){const n=[];t.color=new ce(1,1,1),t.opacity=1;const a=e.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const o=a.baseColorFactor;t.color.setRGB(o[0],o[1],o[2],le),t.opacity=o[3]}a.baseColorTexture!==void 0&&n.push(s.assignTexture(t,"map",a.baseColorTexture,ye))}return Promise.all(n)}}class yo{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=n.extensions[this.name].emissiveStrength;return a!==void 0&&(e.emissiveIntensity=a),Promise.resolve()}}class xo{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&a.push(s.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&a.push(s.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(a.push(s.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const r=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new qt(r,r)}return Promise.all(a)}}class Mo{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_DISPERSION}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=n.extensions[this.name];return e.dispersion=a.dispersion!==void 0?a.dispersion:0,Promise.resolve()}}class To{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&a.push(s.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&a.push(s.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(a)}}class _o{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_SHEEN}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[];e.sheenColor=new ce(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const r=o.sheenColorFactor;e.sheenColor.setRGB(r[0],r[1],r[2],le)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&a.push(s.assignTexture(e,"sheenColorMap",o.sheenColorTexture,ye)),o.sheenRoughnessTexture!==void 0&&a.push(s.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(a)}}class bo{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&a.push(s.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(a)}}class Eo{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_VOLUME}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],o=n.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&a.push(s.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const r=o.attenuationColor||[1,1,1];return e.attenuationColor=new ce().setRGB(r[0],r[1],r[2],le),Promise.all(a)}}class Ao{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_IOR}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=n.extensions[this.name];return e.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class Ro{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_SPECULAR}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],o=n.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&a.push(s.assignTexture(e,"specularIntensityMap",o.specularTexture));const r=o.specularColorFactor||[1,1,1];return e.specularColor=new ce().setRGB(r[0],r[1],r[2],le),o.specularColorTexture!==void 0&&a.push(s.assignTexture(e,"specularColorMap",o.specularColorTexture,ye)),Promise.all(a)}}class So{constructor(t){this.parser=t,this.name=O.EXT_MATERIALS_BUMP}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],o=n.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&a.push(s.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(a)}}class Lo{constructor(t){this.parser=t,this.name=O.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const s=this.parser.json.materials[t];return!s.extensions||!s.extensions[this.name]?null:ue}extendMaterialParams(t,e){const s=this.parser,n=s.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const a=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&a.push(s.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(a)}}class ko{constructor(t){this.parser=t,this.name=O.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,s=e.json,n=s.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const a=n.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,a.source,o)}}class Co{constructor(t){this.parser=t,this.name=O.EXT_TEXTURE_WEBP}loadTexture(t){const e=this.name,s=this.parser,n=s.json,a=n.textures[t];if(!a.extensions||!a.extensions[e])return null;const o=a.extensions[e],r=n.images[o.source];let i=s.textureLoader;if(r.uri){const c=s.options.manager.getHandler(r.uri);c!==null&&(i=c)}return s.loadTextureImage(t,o.source,i)}}class Do{constructor(t){this.parser=t,this.name=O.EXT_TEXTURE_AVIF}loadTexture(t){const e=this.name,s=this.parser,n=s.json,a=n.textures[t];if(!a.extensions||!a.extensions[e])return null;const o=a.extensions[e],r=n.images[o.source];let i=s.textureLoader;if(r.uri){const c=s.options.manager.getHandler(r.uri);c!==null&&(i=c)}return s.loadTextureImage(t,o.source,i)}}class Io{constructor(t){this.name=O.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,s=e.bufferViews[t];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],a=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(r){const i=n.byteOffset||0,c=n.byteLength||0,l=n.count,d=n.byteStride,f=new Uint8Array(r,i,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(l,d,f,n.mode,n.filter).then(function(w){return w.buffer}):o.ready.then(function(){const w=new ArrayBuffer(l*d);return o.decodeGltfBuffer(new Uint8Array(w),l,d,f,n.mode,n.filter),w})})}else return null}}class Po{constructor(t){this.name=O.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,s=e.nodes[t];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const n=e.meshes[s.mesh];for(const c of n.primitives)if(c.mode!==re.TRIANGLES&&c.mode!==re.TRIANGLE_STRIP&&c.mode!==re.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=s.extensions[this.name].attributes,r=[],i={};for(const c in o)r.push(this.parser.getDependency("accessor",o[c]).then(l=>(i[c]=l,i[c])));return r.length<1?null:(r.push(this.parser.createNodeMesh(t)),Promise.all(r).then(c=>{const l=c.pop(),d=l.isGroup?l.children:[l],f=c[0].count,w=[];for(const E of d){const v=new Le,T=new z,b=new Jt,k=new z(1,1,1),N=new Vn(E.geometry,E.material,f);for(let A=0;A<f;A++)i.TRANSLATION&&T.fromBufferAttribute(i.TRANSLATION,A),i.ROTATION&&b.fromBufferAttribute(i.ROTATION,A),i.SCALE&&k.fromBufferAttribute(i.SCALE,A),N.setMatrixAt(A,v.compose(T,b,k));for(const A in i)if(A==="_COLOR_0"){const F=i[A];N.instanceColor=new Wn(F.array,F.itemSize,F.normalized)}else A!=="TRANSLATION"&&A!=="ROTATION"&&A!=="SCALE"&&E.geometry.setAttribute(A,i[A]);Zt.prototype.copy.call(N,E),this.parser.assignFinalMaterial(N),w.push(N)}return l.isGroup?(l.clear(),l.add(...w),l):w[0]}))}}const on="glTF",Oe=12,Ht={JSON:1313821514,BIN:5130562};class No{constructor(t){this.name=O.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,Oe),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==on)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Oe,a=new DataView(t,Oe);let o=0;for(;o<n;){const r=a.getUint32(o,!0);o+=4;const i=a.getUint32(o,!0);if(o+=4,i===Ht.JSON){const c=new Uint8Array(t,Oe+o,r);this.content=s.decode(c)}else if(i===Ht.BIN){const c=Oe+o;this.body=t.slice(c,c+r)}o+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Fo{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=O.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const s=this.json,n=this.dracoLoader,a=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,r={},i={},c={};for(const l in o){const d=pt[l]||l.toLowerCase();r[d]=o[l]}for(const l in t.attributes){const d=pt[l]||l.toLowerCase();if(o[l]!==void 0){const f=s.accessors[t.attributes[l]],w=Ie[f.componentType];c[d]=w.name,i[d]=f.normalized===!0}}return e.getDependency("bufferView",a).then(function(l){return new Promise(function(d,f){n.decodeDracoFile(l,function(w){for(const E in w.attributes){const v=w.attributes[E],T=i[E];T!==void 0&&(v.normalized=T)}d(w)},r,c,le,f)})})}}class Oo{constructor(){this.name=O.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class Go{constructor(){this.name=O.KHR_MESH_QUANTIZATION}}class an extends hs{constructor(t,e,s,n){super(t,e,s,n)}copySampleValue_(t){const e=this.resultBuffer,s=this.sampleValues,n=this.valueSize,a=t*n*3+n;for(let o=0;o!==n;o++)e[o]=s[a+o];return e}interpolate_(t,e,s,n){const a=this.resultBuffer,o=this.sampleValues,r=this.valueSize,i=r*2,c=r*3,l=n-e,d=(s-e)/l,f=d*d,w=f*d,E=t*c,v=E-c,T=-2*w+3*f,b=w-f,k=1-T,N=b-f+d;for(let A=0;A!==r;A++){const F=o[v+A+r],V=o[v+A+i]*l,U=o[E+A+r],y=o[E+A]*l;a[A]=k*F+N*V+T*U+b*y}return a}}const Ho=new Jt;class Uo extends an{interpolate_(t,e,s,n){const a=super.interpolate_(t,e,s,n);return Ho.fromArray(a).normalize().toArray(a),a}}const re={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ie={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ut={9728:tn,9729:ft,9984:Zn,9985:Jn,9986:Yn,9987:en},Bt={33071:es,33648:Qn,10497:Qe},it={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},we={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Bo={CUBICSPLINE:void 0,LINEAR:sn,STEP:ds},rt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function zo(g){return g.DefaultMaterial===void 0&&(g.DefaultMaterial=new nn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:$t})),g.DefaultMaterial}function Re(g,t,e){for(const s in e.extensions)g[s]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[s]=e.extensions[s])}function pe(g,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(g.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function jo(g,t,e){let s=!1,n=!1,a=!1;for(let c=0,l=t.length;c<l;c++){const d=t[c];if(d.POSITION!==void 0&&(s=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(a=!0),s&&n&&a)break}if(!s&&!n&&!a)return Promise.resolve(g);const o=[],r=[],i=[];for(let c=0,l=t.length;c<l;c++){const d=t[c];if(s){const f=d.POSITION!==void 0?e.getDependency("accessor",d.POSITION):g.attributes.position;o.push(f)}if(n){const f=d.NORMAL!==void 0?e.getDependency("accessor",d.NORMAL):g.attributes.normal;r.push(f)}if(a){const f=d.COLOR_0!==void 0?e.getDependency("accessor",d.COLOR_0):g.attributes.color;i.push(f)}}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(i)]).then(function(c){const l=c[0],d=c[1],f=c[2];return s&&(g.morphAttributes.position=l),n&&(g.morphAttributes.normal=d),a&&(g.morphAttributes.color=f),g.morphTargetsRelative=!0,g})}function Ko(g,t){if(g.updateMorphTargets(),t.weights!==void 0)for(let e=0,s=t.weights.length;e<s;e++)g.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(g.morphTargetInfluences.length===e.length){g.morphTargetDictionary={};for(let s=0,n=e.length;s<n;s++)g.morphTargetDictionary[e[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function $o(g){let t;const e=g.extensions&&g.extensions[O.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+ct(e.attributes):t=g.indices+":"+ct(g.attributes)+":"+g.mode,g.targets!==void 0)for(let s=0,n=g.targets.length;s<n;s++)t+=":"+ct(g.targets[s]);return t}function ct(g){let t="";const e=Object.keys(g).sort();for(let s=0,n=e.length;s<n;s++)t+=e[s]+":"+g[e[s]]+";";return t}function gt(g){switch(g){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Vo(g){return g.search(/\.jpe?g($|\?)/i)>0||g.search(/^data\:image\/jpeg/)===0?"image/jpeg":g.search(/\.webp($|\?)/i)>0||g.search(/^data\:image\/webp/)===0?"image/webp":g.search(/\.ktx2($|\?)/i)>0||g.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Wo=new Le;class Xo{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new go,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=-1,a=!1,o=-1;if(typeof navigator<"u"){const r=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(r)===!0;const i=r.match(/Version\/(\d+)/);n=s&&i?parseInt(i[1],10):-1,a=r.indexOf("Firefox")>-1,o=a?r.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&n<17||a&&o<98?this.textureLoader=new Qt(this.options.manager):this.textureLoader=new Xn(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ze(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const s=this,n=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const r={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:s,userData:{}};return Re(a,r,n),pe(r,n),Promise.all(s._invokeAll(function(i){return i.afterRoot&&i.afterRoot(r)})).then(function(){for(const i of r.scenes)i.updateMatrixWorld();t(r)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],s=this.json.meshes||[];for(let n=0,a=e.length;n<a;n++){const o=e[n].joints;for(let r=0,i=o.length;r<i;r++)t[o[r]].isBone=!0}for(let n=0,a=t.length;n<a;n++){const o=t[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,s){if(t.refs[e]<=1)return s;const n=s.clone(),a=(o,r)=>{const i=this.associations.get(o);i!=null&&this.associations.set(r,i);for(const[c,l]of o.children.entries())a(l,r.children[c])};return a(s,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let s=0;s<e.length;s++){const n=t(e[s]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const s=[];for(let n=0;n<e.length;n++){const a=t(e[n]);a&&s.push(a)}return s}getDependency(t,e){const s=t+":"+e;let n=this.cache.get(s);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this._invokeOne(function(a){return a.loadNode&&a.loadNode(e)});break;case"mesh":n=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(e)});break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(e)});break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(e)});break;case"texture":n=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(e)});break;case"skin":n=this.loadSkin(e);break;case"animation":n=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(e)});break;case"camera":n=this.loadCamera(e);break;default:if(n=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(t,e)}),!n)throw new Error("Unknown type: "+t);break}this.cache.add(s,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const s=this,n=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(n.map(function(a,o){return s.getDependency(t,o)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],s=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[O.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(a,o){s.load(He.resolveURL(e.uri,n.path),a,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(s){const n=e.byteLength||0,a=e.byteOffset||0;return s.slice(a,a+n)})}loadAccessor(t){const e=this,s=this.json,n=this.json.accessors[t];if(n.bufferView===void 0&&n.sparse===void 0){const o=it[n.type],r=Ie[n.componentType],i=n.normalized===!0,c=new r(n.count*o);return Promise.resolve(new xe(c,o,i))}const a=[];return n.bufferView!==void 0?a.push(this.getDependency("bufferView",n.bufferView)):a.push(null),n.sparse!==void 0&&(a.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(a).then(function(o){const r=o[0],i=it[n.type],c=Ie[n.componentType],l=c.BYTES_PER_ELEMENT,d=l*i,f=n.byteOffset||0,w=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,E=n.normalized===!0;let v,T;if(w&&w!==d){const b=Math.floor(f/w),k="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+b+":"+n.count;let N=e.cache.get(k);N||(v=new c(r,b*w,n.count*w/l),N=new qn(v,w/l),e.cache.add(k,N)),T=new fs(N,i,f%w/l,E)}else r===null?v=new c(n.count*i):v=new c(r,f,n.count*i),T=new xe(v,i,E);if(n.sparse!==void 0){const b=it.SCALAR,k=Ie[n.sparse.indices.componentType],N=n.sparse.indices.byteOffset||0,A=n.sparse.values.byteOffset||0,F=new k(o[1],N,n.sparse.count*b),V=new c(o[2],A,n.sparse.count*i);r!==null&&(T=new xe(T.array.slice(),T.itemSize,T.normalized)),T.normalized=!1;for(let U=0,y=F.length;U<y;U++){const h=F[U];if(T.setX(h,V[U*i]),i>=2&&T.setY(h,V[U*i+1]),i>=3&&T.setZ(h,V[U*i+2]),i>=4&&T.setW(h,V[U*i+3]),i>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}T.normalized=E}return T})}loadTexture(t){const e=this.json,s=this.options,a=e.textures[t].source,o=e.images[a];let r=this.textureLoader;if(o.uri){const i=s.manager.getHandler(o.uri);i!==null&&(r=i)}return this.loadTextureImage(t,a,r)}loadTextureImage(t,e,s){const n=this,a=this.json,o=a.textures[t],r=a.images[e],i=(r.uri||r.bufferView)+":"+o.sampler;if(this.textureCache[i])return this.textureCache[i];const c=this.loadImageSource(e,s).then(function(l){l.flipY=!1,l.name=o.name||r.name||"",l.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(l.name=r.uri);const f=(a.samplers||{})[o.sampler]||{};return l.magFilter=Ut[f.magFilter]||ft,l.minFilter=Ut[f.minFilter]||en,l.wrapS=Bt[f.wrapS]||Qe,l.wrapT=Bt[f.wrapT]||Qe,l.generateMipmaps=!l.isCompressedTexture&&l.minFilter!==tn&&l.minFilter!==ft,n.associations.set(l,{textures:t}),l}).catch(function(){return null});return this.textureCache[i]=c,c}loadImageSource(t,e){const s=this,n=this.json,a=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(d=>d.clone());const o=n.images[t],r=self.URL||self.webkitURL;let i=o.uri||"",c=!1;if(o.bufferView!==void 0)i=s.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const f=new Blob([d],{type:o.mimeType});return i=r.createObjectURL(f),i});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const l=Promise.resolve(i).then(function(d){return new Promise(function(f,w){let E=f;e.isImageBitmapLoader===!0&&(E=function(v){const T=new Dt(v);T.needsUpdate=!0,f(T)}),e.load(He.resolveURL(d,a.path),E,void 0,w)})}).then(function(d){return c===!0&&r.revokeObjectURL(i),pe(d,o),d.userData.mimeType=o.mimeType||Vo(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",i),d});return this.sourceCache[t]=l,l}assignTexture(t,e,s,n){const a=this;return this.getDependency("texture",s.index).then(function(o){if(!o)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(o=o.clone(),o.channel=s.texCoord),a.extensions[O.KHR_TEXTURE_TRANSFORM]){const r=s.extensions!==void 0?s.extensions[O.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const i=a.associations.get(o);o=a.extensions[O.KHR_TEXTURE_TRANSFORM].extendTexture(o,r),a.associations.set(o,i)}}return n!==void 0&&(o.colorSpace=n),t[e]=o,o})}assignFinalMaterial(t){const e=t.geometry;let s=t.material;const n=e.attributes.tangent===void 0,a=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(t.isPoints){const r="PointsMaterial:"+s.uuid;let i=this.cache.get(r);i||(i=new Ye,at.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,i.sizeAttenuation=!1,this.cache.add(r,i)),s=i}else if(t.isLine){const r="LineBasicMaterial:"+s.uuid;let i=this.cache.get(r);i||(i=new ts,at.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,this.cache.add(r,i)),s=i}if(n||a||o){let r="ClonedMaterial:"+s.uuid+":";n&&(r+="derivative-tangents:"),a&&(r+="vertex-colors:"),o&&(r+="flat-shading:");let i=this.cache.get(r);i||(i=s.clone(),a&&(i.vertexColors=!0),o&&(i.flatShading=!0),n&&(i.normalScale&&(i.normalScale.y*=-1),i.clearcoatNormalScale&&(i.clearcoatNormalScale.y*=-1)),this.cache.add(r,i),this.associations.set(i,this.associations.get(s))),s=i}t.material=s}getMaterialType(){return nn}loadMaterial(t){const e=this,s=this.json,n=this.extensions,a=s.materials[t];let o;const r={},i=a.extensions||{},c=[];if(i[O.KHR_MATERIALS_UNLIT]){const d=n[O.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(r,a,e))}else{const d=a.pbrMetallicRoughness||{};if(r.color=new ce(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;r.color.setRGB(f[0],f[1],f[2],le),r.opacity=f[3]}d.baseColorTexture!==void 0&&c.push(e.assignTexture(r,"map",d.baseColorTexture,ye)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(e.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),c.push(e.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(t,r)})))}a.doubleSided===!0&&(r.side=Ge);const l=a.alphaMode||rt.OPAQUE;if(l===rt.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,l===rt.MASK&&(r.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&o!==De&&(c.push(e.assignTexture(r,"normalMap",a.normalTexture)),r.normalScale=new qt(1,1),a.normalTexture.scale!==void 0)){const d=a.normalTexture.scale;r.normalScale.set(d,d)}if(a.occlusionTexture!==void 0&&o!==De&&(c.push(e.assignTexture(r,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&o!==De){const d=a.emissiveFactor;r.emissive=new ce().setRGB(d[0],d[1],d[2],le)}return a.emissiveTexture!==void 0&&o!==De&&c.push(e.assignTexture(r,"emissiveMap",a.emissiveTexture,ye)),Promise.all(c).then(function(){const d=new o(r);return a.name&&(d.name=a.name),pe(d,a),e.associations.set(d,{materials:t}),a.extensions&&Re(n,d,a),d})}createUniqueName(t){const e=ns.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,s=this.extensions,n=this.primitiveCache;function a(r){return s[O.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,e).then(function(i){return zt(i,r,e)})}const o=[];for(let r=0,i=t.length;r<i;r++){const c=t[r],l=$o(c),d=n[l];if(d)o.push(d.promise);else{let f;c.extensions&&c.extensions[O.KHR_DRACO_MESH_COMPRESSION]?f=a(c):f=zt(new Ue,c,e),n[l]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(t){const e=this,s=this.json,n=this.extensions,a=s.meshes[t],o=a.primitives,r=[];for(let i=0,c=o.length;i<c;i++){const l=o[i].material===void 0?zo(this.cache):this.getDependency("material",o[i].material);r.push(l)}return r.push(e.loadGeometries(o)),Promise.all(r).then(function(i){const c=i.slice(0,i.length-1),l=i[i.length-1],d=[];for(let w=0,E=l.length;w<E;w++){const v=l[w],T=o[w];let b;const k=c[w];if(T.mode===re.TRIANGLES||T.mode===re.TRIANGLE_STRIP||T.mode===re.TRIANGLE_FAN||T.mode===void 0)b=a.isSkinnedMesh===!0?new ss(v,k):new L(v,k),b.isSkinnedMesh===!0&&b.normalizeSkinWeights(),T.mode===re.TRIANGLE_STRIP?b.geometry=Gt(b.geometry,Wt):T.mode===re.TRIANGLE_FAN&&(b.geometry=Gt(b.geometry,dt));else if(T.mode===re.LINES)b=new os(v,k);else if(T.mode===re.LINE_STRIP)b=new as(v,k);else if(T.mode===re.LINE_LOOP)b=new is(v,k);else if(T.mode===re.POINTS)b=new Je(v,k);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+T.mode);Object.keys(b.geometry.morphAttributes).length>0&&Ko(b,a),b.name=e.createUniqueName(a.name||"mesh_"+t),pe(b,a),T.extensions&&Re(n,b,T),e.assignFinalMaterial(b),d.push(b)}for(let w=0,E=d.length;w<E;w++)e.associations.set(d[w],{meshes:t,primitives:w});if(d.length===1)return a.extensions&&Re(n,d[0],a),d[0];const f=new ae;a.extensions&&Re(n,f,a),e.associations.set(f,{meshes:t});for(let w=0,E=d.length;w<E;w++)f.add(d[w]);return f})}loadCamera(t){let e;const s=this.json.cameras[t],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?e=new vt(ht.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(e=new rs(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(e.name=this.createUniqueName(s.name)),pe(e,s),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],s=[];for(let n=0,a=e.joints.length;n<a;n++)s.push(this._loadNodeShallow(e.joints[n]));return e.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",e.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(n){const a=n.pop(),o=n,r=[],i=[];for(let c=0,l=o.length;c<l;c++){const d=o[c];if(d){r.push(d);const f=new Le;a!==null&&f.fromArray(a.array,c*16),i.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[c])}return new cs(r,i)})}loadAnimation(t){const e=this.json,s=this,n=e.animations[t],a=n.name?n.name:"animation_"+t,o=[],r=[],i=[],c=[],l=[];for(let d=0,f=n.channels.length;d<f;d++){const w=n.channels[d],E=n.samplers[w.sampler],v=w.target,T=v.node,b=n.parameters!==void 0?n.parameters[E.input]:E.input,k=n.parameters!==void 0?n.parameters[E.output]:E.output;v.node!==void 0&&(o.push(this.getDependency("node",T)),r.push(this.getDependency("accessor",b)),i.push(this.getDependency("accessor",k)),c.push(E),l.push(v))}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(i),Promise.all(c),Promise.all(l)]).then(function(d){const f=d[0],w=d[1],E=d[2],v=d[3],T=d[4],b=[];for(let k=0,N=f.length;k<N;k++){const A=f[k],F=w[k],V=E[k],U=v[k],y=T[k];if(A===void 0)continue;A.updateMatrix&&A.updateMatrix();const h=s._createAnimationTracks(A,F,V,U,y);if(h)for(let p=0;p<h.length;p++)b.push(h[p])}return new ls(a,void 0,b)})}createNodeMesh(t){const e=this.json,s=this,n=e.nodes[t];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(a){const o=s._getNodeRef(s.meshCache,n.mesh,a);return n.weights!==void 0&&o.traverse(function(r){if(r.isMesh)for(let i=0,c=n.weights.length;i<c;i++)r.morphTargetInfluences[i]=n.weights[i]}),o})}loadNode(t){const e=this.json,s=this,n=e.nodes[t],a=s._loadNodeShallow(t),o=[],r=n.children||[];for(let c=0,l=r.length;c<l;c++)o.push(s.getDependency("node",r[c]));const i=n.skin===void 0?Promise.resolve(null):s.getDependency("skin",n.skin);return Promise.all([a,Promise.all(o),i]).then(function(c){const l=c[0],d=c[1],f=c[2];f!==null&&l.traverse(function(w){w.isSkinnedMesh&&w.bind(f,Wo)});for(let w=0,E=d.length;w<E;w++)l.add(d[w]);return l})}_loadNodeShallow(t){const e=this.json,s=this.extensions,n=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const a=e.nodes[t],o=a.name?n.createUniqueName(a.name):"",r=[],i=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(t)});return i&&r.push(i),a.camera!==void 0&&r.push(n.getDependency("camera",a.camera).then(function(c){return n._getNodeRef(n.cameraCache,a.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(t)}).forEach(function(c){r.push(c)}),this.nodeCache[t]=Promise.all(r).then(function(c){let l;if(a.isBone===!0?l=new us:c.length>1?l=new ae:c.length===1?l=c[0]:l=new Zt,l!==c[0])for(let d=0,f=c.length;d<f;d++)l.add(c[d]);if(a.name&&(l.userData.name=a.name,l.name=o),pe(l,a),a.extensions&&Re(s,l,a),a.matrix!==void 0){const d=new Le;d.fromArray(a.matrix),l.applyMatrix4(d)}else a.translation!==void 0&&l.position.fromArray(a.translation),a.rotation!==void 0&&l.quaternion.fromArray(a.rotation),a.scale!==void 0&&l.scale.fromArray(a.scale);if(!n.associations.has(l))n.associations.set(l,{});else if(a.mesh!==void 0&&n.meshCache.refs[a.mesh]>1){const d=n.associations.get(l);n.associations.set(l,{...d})}return n.associations.get(l).nodes=t,l}),this.nodeCache[t]}loadScene(t){const e=this.extensions,s=this.json.scenes[t],n=this,a=new ae;s.name&&(a.name=n.createUniqueName(s.name)),pe(a,s),s.extensions&&Re(e,a,s);const o=s.nodes||[],r=[];for(let i=0,c=o.length;i<c;i++)r.push(n.getDependency("node",o[i]));return Promise.all(r).then(function(i){for(let l=0,d=i.length;l<d;l++)a.add(i[l]);const c=l=>{const d=new Map;for(const[f,w]of n.associations)(f instanceof at||f instanceof Dt)&&d.set(f,w);return l.traverse(f=>{const w=n.associations.get(f);w!=null&&d.set(f,w)}),d};return n.associations=c(a),a})}_createAnimationTracks(t,e,s,n,a){const o=[],r=t.name?t.name:t.uuid,i=[];we[a.path]===we.weights?t.traverse(function(f){f.morphTargetInfluences&&i.push(f.name?f.name:f.uuid)}):i.push(r);let c;switch(we[a.path]){case we.weights:c=Pt;break;case we.rotation:c=Nt;break;case we.translation:case we.scale:c=It;break;default:switch(s.itemSize){case 1:c=Pt;break;case 2:case 3:default:c=It;break}break}const l=n.interpolation!==void 0?Bo[n.interpolation]:sn,d=this._getArrayFromAccessor(s);for(let f=0,w=i.length;f<w;f++){const E=new c(i[f]+"."+we[a.path],e.array,d,l);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(E),o.push(E)}return o}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const s=gt(e.constructor),n=new Float32Array(e.length);for(let a=0,o=e.length;a<o;a++)n[a]=e[a]*s;e=n}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(s){const n=this instanceof Nt?Uo:an;return new n(this.times,this.values,this.getValueSize()/3,s)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function qo(g,t,e){const s=t.attributes,n=new ms;if(s.POSITION!==void 0){const r=e.json.accessors[s.POSITION],i=r.min,c=r.max;if(i!==void 0&&c!==void 0){if(n.set(new z(i[0],i[1],i[2]),new z(c[0],c[1],c[2])),r.normalized){const l=gt(Ie[r.componentType]);n.min.multiplyScalar(l),n.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const a=t.targets;if(a!==void 0){const r=new z,i=new z;for(let c=0,l=a.length;c<l;c++){const d=a[c];if(d.POSITION!==void 0){const f=e.json.accessors[d.POSITION],w=f.min,E=f.max;if(w!==void 0&&E!==void 0){if(i.setX(Math.max(Math.abs(w[0]),Math.abs(E[0]))),i.setY(Math.max(Math.abs(w[1]),Math.abs(E[1]))),i.setZ(Math.max(Math.abs(w[2]),Math.abs(E[2]))),f.normalized){const v=gt(Ie[f.componentType]);i.multiplyScalar(v)}r.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(r)}g.boundingBox=n;const o=new ps;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,g.boundingSphere=o}function zt(g,t,e){const s=t.attributes,n=[];function a(o,r){return e.getDependency("accessor",o).then(function(i){g.setAttribute(r,i)})}for(const o in s){const r=pt[o]||o.toLowerCase();r in g.attributes||n.push(a(s[o],r))}if(t.indices!==void 0&&!g.index){const o=e.getDependency("accessor",t.indices).then(function(r){g.setIndex(r)});n.push(o)}return mt.workingColorSpace!==le&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${mt.workingColorSpace}" not supported.`),pe(g,t),qo(g,t,e),Promise.all(n).then(function(){return t.targets!==void 0?jo(g,t.targets,e):g})}const lt=new WeakMap;class Yo extends Xt{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,s,n){const a=new Ze(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,o=>{this.parse(o,e,n)},s,n)}parse(t,e,s=()=>{}){this.decodeDracoFile(t,e,null,null,ye,s).catch(s)}decodeDracoFile(t,e,s,n,a=le,o=()=>{}){const r={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:a};return this.decodeGeometry(t,r).then(e).catch(o)}decodeGeometry(t,e){const s=JSON.stringify(e);if(lt.has(t)){const i=lt.get(t);if(i.key===s)return i.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const a=this.workerNextTaskID++,o=t.byteLength,r=this._getWorker(a,o).then(i=>(n=i,new Promise((c,l)=>{n._callbacks[a]={resolve:c,reject:l},n.postMessage({type:"decode",id:a,taskConfig:e,buffer:t},[t])}))).then(i=>this._createGeometry(i.geometry));return r.catch(()=>!0).then(()=>{n&&a&&this._releaseTask(n,a)}),lt.set(t,{key:s,promise:r}),r}_createGeometry(t){const e=new Ue;t.index&&e.setIndex(new xe(t.index.array,1));for(let s=0;s<t.attributes.length;s++){const n=t.attributes[s],a=n.name,o=n.array,r=n.itemSize,i=new xe(o,r);a==="color"&&(this._assignVertexColorSpace(i,n.vertexColorSpace),i.normalized=!(o instanceof Float32Array)),e.setAttribute(a,i)}return e}_assignVertexColorSpace(t,e){if(e!==ye)return;const s=new ce;for(let n=0,a=t.count;n<a;n++)s.fromBufferAttribute(t,n),mt.colorSpaceToWorking(s,ye),t.setXYZ(n,s.r,s.g,s.b)}_loadLibrary(t,e){const s=new Ze(this.manager);return s.setPath(this.decoderPath),s.setResponseType(e),s.setWithCredentials(this.withCredentials),new Promise((n,a)=>{s.load(t,n,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(s=>{const n=s[0];t||(this.decoderConfig.wasmBinary=s[1]);const a=Jo.toString(),o=["/* draco decoder */",n,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(a){const o=a.data;switch(o.type){case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,a){return n._taskLoad>a._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[t]=e,s._taskLoad+=e,s})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Jo(){let g,t;onmessage=function(o){const r=o.data;switch(r.type){case"init":g=r.decoderConfig,t=new Promise(function(l){g.onModuleLoaded=function(d){l({draco:d})},DracoDecoderModule(g)});break;case"decode":const i=r.buffer,c=r.taskConfig;t.then(l=>{const d=l.draco,f=new d.Decoder;try{const w=e(d,f,new Int8Array(i),c),E=w.attributes.map(v=>v.array.buffer);w.index&&E.push(w.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:w},E)}catch(w){console.error(w),self.postMessage({type:"error",id:r.id,error:w.message})}finally{d.destroy(f)}});break}};function e(o,r,i,c){const l=c.attributeIDs,d=c.attributeTypes;let f,w;const E=r.GetEncodedGeometryType(i);if(E===o.TRIANGULAR_MESH)f=new o.Mesh,w=r.DecodeArrayToMesh(i,i.byteLength,f);else if(E===o.POINT_CLOUD)f=new o.PointCloud,w=r.DecodeArrayToPointCloud(i,i.byteLength,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!w.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+w.error_msg());const v={index:null,attributes:[]};for(const T in l){const b=self[d[T]];let k,N;if(c.useUniqueIDs)N=l[T],k=r.GetAttributeByUniqueId(f,N);else{if(N=r.GetAttributeId(f,o[l[T]]),N===-1)continue;k=r.GetAttribute(f,N)}const A=n(o,r,f,T,b,k);T==="color"&&(A.vertexColorSpace=c.vertexColorSpace),v.attributes.push(A)}return E===o.TRIANGULAR_MESH&&(v.index=s(o,r,f)),o.destroy(f),v}function s(o,r,i){const l=i.num_faces()*3,d=l*4,f=o._malloc(d);r.GetTrianglesUInt32Array(i,d,f);const w=new Uint32Array(o.HEAPF32.buffer,f,l).slice();return o._free(f),{array:w,itemSize:1}}function n(o,r,i,c,l,d){const f=d.num_components(),E=i.num_points()*f,v=E*l.BYTES_PER_ELEMENT,T=a(o,l),b=o._malloc(v);r.GetAttributeDataArrayForAllPoints(i,d,T,v,b);const k=new l(o.HEAPF32.buffer,b,E).slice();return o._free(b),{name:c,array:k,itemSize:f}}function a(o,r){switch(r){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}const Zo={class:"boat-game"},Qo={class:"controls"},ea={class:"weather-controls"},ta={key:0},na={key:1},sa={__name:"BoatGame",setup(g){const t=D(null),e=D(!1);let s,n,a,o,r,i,c,l,d,f="clear",w=[],E=[],v,T,b,k=new bs,N,A=null,F=null,V=null,U=null,y=[],h=0,p=[],R=0;const m=D(!1),ee=D(""),Q=D(""),Z=D(0),J=[{speaker:"奥特曼",text:"怪兽，你为什么要破坏城市？"},{speaker:"怪兽",text:"因为人类污染了环境，我要惩罚他们！"},{speaker:"奥特曼",text:"但破坏城市不是解决问题的方法。"},{speaker:"怪兽",text:"那你说该怎么办？"},{speaker:"奥特曼",text:"让我们一起保护地球，好吗？"},{speaker:"飞龙",text:"我同意奥特曼的观点。作为天空的守护者，我见证了环境的恶化。"},{speaker:"怪兽",text:"哼，你们这些所谓的守护者，又做了什么？"},{speaker:"飞龙",text:"我们一直在努力，但需要更多人的参与。"},{speaker:"鲨鱼",text:"作为海洋的居民，我深有感触。海洋污染已经严重影响了我们的生活。"},{speaker:"奥特曼",text:"所以我们需要团结起来，共同保护我们的家园。"},{speaker:"怪兽",text:"可是人类会听我们的吗？"},{speaker:"飞龙",text:"只要我们坚持不懈，总会有人明白的。"},{speaker:"鲨鱼",text:"我同意，让我们从自己做起，影响身边的人。"},{speaker:"奥特曼",text:"这就是我们守护者的使命，不是吗？"},{speaker:"怪兽",text:"也许...你们说得对。我愿意加入你们。"}];let de=null;const ie=()=>{Z.value>=J.length&&(Z.value=0);const u=J[Z.value];Q.value=u.speaker,ee.value=u.text,m.value=!0,de=setTimeout(()=>{m.value=!1,Z.value++,Z.value<J.length&&(de=setTimeout(ie,1e3))},3e3)},ne=()=>{s=new gs,n=new vt(75,window.innerWidth/window.innerHeight,.1,1e3),a=new vs({antialias:!0}),a.setSize(window.innerWidth,window.innerHeight),a.toneMapping=ws,t.value.appendChild(a.domElement);const u=new ys(16777215,.5);s.add(u);const x=new Yt(16777215,.8);x.position.set(10,10,10),s.add(x),i=new xs(n,a.domElement),i.enableDamping=!0,i.dampingFactor=.05,i.maxPolarAngle=Math.PI*.495,i.minDistance=10,i.maxDistance=50,i.enablePan=!1,i.target.set(0,0,0),n.position.set(0,10,20),n.lookAt(0,0,0)},nt=()=>{const u=new $e(1e4,1e4);o=new mo(u,{textureWidth:512,textureHeight:512,waterNormals:new Qt().load("https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/waternormals.jpg",function(x){x.wrapS=x.wrapT=Qe}),sunDirection:new z,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:s.fog!==void 0}),o.rotation.x=-Math.PI/2,s.add(o)},st=()=>{r=new tt,r.scale.setScalar(1e4),s.add(r);const u=r.material.uniforms;u.turbidity.value=10,u.rayleigh.value=2,u.mieCoefficient.value=.005,u.mieDirectionalG.value=.8;const x={elevation:2,azimuth:180},_=new Ms(a),I=()=>{const S=ht.degToRad(90-x.elevation),C=ht.degToRad(x.azimuth);c.setFromSphericalCoords(1,S,C),r.material.uniforms.sunPosition.value.copy(c),o.material.uniforms.sunDirection.value.copy(c).normalize(),s.environment=_.fromScene(r).texture};c=new z,I()},ot=()=>{const u=new po,x=new Yo;x.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),u.setDRACOLoader(x);const _=S=>{u.load(S,C=>{v=C.scene,v.scale.set(.5,.5,.5),v.position.set(0,0,0),T=v.getObjectByName("Sail"),b=v.getObjectByName("Rudder"),v.userData={velocity:new z(0,0,0),angularVelocity:new z(0,0,0),mass:1e3,buoyancy:1200,drag:.1,angularDrag:.05,waterLevel:0},s.add(v),console.log("船模型加载成功")},C=>{console.log(C.loaded/C.total*100+"% loaded")},C=>{console.error("模型加载失败:",C),I()})},I=()=>{console.log("创建简单小船模型");const S=new qe(2,.5,4),C=new H({color:9127187});v=new L(S,C);const G=new $e(1,2),j=new H({color:16777215,side:Ge});T=new L(G,j),T.position.set(0,1,0),T.rotation.y=Math.PI/2,v.add(T);const B=new qe(.1,.5,.5),P=new H({color:4929057});b=new L(B,P),b.position.set(0,0,-2),v.add(b),v.position.set(0,1,0),v.userData={velocity:new z(0,0,0),angularVelocity:new z(0,0,0),mass:500,buoyancy:2e3,drag:.1,angularDrag:.05,waterLevel:0},s.add(v)};try{_("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/gltf/sailboat/sailboat.glb")}catch(S){console.error("模型加载出错:",S),I()}},ze=()=>{const u=new Ue,x=1e3,_=new Float32Array(x*3);for(let S=0;S<x;S++)_[S*3]=(Math.random()-.5)*100,_[S*3+1]=Math.random()*50,_[S*3+2]=(Math.random()-.5)*100;u.setAttribute("position",new xe(_,3));const I=new Ye({color:11184810,size:.1,transparent:!0,opacity:.6});l=new Je(u,I),s.add(l)},rn=()=>{const u=new Ue,x=1e3,_=new Float32Array(x*3);for(let S=0;S<x;S++)_[S*3]=(Math.random()-.5)*100,_[S*3+1]=Math.random()*50,_[S*3+2]=(Math.random()-.5)*100;u.setAttribute("position",new xe(_,3));const I=new Ye({color:16777215,size:.2,transparent:!0,opacity:.8});d=new Je(u,I),s.add(d)},cn=()=>{s.fog=new Es(13421772,.01)},ln=()=>{l&&(s.remove(l),l=null),d&&(s.remove(d),d=null),s.fog&&(s.fog=null)},je=u=>{switch(ln(),f=u,u){case"rain":ze();break;case"snow":rn();break;case"fog":cn();break}},un=()=>{if(f==="rain"&&l){const u=l.geometry.attributes.position.array;for(let x=0;x<u.length;x+=3)u[x+1]-=.5,u[x+1]<0&&(u[x+1]=50);l.geometry.attributes.position.needsUpdate=!0}if(f==="snow"&&d){const u=d.geometry.attributes.position.array;for(let x=0;x<u.length;x+=3)u[x]+=Math.sin(Date.now()*.001+x)*.1,u[x+1]-=.1,u[x+2]+=Math.cos(Date.now()*.001+x)*.1,u[x+1]<0&&(u[x+1]=50);d.geometry.attributes.position.needsUpdate=!0}},dn=()=>{const x=new me(1,8,8),_=new H({color:16777215,transparent:!0,opacity:.8});for(let I=0;I<10;I++){const S=new ae,C=2+Math.random()*3,G=3+Math.floor(Math.random()*3);for(let j=0;j<G;j++){const B=new L(x,_);B.position.set((Math.random()-.5)*C,(Math.random()-.5)*C*.5,(Math.random()-.5)*C),B.scale.set(1+Math.random(),.8+Math.random()*.5,1+Math.random()),S.add(B)}S.position.set((Math.random()-.5)*200,30+Math.random()*20,(Math.random()-.5)*200),S.userData={speed:.02+Math.random()*.03,direction:new z(Math.random()-.5,0,Math.random()-.5).normalize()},s.add(S),w.push(S)}},fn=()=>{const x=new ve(.2,.5,4),_=new H({color:0});for(let I=0;I<5;I++){const S=new ae,C=new L(x,_);C.rotation.x=Math.PI/2,S.add(C);const G=new $e(.5,.2),j=new H({color:0,side:Ge}),B=new L(G,j);B.position.set(-.3,0,0),B.rotation.y=Math.PI/2,S.add(B);const P=new L(G,j);P.position.set(.3,0,0),P.rotation.y=-Math.PI/2,S.add(P),S.position.set((Math.random()-.5)*100,20+Math.random()*10,(Math.random()-.5)*100),S.userData={speed:.1+Math.random()*.1,direction:new z(Math.random()-.5,0,Math.random()-.5).normalize(),wingAngle:0,wingSpeed:.2+Math.random()*.1},s.add(S),E.push(S)}},hn=()=>{w.forEach(u=>{u.position.add(u.userData.direction.multiplyScalar(u.userData.speed)),Math.abs(u.position.x)>100&&(u.position.x=-u.position.x),Math.abs(u.position.z)>100&&(u.position.z=-u.position.z)})},mn=()=>{E.forEach(u=>{u.position.add(u.userData.direction.multiplyScalar(u.userData.speed)),u.userData.wingAngle+=u.userData.wingSpeed;const x=Math.sin(u.userData.wingAngle)*Math.PI/4;u.children[1].rotation.z=x,u.children[2].rotation.z=-x,Math.abs(u.position.x)>100&&(u.position.x=-u.position.x,u.userData.direction.x*=-1),Math.abs(u.position.z)>100&&(u.position.z=-u.position.z,u.userData.direction.z*=-1);const _=Math.atan2(u.userData.direction.x,u.userData.direction.z);u.rotation.y=_})},pn=u=>{if(!v)return;const x=o.material.uniforms.time.value;Math.max(0,1-v.position.y)*v.userData.buoyancy,v.userData.mass*9.81;const I=10,S=2,C=.5,G=.95;ge.ArrowUp?v.userData.velocity.z-=C:ge.ArrowDown?v.userData.velocity.z+=C:v.userData.velocity.z*=G,ge.ArrowLeft&&(v.rotation.y+=S*u),ge.ArrowRight&&(v.rotation.y-=S*u);const j=new z(0,0,v.userData.velocity.z);j.applyAxisAngle(new z(0,1,0),v.rotation.y),v.position.x+=j.x*u*I,v.position.z+=j.z*u*I,v.position.y<.5&&(v.position.y=.5,v.userData.velocity.y=0);const B=new z(Math.sin(x+v.position.x)*.1,Math.sin(x+v.position.z)*.1,0);v.rotation.x=B.x,v.rotation.z=B.z,T&&(T.rotation.y=Math.sin(x*.5)*.2),b&&(b.rotation.y=Math.sin(x*.3)*.1);const P=200;v.position.x=Math.max(-P,Math.min(P,v.position.x)),v.position.z=Math.max(-P,Math.min(P,v.position.z))},gn=()=>{const u=new ae,x=new ve(20,10,32),_=new H({color:9127187,flatShading:!0}),I=new L(x,_);I.rotation.x=Math.PI,I.position.y=-5,u.add(I);const S=new Ts(18,20,32),C=new H({color:16113331,side:Ge}),G=new L(S,C);G.rotation.x=-Math.PI/2,G.position.y=.1,u.add(G);const j=(P,W)=>{const X=new ae,te=new Ft(.5,.7,4,8),Y=new H({color:9127187}),se=new L(te,Y);se.position.y=2,X.add(se);const fe=new ve(2,4,8),he=new H({color:2263842}),oe=new L(fe,he);return oe.position.y=5,X.add(oe),X.position.set(P,0,W),X.rotation.y=Math.random()*Math.PI*2,X};for(let P=0;P<10;P++){const W=P/10*Math.PI*2,X=10+Math.random()*5,te=Math.cos(W)*X,Y=Math.sin(W)*X;u.add(j(te,Y))}const B=(P,W)=>{const X=new Ot(1+Math.random(),0),te=new H({color:8421504,flatShading:!0}),Y=new L(X,te);return Y.position.set(P,.5,W),Y.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),Y.scale.set(.5+Math.random(),.5+Math.random(),.5+Math.random()),Y};for(let P=0;P<15;P++){const W=P/15*Math.PI*2,X=18+Math.random()*2,te=Math.cos(W)*X,Y=Math.sin(W)*X;u.add(B(te,Y))}return u.position.set(50,0,50),s.add(u),u},vn=()=>{const u=new ae,x=new Ae(2,8,4,8),_=new H({color:4915330,shininess:100}),I=new L(x,_);I.rotation.x=Math.PI/2,u.add(I);const S=new ve(1.5,4,8),C=new H({color:4915330,shininess:100}),G=new L(S,C);G.position.set(0,0,-6),G.rotation.x=-Math.PI/2,u.add(G);const j=new ve(.3,2,8),B=new H({color:9127187,shininess:100}),P=new L(j,B);P.position.set(-.8,1,-6),P.rotation.x=-Math.PI/4,u.add(P);const W=new L(j,B);W.position.set(.8,1,-6),W.rotation.x=-Math.PI/4,u.add(W);const X=new $e(8,4),te=new H({color:4915330,side:Ge,shininess:100}),Y=new L(X,te);Y.position.set(-4,0,0),Y.rotation.y=Math.PI/4,u.add(Y);const se=new L(X,te);se.position.set(4,0,0),se.rotation.y=-Math.PI/4,u.add(se);const fe=new Ft(.5,.1,10,8),he=new H({color:4915330,shininess:100}),oe=new L(fe,he);return oe.position.set(0,0,6),oe.rotation.x=Math.PI/2,u.add(oe),u.position.set(0,50,0),u.userData={speed:.2,direction:new z(1,0,0),wingAngle:0,wingSpeed:.1,pathRadius:100,pathAngle:0,pathSpeed:.002},s.add(u),u},wn=()=>{if(!A)return;A.userData.wingAngle+=A.userData.wingSpeed;const u=Math.sin(A.userData.wingAngle)*Math.PI/4,x=A.children[2],_=A.children[3];x.rotation.x=u,_.rotation.x=-u,A.userData.pathAngle+=A.userData.pathSpeed;const I=Math.cos(A.userData.pathAngle)*A.userData.pathRadius,S=Math.sin(A.userData.pathAngle)*A.userData.pathRadius;A.position.x=I,A.position.z=S;const C=Math.atan2(-Math.sin(A.userData.pathAngle),-Math.cos(A.userData.pathAngle));A.rotation.y=C,A.position.y=50+Math.sin(A.userData.pathAngle*2)*5},yn=()=>{N&&N.children.forEach(u=>{u.type==="Group"&&(u.rotation.x=Math.sin(Date.now()*.001)*.05,u.rotation.z=Math.cos(Date.now()*.001)*.05)})},xn=()=>{const u=new ae,x=new Ae(1.5,4,8,8),_=new H({color:16711680,shininess:100}),I=new L(x,_);I.position.y=2,u.add(I);const S=new me(1.2,16,16),C=new H({color:16711680,shininess:100}),G=new L(S,C);G.position.y=5.5,u.add(G);const j=new me(.3,8,8),B=new H({color:16777215,emissive:16777215,emissiveIntensity:.5}),P=new L(j,B);P.position.set(-.4,5.5,.8),u.add(P);const W=new L(j,B);W.position.set(.4,5.5,.8),u.add(W);const X=new me(.4,8,8),te=new H({color:16777215,emissive:16777215,emissiveIntensity:.3,transparent:!0,opacity:.5}),Y=new L(X,te);Y.position.copy(P.position),u.add(Y);const se=new L(X,te);se.position.copy(W.position),u.add(se);const fe=new me(.15,8,8),he=new H({color:0,emissive:0,emissiveIntensity:.5}),oe=new L(fe,he);oe.position.copy(P.position),oe.position.z+=.2,u.add(oe);const _e=new L(fe,he);_e.position.copy(W.position),_e.position.z+=.2,u.add(_e);const Ne=new Ae(.5,3,8,8),Fe=new H({color:16711680,shininess:100}),be=new L(Ne,Fe);be.position.set(-2,2,0),be.rotation.z=Math.PI/4,u.add(be);const Ee=new L(Ne,Fe);Ee.position.set(2,2,0),Ee.rotation.z=-Math.PI/4,u.add(Ee);const Et=new Ae(.7,3,8,8),At=new H({color:16711680,shininess:100}),Rt=new L(Et,At);Rt.position.set(-.8,-1,0),u.add(Rt);const St=new L(Et,At);St.position.set(.8,-1,0),u.add(St);const Pn=new qe(.8,.8,.2),Nn=new H({color:65280,emissive:65280,emissiveIntensity:.5}),Lt=new L(Pn,Nn);return Lt.position.set(0,3,1.2),u.add(Lt),u.position.set(-150,0,-150),u.scale.set(5,5,5),u.rotation.y=Math.PI/2,u.userData={animationTime:0,animationSpeed:.01,eyes:{leftEye:P,rightEye:W,leftEyeGlow:Y,rightEyeGlow:se,leftPupil:oe,rightPupil:_e}},s.add(u),u},Mn=()=>{if(!F)return;F.userData.animationTime+=F.userData.animationSpeed;const u=F.children[3],x=F.children[4];u.rotation.z=Math.PI/4+Math.sin(F.userData.animationTime)*.2,x.rotation.z=-Math.PI/4-Math.sin(F.userData.animationTime)*.2;const _=F.children[6];_.material.emissiveIntensity=.5+Math.sin(F.userData.animationTime*5)*.3;const{leftEye:I,rightEye:S,leftEyeGlow:C,rightEyeGlow:G,leftPupil:j,rightPupil:B}=F.userData.eyes,P=.3+Math.sin(F.userData.animationTime*3)*.2;C.material.emissiveIntensity=P,G.material.emissiveIntensity=P,Math.sin(F.userData.animationTime*2)<-.8?(I.scale.y=.1,S.scale.y=.1,j.scale.y=.1,B.scale.y=.1):(I.scale.y=1,S.scale.y=1,j.scale.y=1,B.scale.y=1)},Tn=()=>{const u=new ae,x=[16711680,16744192,16776960,65280,255,4915330,9699539];for(let _=0;_<x.length;_++){const I=new _s(30+_*1.2,.7,16,100,Math.PI),S=new De({color:x[_],transparent:!0,opacity:.6}),C=new L(I,S);C.position.set(50,18+_*.5,30),C.rotation.x=Math.PI/2,u.add(C)}return s.add(u),u},_n=()=>{const u=new me(5,32,32),x=new H({color:16777164,emissive:16777164,emissiveIntensity:.8}),_=new L(u,x);return _.position.set(-80,80,-100),s.add(_),_},bn=()=>{const x=new Ue,_=new Float32Array(2e3*3);for(let C=0;C<2e3;C++){const G=Math.random()*2*Math.PI,j=Math.acos(2*Math.random()-1),B=200+Math.random()*100;_[C*3]=B*Math.sin(j)*Math.cos(G),_[C*3+1]=B*Math.sin(j)*Math.sin(G),_[C*3+2]=B*Math.cos(j)}x.setAttribute("position",new xe(_,3));const I=new Ye({color:16777215,size:1.2,transparent:!0,opacity:.7}),S=new Je(x,I);return s.add(S),S},En=()=>{U&&(U.rotation.y+=5e-4)},An=()=>{if(V){const u=Math.sin(Date.now()*5e-4)*.2+.8;V.children.forEach(x=>{x.material.opacity=u})}},Rn=()=>{const u=new ae,x=new Ae(2,6,8,8),_=new H({color:8388608,shininess:50}),I=new L(x,_);I.position.y=3,u.add(I);const S=new me(2,16,16),C=new H({color:8388608,shininess:50}),G=new L(S,C);G.position.y=7,u.add(G);const j=new me(.4,8,8),B=new H({color:16711680,emissive:16711680,emissiveIntensity:.8}),P=new L(j,B);P.position.set(-.8,7,1.5),u.add(P);const W=new L(j,B);W.position.set(.8,7,1.5),u.add(W);const X=new Ae(.8,4,8,8),te=new H({color:8388608,shininess:50}),Y=new L(X,te);Y.position.set(-3,3,0),Y.rotation.z=Math.PI/4,u.add(Y);const se=new L(X,te);se.position.set(3,3,0),se.rotation.z=-Math.PI/4,u.add(se);const fe=new Ae(1,4,8,8),he=new H({color:8388608,shininess:50}),oe=new L(fe,he);oe.position.set(-1.2,-2,0),u.add(oe);const _e=new L(fe,he);_e.position.set(1.2,-2,0),u.add(_e);const Ne=new ve(.5,2,8),Fe=new H({color:0,shininess:100}),be=new L(Ne,Fe);be.position.set(-1,8,0),be.rotation.x=-Math.PI/4,u.add(be);const Ee=new L(Ne,Fe);return Ee.position.set(1,8,0),Ee.rotation.x=-Math.PI/4,u.add(Ee),u.position.set(-80,0,-150),u.scale.set(5,5,5),u.rotation.y=-Math.PI/2,u.userData={animationTime:0,animationSpeed:.01,health:100,isAttacking:!1,attackCooldown:0},s.add(u),u},Sn=()=>{const u=new ae,x=new Ot(2,0),_=new H({color:8421504,emissive:4868682,shininess:30}),I=new L(x,_);u.add(I);const S=new ve(1,4,8),C=new H({color:16729344,emissive:16729344,transparent:!0,opacity:.6}),G=new L(S,C);G.position.set(0,2,0),G.rotation.x=Math.PI,u.add(G);const j=(Math.random()-.5)*200,B=100+Math.random()*50,P=(Math.random()-.5)*200;return u.position.set(j,B,P),u.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),u.userData={velocity:new z((Math.random()-.5)*.2,-.8-Math.random()*.4,(Math.random()-.5)*.2),rotationSpeed:new z(Math.random()*.01,Math.random()*.01,Math.random()*.01)},s.add(u),y.push(u),u},Ln=()=>{const u=new ae,x=new me(.5,8,8),_=new H({color:16777215,emissive:16777215,emissiveIntensity:1}),I=new L(x,_);u.add(I);const S=new ve(.3,8,8),C=new H({color:16777215,emissive:16777215,transparent:!0,opacity:.8}),G=new L(S,C);G.position.set(0,4,0),G.rotation.x=Math.PI,u.add(G);const j=(Math.random()-.5)*200,B=80+Math.random()*20,P=(Math.random()-.5)*200;u.position.set(j,B,P);const W=Math.random()*Math.PI*2,X=.8+Math.random()*.4;return u.userData={velocity:new z(Math.cos(W)*X,-X,Math.sin(W)*X)},s.add(u),p.push(u),u},kn=()=>{const u=Date.now();u-h>2e3&&(Sn(),h=u);for(let x=y.length-1;x>=0;x--){const _=y[x];_.position.add(_.userData.velocity),_.rotation.x+=_.userData.rotationSpeed.x,_.rotation.y+=_.userData.rotationSpeed.y,_.rotation.z+=_.userData.rotationSpeed.z,_.position.y<0&&(s.remove(_),y.splice(x,1))}},Cn=()=>{const u=Date.now();u-R>1500&&(Ln(),R=u);for(let x=p.length-1;x>=0;x--){const _=p[x];_.position.add(_.userData.velocity),_.lookAt(_.position.x+_.userData.velocity.x,_.position.y+_.userData.velocity.y,_.position.z+_.userData.velocity.z),(_.position.y<0||Math.abs(_.position.x)>200||Math.abs(_.position.z)>200)&&(s.remove(_),p.splice(x,1))}},Dn=()=>{if(!v)return;i.target.copy(v.position);const u=new z(0,10,20),x=v.position.clone().add(u);i.enabled||n.position.lerp(x,.1)},wt=()=>{requestAnimationFrame(wt);const u=k.getDelta();pn(u),Dn(),i.update(),o&&(o.material.uniforms.time.value+=1/60),un(),hn(),mn(),yn(),wn(),Mn(),En(),An(),kn(),Cn(),a.render(s,n)},In=()=>{document.fullscreenElement?document.exitFullscreen():t.value.requestFullscreen().catch(u=>{console.error(`全屏错误: ${u.message}`)})},yt=()=>{e.value=!!document.fullscreenElement,a&&(a.setSize(window.innerWidth,window.innerHeight),n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix())},xt=()=>{a&&(a.setSize(window.innerWidth,window.innerHeight),n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix())},Mt=u=>{ge.hasOwnProperty(u.key)&&(ge[u.key]=!0)},Tt=u=>{ge.hasOwnProperty(u.key)&&(ge[u.key]=!1)},ge={ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1},_t=u=>{u.button===2&&(i.enabled=!0)},bt=u=>{u.button===2&&(i.enabled=!1)};return Be(()=>{ne(),nt(),st(),ot(),dn(),fn(),N=gn(),A=vn(),F=xn(),V=Tn(),_n(),U=bn(),Rn(),wt(),window.addEventListener("resize",xt),document.addEventListener("fullscreenchange",yt),window.addEventListener("keydown",Mt),window.addEventListener("keyup",Tt),window.addEventListener("mousedown",_t),window.addEventListener("mouseup",bt),t.value.addEventListener("contextmenu",u=>{u.preventDefault()}),setTimeout(ie,2e3)}),Fn(()=>{window.removeEventListener("resize",xt),document.removeEventListener("fullscreenchange",yt),window.removeEventListener("keydown",Mt),window.removeEventListener("keyup",Tt),window.removeEventListener("mousedown",_t),window.removeEventListener("mouseup",bt),a&&a.dispose(),de&&clearTimeout(de)}),(u,x)=>(K(),$("div",Zo,[M("div",{ref_key:"container",ref:t,class:"game-container"},null,512),M("div",Qo,[M("div",ea,[M("button",{onClick:x[0]||(x[0]=_=>je("clear"))},"晴天"),M("button",{onClick:x[1]||(x[1]=_=>je("rain"))},"雨天"),M("button",{onClick:x[2]||(x[2]=_=>je("snow"))},"雪天"),M("button",{onClick:x[3]||(x[3]=_=>je("fog"))},"雾天")]),M("button",{class:"fullscreen-btn",onClick:In},[e.value?(K(),$("span",na,"退出全屏")):(K(),$("span",ta,"全屏"))])])]))}},oa=Ce(sa,[["__scopeId","data-v-f44bfb70"]]),aa={class:"piano-game"},ia={class:"piano-container"},ra=["onMousedown","onMouseup","onMouseleave"],ca={class:"key-label"},la={class:"key-hint"},ua={__name:"PianoGame",setup(g){const t=[{key:"a",note:"C4",label:"C"},{key:"s",note:"D4",label:"D"},{key:"d",note:"E4",label:"E"},{key:"f",note:"F4",label:"F"},{key:"g",note:"G4",label:"G"},{key:"h",note:"A4",label:"A"},{key:"j",note:"B4",label:"B"},{key:"k",note:"C5",label:"C"}],e=D(new Set),s=D(null),n=i=>{s.value||(s.value=new(window.AudioContext||window.webkitAudioContext));const c=s.value.createOscillator(),l=s.value.createGain();c.type="sine",c.frequency.value=a(i),l.gain.setValueAtTime(.3,s.value.currentTime),l.gain.exponentialRampToValueAtTime(.01,s.value.currentTime+1),c.connect(l),l.connect(s.value.destination),c.start(),c.stop(s.value.currentTime+1)},a=i=>({C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440,B4:493.88,C5:523.25})[i],o=i=>{const c=t.find(l=>l.key===i.key.toLowerCase());c&&!e.value.has(c.key)&&(e.value.add(c.key),n(c.note))},r=i=>{const c=t.find(l=>l.key===i.key.toLowerCase());c&&e.value.delete(c.key)};return Be(()=>{window.addEventListener("keydown",o),window.addEventListener("keyup",r)}),et(()=>{window.removeEventListener("keydown",o),window.removeEventListener("keyup",r)}),(i,c)=>(K(),$("div",aa,[M("div",ia,[(K(),$(Me,null,Te(t,l=>M("div",{key:l.key,class:Pe(["piano-key",{active:e.value.has(l.key)}]),onMousedown:d=>{n(l.note),e.value.add(l.key)},onMouseup:d=>e.value.delete(l.key),onMouseleave:d=>e.value.delete(l.key)},[M("span",ca,q(l.label),1),M("span",la,q(l.key.toUpperCase()),1)],42,ra)),64))]),c[0]||(c[0]=M("div",{class:"instructions"},[M("p",null,"使用键盘按键 A-J 或点击琴键来演奏")],-1))]))}},da=Ce(ua,[["__scopeId","data-v-80729f6a"]]),fa={class:"happy-cat-game"},ha={class:"game-info"},ma={class:"score"},pa={class:"virtual-controls"},Xe=10,jt=1e4,ga={__name:"HappyCatGame",setup(g){const t=D(0),e=D(!1),s=D({x:50,y:50}),n=D([]),a=D(null),o=D(!1),r=D(!1),i=D([]),c=D(null),l={NET:{icon:"🎣",name:"渔网",color:"#2196F3"},DOUBLE:{icon:"⭐",name:"双倍得分",color:"#FFD700"}},d=p=>{if(e.value)return;const R=a.value.getBoundingClientRect(),m=p.clientX-R.left,ee=p.clientY-R.top;s.value={x:Math.max(0,Math.min(m,R.width-50)),y:Math.max(0,Math.min(ee,R.height-50))}},f=p=>{if(e.value)return;const R=a.value.getBoundingClientRect(),m=s.value.x;p.key==="ArrowLeft"?s.value.x=Math.max(0,m-Xe):p.key==="ArrowRight"&&(s.value.x=Math.min(R.width-50,m+Xe))},w=()=>{if(e.value)return;const p={id:Date.now(),x:Math.random()*(a.value.clientWidth-30),y:Math.random()*(a.value.clientHeight-30),speed:2+Math.random()*3};n.value.push(p)},E=()=>{if(Math.random()<.005){const p=Object.keys(l),R=p[Math.floor(Math.random()*p.length)],m={id:Date.now(),type:R,x:Math.random()*(a.value.clientWidth-30),y:-30,speed:3};i.value.push(m)}},v=()=>{i.value=i.value.filter(p=>{const R=p.x-s.value.x,m=p.y-s.value.y;return Math.sqrt(R*R+m*m)<40?(T(p.type),!1):!0})},T=p=>{c.value={type:p,endTime:Date.now()+jt},window.powerUpTimer&&clearTimeout(window.powerUpTimer),window.powerUpTimer=setTimeout(()=>{c.value=null},jt)},b=()=>{i.value.forEach(p=>{p.y+=p.speed,p.y>a.value.clientHeight&&(p.y=-30,p.x=Math.random()*(a.value.clientWidth-30))})},k=p=>{var R;((R=c.value)==null?void 0:R.type)==="DOUBLE"?t.value+=p*2:t.value+=p},N=()=>{n.value=n.value.filter(p=>{const R=p.x-s.value.x,m=p.y-s.value.y;return Math.sqrt(R*R+m*m)<40?(k(10),!1):!0})},A=()=>{n.value.forEach(p=>{p.y+=p.speed,p.y>a.value.clientHeight&&(p.y=-30,p.x=Math.random()*(a.value.clientWidth-30))})},F=()=>{o.value=!0},V=()=>{o.value=!1},U=()=>{r.value=!0},y=()=>{r.value=!1},h=()=>{e.value||(o.value&&(s.value.x=Math.max(0,s.value.x-Xe)),r.value&&(s.value.x=Math.min(a.value.clientWidth-50,s.value.x+Xe)),A(),b(),N(),v(),E(),Math.random()<.02&&w(),requestAnimationFrame(h))};return Be(()=>{h(),window.addEventListener("keydown",f)}),et(()=>{e.value=!0,window.removeEventListener("keydown",f)}),(p,R)=>{var m,ee;return K(),$("div",fa,[M("div",ha,[M("div",ma,"得分: "+q(t.value),1),c.value?(K(),$("div",{key:0,class:"active-power-up",style:Se({backgroundColor:l[c.value.type].color})},q(l[c.value.type].icon)+" "+q(l[c.value.type].name),5)):ke("",!0)]),M("div",{ref_key:"gameArea",ref:a,class:"game-area",onMousemove:d},[M("div",{class:"cat",style:Se({left:s.value.x+"px",top:s.value.y+"px",transform:`translate(-50%, -50%) scale(${((m=c.value)==null?void 0:m.type)==="NET"?1.5:1.2})`})},q(((ee=c.value)==null?void 0:ee.type)==="NET"?"🐱🎣":"🐱"),5),(K(!0),$(Me,null,Te(n.value,Q=>(K(),$("div",{key:Q.id,class:"fish",style:Se({left:Q.x+"px",top:Q.y+"px"})}," 🐟 ",4))),128)),(K(!0),$(Me,null,Te(i.value,Q=>(K(),$("div",{key:Q.id,class:"power-up",style:Se({left:Q.x+"px",top:Q.y+"px",backgroundColor:l[Q.type].color})},q(l[Q.type].icon),5))),128))],544),M("div",pa,[M("button",{class:"virtual-button left",onTouchstart:F,onTouchend:V,onMousedown:F,onMouseup:V,onMouseleave:V}," ← ",32),M("button",{class:"virtual-button right",onTouchstart:U,onTouchend:y,onMousedown:U,onMouseup:y,onMouseleave:y}," → ",32)]),R[0]||(R[0]=M("div",{class:"instructions"},[M("p",null,"使用鼠标移动、键盘方向键或虚拟按键控制小猫，接住掉落的鱼干！"),M("p",{class:"power-up-info"},[Kt(" 道具说明： "),M("span",{class:"power-up-item"},"🎣 渔网：增大接取范围"),M("span",{class:"power-up-item"},"⭐ 双倍得分：得分翻倍")])],-1))])}}},va=Ce(ga,[["__scopeId","data-v-3e6f19ae"]]),wa={class:"game-container"},ya={key:0,class:"game-menu"},xa={class:"games-grid"},Ma=["onClick"],Ta={class:"game-icon"},_a={class:"game-name"},ba={class:"game-description"},Ea={key:1,class:"game-area"},Aa={class:"game-header"},Ra={class:"current-game-title"},Sa={class:"game-content"},La={__name:"index",setup(g){const t=D(null),e=[{id:"empire-rise",name:"帝国崛起",description:"回合制帝国建设策略游戏",icon:"👑",color:"#8E44AD",component:null,routePath:"/game/empire-rise"},{id:"3d-model",name:"3D模型互动",description:"探索三维空间，体验沉浸式3D模型互动",icon:"🎲",color:"#3498DB",component:null,routePath:"/game/3d-model"},{id:"sky-simulator",name:"3D天空模拟器",description:"体验逼真的天空变化，操控时间和天气的奇妙旅程",icon:"🌤️",color:"#FF9500",component:null,routePath:"/game/sky-simulator"},{id:"happy-cat",name:"快乐小猫",description:"帮助小猫接住掉落的鱼干",icon:"🐱",color:"#FF6B6B",component:va},{id:"piano",name:"钢琴演奏",description:"使用键盘演奏简单的钢琴曲",icon:"🎹",color:"#9B59B6",component:da},{id:"boat",name:"小船漂流",description:"3D小船漂流冒险",icon:"⛵",color:"#0077be",component:oa},{id:"2048",name:"2048",description:"经典的数字合并游戏",icon:"🎮",color:"#FFD166",component:Us},{id:"snake",name:"贪吃蛇",description:"控制蛇吃食物并成长",icon:"🐍",color:"#06D6A0",component:Zs},{id:"memory",name:"记忆翻牌",description:"考验记忆力的翻牌游戏",icon:"🎴",color:"#118AB2",component:ho}],s=Hn(),n=o=>{const r=e.find(i=>i.id===o);r.routePath?s.push(r.routePath):t.value=o},a=()=>{t.value=null};return(o,r)=>{var i,c;return K(),$("div",wa,[t.value?(K(),$("div",Ea,[M("div",Aa,[M("button",{class:"back-button",onClick:a},r[1]||(r[1]=[M("span",{class:"back-icon"},"←",-1),Kt(" 返回 ")])),M("h2",Ra,q((i=e.find(l=>l.id===t.value))==null?void 0:i.name),1)]),M("div",Sa,[(K(),On(Gn((c=e.find(l=>l.id===t.value))==null?void 0:c.component)))])])):(K(),$("div",ya,[r[0]||(r[0]=M("h1",{class:"game-title"},"趣味小游戏",-1)),M("div",xa,[(K(),$(Me,null,Te(e,l=>M("div",{key:l.id,class:"game-card",style:Se({"--card-color":l.color}),onClick:d=>n(l.id)},[M("div",Ta,q(l.icon),1),M("h2",_a,q(l.name),1),M("p",ba,q(l.description),1)],12,Ma)),64))])]))])}}},Da=Ce(La,[["__scopeId","data-v-1013e610"]]);export{Da as default};
