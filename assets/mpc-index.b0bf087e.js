import{f as e,_ as a,k as t,u as l,p as o,q as s,v as i,o as n,c as d,a as r,F as g,r as m,b as c,w as f,h as u,e as p,t as h,g as v}from"./index-232c5e0c.js";import"./main.4d99c66b.js";const y="https://dominant-ant-formerly.ngrok-free.app";const w=a({name:"index.vue",components:{},data:()=>({showTool:!1,imageUrl:"",login:{dialog:!0,form:{uid:"",psw:""}},msg:{list:null,form:{msg:"",image:""}}}),created(){},mounted(){this.login.form.uid=t("uid")},methods:{formatTimestamp(e){const a=new Date(e);a.getFullYear();return`${(a.getMonth()+1).toString().padStart(2,"0")}-${a.getDate().toString().padStart(2,"0")} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}:${a.getSeconds().toString().padStart(2,"0")}`},getBase64:e=>new Promise((function(a,t){let l=new FileReader;l.readAsDataURL(e),l.onload=function(){let e=new Image;e.src=l.result,e.onload=function(){let t=document.createElement("canvas"),l=t.getContext("2d"),o=e.width,s=e.height;o>s?o>300&&(s*=300/o,o=300):s>300&&(o*=300/s,s=300),t.width=o,t.height=s,l.drawImage(e,0,0,o,s);let i=t.toDataURL("image/jpeg",.8);a(i)}},l.onerror=function(e){t(e)}})),getFile(a){console.log(a);const t="image/jpeg"===a.raw.type,o="image/png"===a.raw.type,s=a.raw.size/1024/1024<5;t||o||this.$message.error("上传图片只能是JPG或者PNG格式!"),s||this.$message.error("上传图片大小不能超过 5MB!");let i=this;(t||o)&&s&&this.getBase64(a.raw).then((t=>{var o;console.log(t),i.msg.form.image=t,(o={uid:i.login.form.uid,fileName:a.name,base64:i.msg.form.image},e({url:`${y}/mpc/file/upload`,method:"POST",data:o})).then((e=>{let a=i;l({data:"2"+e.data.data,success:function(){console.log("消息发送成功"),a.msg.form.image=""},fail:function(){console.log("消息发送失败")}})}))}))},sendMsg(){l({data:"1"+this.msg.form.msg,success:function(){console.log("消息发送成功")},fail:function(){console.log("消息发送失败")}}),this.msg.form.msg=""},dealImage(a){var t;a.msg.startsWith("mpc:")&&(t=a.msg,e({url:`${y}/mpc/file/download/${t}`,method:"GET"})).then((e=>{a.msg=e.data.data}))},loginUser(){let a=this;var l;(l=this.login.form,e({url:`${y}/mpc/user/login/${l.uid}/${l.psw}`,method:"GET"})).then((e=>{if(200==e.data.code){o("token",e.data.data),o("uid",this.login.form.uid),this.$message.success("登录成功");const l=t("token");s({url:`wss://dominant-ant-formerly.ngrok-free.app/mpc?token=${l}`,success:function(){console.log("WebSocket连接成功"),i((e=>{console.log(e.data),a.msg.list=JSON.parse(e.data).list})),a.login.dialog=!1},fail:function(){console.log("WebSocket连接失败"),a.$message.fail("登录失败")}})}else this.$message.fail("登录失败")}))}}},[["render",function(e,a,t,l,o,s){const i=p("el-avatar"),y=p("el-input"),w=p("el-button"),k=p("el-upload"),b=p("el-form-item"),x=p("el-form"),$=p("el-dialog");return n(),d("div",null,[r("div",{ref:"",style:{display:"flex","flex-direction":"column",height:"100vh"}},[r("div",{class:"box",style:{flex:"1","overflow-y":"auto"}},[(n(!0),d(g,null,m(o.msg.list,(e=>(n(),d("div",{class:"box"},[e.uid==o.login.form.uid?(n(),d("div",{key:0,class:"chatBoxMessageRight",style:{"margin-right":"2%",color:"#b9b6b6"}},h(s.formatTimestamp(e.sendTime)),1)):u("v-if",!0),e.uid==o.login.form.uid?(n(),d("div",{key:1,class:"chatBoxMessageRight"},[r("div",{style:{"margin-right":"3%"}},[1==e.type?(n(),d("div",{key:0,style:{"background-color":"#5ac95a","border-radius":"20%",padding:"10px"}},h(e.msg),1)):u("v-if",!0),2==e.type?(n(),d("div",{key:1,style:{"margin-left":"50%"}},[r("img",{src:e.msg,alt:"",style:{width:"100%"}},null,8,["src"]),r("img",{src:s.dealImage(e),alt:""},null,8,["src"])])):u("v-if",!0)]),r("div",null,[c(i,{size:40},{default:f((()=>["10001"==e.uid?(n(),d("img",{key:0,src:"https://picss.sunbangyan.cn/2024/02/26/9013b468c3b207fc74825264ca088276.jpeg",alt:""})):(n(),d("img",{key:1,src:"https://picst.sunbangyan.cn/2024/02/26/8767d25d3f0d1f7190fff677d39bf723.jpeg",alt:""}))])),_:2},1024)])])):u("v-if",!0),e.uid!=o.login.form.uid?(n(),d("div",{key:2,class:"chatBoxMessageLeft",style:{"margin-left":"2%",color:"#b9b6b6"}},h(s.formatTimestamp(e.sendTime)),1)):u("v-if",!0),e.uid!=o.login.form.uid?(n(),d("div",{key:3,class:"chatBoxMessageLeft"},[r("div",null,[c(i,{size:40},{default:f((()=>["10001"==e.uid?(n(),d("img",{key:0,src:"https://picss.sunbangyan.cn/2024/02/26/9013b468c3b207fc74825264ca088276.jpeg",alt:""})):(n(),d("img",{key:1,src:"https://picst.sunbangyan.cn/2024/02/26/8767d25d3f0d1f7190fff677d39bf723.jpeg",alt:""}))])),_:2},1024)]),r("div",{style:{"margin-left":"3%"}},[1==e.type?(n(),d("div",{key:0,style:{"background-color":"#eee","border-radius":"20%",padding:"10px"}},h(e.msg),1)):u("v-if",!0),2==e.type?(n(),d("div",{key:1,style:{"margin-right":"50%"}},[r("img",{src:e.msg,alt:"",style:{width:"100%"}},null,8,["src"]),r("img",{src:s.dealImage(e),alt:""},null,8,["src"])])):u("v-if",!0)])])):u("v-if",!0)])))),256))]),r("div",{class:"sendMessage",style:{height:"80px"}},[r("div",{style:{display:"flex"}},[c(y,{modelValue:o.msg.form.msg,"onUpdate:modelValue":a[0]||(a[0]=e=>o.msg.form.msg=e),autocomplete:"off",style:{"margin-right":"2%"}},null,8,["modelValue"]),o.showTool?(n(),d("span",{key:0,onClick:a[1]||(a[1]=e=>o.showTool=!1)},[(n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",width:"36",height:"36",viewBox:"0 0 1024 1024","data-v-ea893728":""},[r("path",{fill:"currentColor",d:"M352 480h320a32 32 0 1 1 0 64H352a32 32 0 0 1 0-64"}),r("path",{fill:"currentColor",d:"M480 672V352a32 32 0 1 1 64 0v320a32 32 0 0 1-64 0"}),r("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"})]))])):(n(),d("span",{key:1,onClick:a[2]||(a[2]=e=>o.showTool=!0)},[(n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",width:"36",height:"36",viewBox:"0 0 1024 1024","data-v-ea893728":""},[r("path",{fill:"currentColor",d:"M352 480h320a32 32 0 1 1 0 64H352a32 32 0 0 1 0-64"}),r("path",{fill:"currentColor",d:"M480 672V352a32 32 0 1 1 64 0v320a32 32 0 0 1-64 0"}),r("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"})]))])),c(w,{onClick:s.sendMsg,style:{"margin-left":"2%"}},{default:f((()=>[v("发送")])),_:1},8,["onClick"])]),o.showTool?(n(),d("div",{key:0},[r("div",null,[u("   发送图片：图片使用 base64 编码，作为 msg.form.msg 的值发送    "),c(k,{class:"upload-demo",action:"","on-change":s.getFile,limit:1,"auto-upload":!1},{default:f((()=>[c(w,{type:"primary"},{default:f((()=>[v("图片")])),_:1})])),_:1},8,["on-change"])])])):u("v-if",!0)])],512),u("  login  "),r("div",null,[c($,{modelValue:o.login.dialog,"onUpdate:modelValue":a[5]||(a[5]=e=>o.login.dialog=e),title:"登录",width:"80%","show-close":!1,"close-on-click-modal":!1},{footer:f((()=>[r("div",{class:"dialog-footer"},[c(w,{type:"primary",onClick:s.loginUser},{default:f((()=>[v("登录")])),_:1},8,["onClick"])])])),default:f((()=>[c(x,{model:o.login},{default:f((()=>[c(b,{label:"账号"},{default:f((()=>[c(y,{modelValue:o.login.form.uid,"onUpdate:modelValue":a[3]||(a[3]=e=>o.login.form.uid=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),c(b,{label:"密码"},{default:f((()=>[c(y,{modelValue:o.login.form.psw,"onUpdate:modelValue":a[4]||(a[4]=e=>o.login.form.psw=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])])}],["__scopeId","data-v-2f758749"]]);export{w as default};
