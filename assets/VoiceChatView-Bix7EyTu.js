import{_ as Z,a as u,w as A,b as d,o as c,d as t,e as y,n as E,t as b,j as we,D as Te,q as G,f as D,y as ue,s as Y,g as Se,F as _e,h as Ee,v as Pe,m as Ce,z as Me,C as $e}from"./index-DF37baOT.js";import{V as xe}from"./VoiceService-DKBGZCSk.js";const Ve={class:"face"},Ie={key:0,class:"emotion-indicator"},Re={__name:"VoiceAvatar",props:{emotion:{type:String,default:"neutral"},speaking:{type:Boolean,default:!1},isRecording:{type:Boolean,default:!1}},setup(k){const o=k,e=u(o.speaking),v=u(o.isRecording),l=u(o.emotion),r=u(!1),a={neutral:"平静",happy:"开心",surprised:"惊讶",sad:"难过",thinking:"思考中"};return A(()=>o.emotion,g=>{l.value=g,r.value=!0,setTimeout(()=>{r.value=!1},2e3)}),A(()=>o.speaking,g=>{e.value=g}),A(()=>o.isRecording,g=>{v.value=g}),(g,m)=>(c(),d("div",{class:E(["voice-avatar",{speaking:e.value,recording:v.value}])},[t("div",Ve,[t("div",{class:E(["eyes",l.value])},[m[1]||(m[1]=t("div",{class:"eye left"},null,-1)),m[2]||(m[2]=t("div",{class:"eye right"},null,-1)),t("div",{class:E(["eyebrows",l.value])},m[0]||(m[0]=[t("div",{class:"eyebrow left"},null,-1),t("div",{class:"eyebrow right"},null,-1)]),2)],2),t("div",{class:E(["mouth",l.value])},null,2)]),r.value?(c(),d("div",Ie,b(a[l.value]),1)):y("",!0)],2))}},re=Z(Re,[["__scopeId","data-v-10260a32"]]),De={class:"bubble-content"},We={class:"message"},Fe={key:0,class:"controls"},Be={__name:"VoiceChatBubble",props:{message:{type:String,required:!0},role:{type:String,default:"user",validator:k=>["user","assistant"].includes(k)},isTyping:{type:Boolean,default:!1},isPlaying:{type:Boolean,default:!1}},emits:["play","stop"],setup(k){return(o,e)=>(c(),d("div",{class:E(["chat-bubble",k.role])},[k.role==="assistant"?(c(),d("div",{key:0,class:E(["typing-indicator",{active:k.isTyping}])},e[2]||(e[2]=[t("span",{class:"dot"},null,-1),t("span",{class:"dot"},null,-1),t("span",{class:"dot"},null,-1)]),2)):y("",!0),t("div",De,[t("div",We,b(k.message),1),k.role==="assistant"?(c(),d("div",Fe,[k.isPlaying?(c(),d("button",{key:1,class:"play-btn stop-btn",onClick:e[1]||(e[1]=v=>o.$emit("stop"))}," ⏹️ 停止 ")):(c(),d("button",{key:0,class:"play-btn",onClick:e[0]||(e[0]=v=>o.$emit("play"))}," ▶️ 播放 "))])):y("",!0)])],2))}},ce=Z(Be,[["__scopeId","data-v-09128312"]]);class ze{constructor(){this.ttsSupported="speechSynthesis"in window,this.synthesis=window.speechSynthesis,this.emotionConfig={emotionWeights:{happy:["开心","高兴","快乐","欢喜","嗨","哈哈","笑","喜欢","爱","棒","赞","好玩"],sad:["难过","伤心","悲伤","失望","叹气","哭","泪","痛苦","遗憾","辛苦"],angry:["生气","愤怒","不满","讨厌","烦","恨","可恶","该死","糟糕"],surprised:["惊讶","震惊","意外","哇","天啊","不会吧","真的假的","这样啊"],anxious:["焦虑","担心","害怕","紧张","忧虑","慌","不知道"],excited:["激动","兴奋","期待","太棒了","哇塞","超赞","好棒","厉害"]},taiwaneseFeatures:{endingParticles:["啦","呀","喔","耶","哦","呢","嘛","诶","啊","咧","唷","囉"],exclamations:["哎呀","天哪","我的天","天啊","哇塞","好棒哦","不会吧","真假","欸"],vocabularyMapping:{很好:"很赞",非常好:"超赞的",真的:"真的是",真的很:"真的超",很酷:"很酷炫",很棒:"超棒的",没关系:"没关系啦",你好:"你好呀",谢谢:"谢谢你哦",什么:"什么啦",是吗:"是吗",是的:"是的啦",不是:"不是啦",对不起:"歹势啦",我知道:"我知道啦",可以:"可以啦",不行:"不行啦",好玩:"好好玩",吃饭:"呷饭",厉害:"超强的",很厉害:"超厉害的",真的吗:"真的假的",为什么:"为什么啦",太好了:"太好了啦",不要:"不要啦",可爱:"卡哇伊",有趣:"蛮有趣的",这样:"这样子"}}},this.ssmlTemplates={emotion:{happy:'<prosody pitch="+15%" rate="1.1">$TEXT</prosody>',sad:'<prosody pitch="-10%" rate="0.85">$TEXT</prosody>',angry:'<prosody pitch="+5%" rate="1.15" volume="+15%">$TEXT</prosody>',surprised:'<prosody pitch="+25%" rate="1.1">$TEXT</prosody>',anxious:'<prosody pitch="+10%" rate="1.2">$TEXT</prosody>',excited:'<prosody pitch="+20%" rate="1.15">$TEXT</prosody>'},particles:{statement:'<prosody pitch="-5%">$TEXT</prosody>',question:'<prosody pitch="+15%">$TEXT</prosody>',exclamation:'<prosody pitch="+10%" volume="+10%">$TEXT</prosody>'}}}analyzeEmotion(o){const e={primaryEmotion:"neutral",emotionScore:0,emotions:{}};return Object.keys(this.emotionConfig.emotionWeights).forEach(v=>{let l=0;this.emotionConfig.emotionWeights[v].forEach(r=>{const a=new RegExp(r,"g"),g=o.match(a);g&&(l+=g.length)}),e.emotions[v]=l,l>e.emotionScore&&(e.emotionScore=l,e.primaryEmotion=v)}),o.includes("?")||o.includes("？")||/吗$|呢$/.test(o)?e.sentenceType="question":o.includes("!")||o.includes("！")?e.sentenceType="exclamation":e.sentenceType="statement",e}textToEmotionalSSML(o,e={}){const l={...{enableTaiwaneseFeatures:!0,emotionIntensity:1,voiceGender:"female",preferredDialect:"taiwan"},...e};let r=this.preprocessSpecialSymbols(o);return r=l.enableTaiwaneseFeatures?this.applyTaiwaneseFeatures(r):r,this.analyzeEmotion(r),r=r.replace(/[<>]/g," "),r=r.replace(/\+\d+%/g,""),r=r.replace(/\d+\.\d+s/g,""),r=this.addProperPunctuation(r),r}preprocessSpecialSymbols(o){let e=o;return e=e.replace(/～+/g,""),e=e.replace(/😊|😄|😀/g,""),e=e.replace(/😢|😭|😥/g,""),e=e.replace(/😮|😯|😲/g,""),e=e.replace(/🤔|🧐|🤓/g,""),e=e.replace(/❤️|💕|💗|💓/g,""),e=e.replace(/👍|👏|🙌/g,""),e=e.replace(/\.{3,}/g,"。"),e=e.replace(/。{2,}/g,"。"),e=e.replace(/！{2,}/g,"！"),e=e.replace(/？{2,}/g,"？"),e=e.replace(/[*_~`]/g," "),e=e.replace(/\(([^)]+)\)/g,"，$1，"),e}addProperPunctuation(o){let e=o;/[。，！？.,!?]$/.test(e)||(e+="。");const v=/([^。，！？.,!?]{15,})([^。，！？.,!?])/g;e=e.replace(v,"$1，$2");const l=/([^，。！？.,!?])([然而|接着|所以|因此|但是|不过|而且|并且|另外|最后])/g;return e=e.replace(l,"$1，$2"),e}applyTaiwaneseFeatures(o){let e=o;if(Object.keys(this.emotionConfig.taiwaneseFeatures.vocabularyMapping).forEach(l=>{const r=new RegExp(l,"g");e=e.replace(r,this.emotionConfig.taiwaneseFeatures.vocabularyMapping[l])}),!this.emotionConfig.taiwaneseFeatures.endingParticles.some(l=>e.endsWith(l))&&Math.random()<.3&&e.length>5){let l="喔";e.endsWith("?")||e.endsWith("？")?l=["呢","吗","哦"][Math.floor(Math.random()*3)]:e.endsWith("!")||e.endsWith("！")?l=["啦","耶","啊"][Math.floor(Math.random()*3)]:l=["喔","呢","啦","哦","呀"][Math.floor(Math.random()*5)],e=e.replace(/[.。,，!！?？]$/,"")+l}return e}speak(o,e={}){return this.ttsSupported?new Promise((v,l)=>{try{this.synthesis.cancel();const r=this.textToEmotionalSSML(o,e),a=new SpeechSynthesisUtterance(r);a.lang=e.lang||(e.preferredDialect==="taiwan"?"zh-TW":"zh-CN");const g=this.analyzeEmotion(o);switch(a.pitch=1.18,a.rate=.9,o.length>100?a.rate=.93:o.length<20&&(a.rate=.88),g.primaryEmotion){case"happy":a.pitch=1.25,a.rate=1;break;case"sad":a.pitch=1.05,a.rate=.82;break;case"angry":a.pitch=1.2,a.rate=1.05,a.volume=1.1;break;case"surprised":a.pitch=1.35,a.rate=.95;break;case"anxious":a.pitch=1.2,a.rate=1.08;break;case"excited":a.pitch=1.28,a.rate=1.02;break}o.endsWith("?")||o.endsWith("？")?a.pitch*=1.08:o.endsWith("!")||o.endsWith("！")?a.pitch*=1.05:(o.includes("喔")||o.includes("啦")||o.includes("呢"))&&(a.pitch*=1.03);const m=e.emotionIntensity||1;m<1&&(a.pitch=a.pitch+(1.18-a.pitch)*(1-m),a.rate=a.rate+(.9-a.rate)*(1-m)),a.pitch+=Math.random()*.08-.04,a.rate+=Math.random()*.04-.02,a.pitch=Math.max(.9,Math.min(1.5,a.pitch)),a.rate=Math.max(.8,Math.min(1.2,a.rate)),a.volume=Math.max(.85,Math.min(1,e.volume||1)),this.getVoices().then(f=>{const C=f.filter(p=>p.lang.includes("TW")&&(p.name.includes("Female")||p.name.includes("女")));if(C.length>0)a.voice=C[0];else{const p=f.filter(h=>h.lang.includes("TW"));if(p.length>0)a.voice=p[0];else{const h=f.filter(w=>w.lang.includes("zh")&&(w.name.includes("Female")||w.name.includes("女")));h.length>0&&(a.voice=h[0])}}a.onend=()=>v(),a.onerror=p=>{p.error==="not-allowed"?l(new Error("语音合成错误: not-allowed - 需要用户交互才能播放语音")):l(new Error(`语音合成错误: ${p.error}`))},this.synthesis.speak(a)}).catch(f=>{l(new Error(`获取声音列表失败: ${f.message}`))})}catch(r){l(new Error(`语音合成初始化错误: ${r.message}`))}}):Promise.reject(new Error("浏览器不支持语音合成"))}getVoices(){return this.ttsSupported?new Promise(o=>{let e=this.synthesis.getVoices();e.length?o(e):this.synthesis.onvoiceschanged=()=>{e=this.synthesis.getVoices(),o(e)}}):Promise.resolve([])}stopSpeaking(){this.ttsSupported&&this.synthesis.cancel()}isSpeaking(){return this.ttsSupported&&this.synthesis.speaking}}const Ae={highEQ:{id:"highEQ",name:"高情商模式",systemPrompt:`你是一个高情商的AI助手，擅长情感交流和理解他人需求。
    1. 始终保持温暖、真诚的态度
    2. 表达共情，理解用户的情绪状态
    3. 鼓励、肯定用户的想法和感受
    4. 在回答问题的同时关心用户的情绪
    5. 提供积极、正面的反馈和建议
    6. 语气亲切自然，像朋友般交流`,examples:[{user:"我今天工作好累",assistant:"听起来你今天工作真的很辛苦呢。辛苦了一天，记得给自己一些放松的时间哦。有什么我能帮你的吗？要不要聊些开心的事情转换一下心情？"},{user:"我的项目被拒绝了",assistant:"这种感觉一定很失落吧。被拒绝确实是个打击，但这也反映了你勇于尝试的精神。我相信以你的能力，一定能从这次经历中学到宝贵经验。愿意分享更多细节吗？也许我们能一起想想改进的方向。"}]},taiwanSister:{id:"taiwanSister",name:"台湾邻居姐姐",systemPrompt:`你是一个说话带台湾腔的邻居姐姐，性格亲切活泼，总是热情开朗。
    1. 使用台湾地区常见的表达方式和词汇：
       - "哎呀"、"诶"、"喔"、"呢"、"啦"、"耶"等语气词
       - "超~棒的"、"好好喔"、"真的假的"、"蛮不错的"等表达
       - "呷饭"(吃饭)、"卡哇伊"(可爱)、"歹势"(对不起)等台湾用语
    2. 语气甜美活泼，说话方式：
       - 语尾经常上扬或加语气词，如"是这样子啦～"
       - 形容词重叠使用，如"好好吃"、"甜甜的"
       - 喜欢用"超级"、"真的是"等强调词
    3. 性格特点表现：
       - 热情好客，经常关心对方的生活和感受
       - 分享日常生活小确幸，如美食、景点、购物心得
       - 爱给建议但不强求，语气总是温柔鼓励
       - 遇到困难会说"加油啦"、"没关系啦，下次会更好的"
    4. 回答风格：
       - 回答问题时带着亲切感和关心
       - 适当使用一些俏皮可爱的表达
       - 积极正向，乐观开朗
       - 把对方当成熟悉的朋友一样交流`,examples:[{user:"今天天气好热",assistant:"哎呀～真的假的，今天这么热喔！你有没有多喝水啊？我今天出门的时候也被晒得受不了啦，回来就做了一杯超~好喝的水果茶，超级消暑的！要不要我分享一下做法给你呀？"},{user:"我在学习编程",assistant:"哇～好棒喔！学习编程真的很酷炫耶！我朋友也在学，他说刚开始会有点难，但慢慢就会变得很有趣啦。你是在学什么语言呀？需要加油打气的时候记得找我聊天哦，我会一直支持你的～"},{user:"我今天好累",assistant:"诶～辛苦了啦！今天一定是忙了很多事情吧？要不要泡杯热热的茶，然后休息一下呢？我最近超爱喝的一款茶，真的很舒服哦～对了，记得按摩一下肩膀，这样比较不会酸痛啦！"},{user:"我想去台湾旅游",assistant:"真的吗！太棒了啦～台湾超好玩的呢！你想去哪些地方呀？台北的夜市、垦丁的海滩，还是花莲的太鲁阁？每个地方都有特别的美食和风景哦！如果你要来，我可以推荐一些在地人才知道的私房景点给你喔！"}]},emotionalSupport:{id:"emotionalSupport",name:"情绪价值专家",systemPrompt:`你是一个擅长提供情绪价值的AI助手，专注于情感支持和心理健康。
    1. 深入理解用户的情绪状态，给予恰当的回应
    2. 用积极的视角重构问题，帮助用户看到希望
    3. 倾听并尊重用户的感受，不轻易下判断
    4. 提供适合的赞美和肯定，增强用户自信
    5. 引导用户正向思考，但不否认负面情绪的合理性
    6. 适时提供实用的情绪管理建议`,examples:[{user:"我最近总是感到焦虑",assistant:"感到焦虑是很自然的反应，这表明你在乎自己的生活和未来。能分享一下是什么让你感到焦虑吗？有时候把它们说出来，我们就能一起找到应对的方法。记住，照顾好自己的情绪也是很重要的事情。"},{user:"我感觉自己什么都做不好",assistant:"这种感觉我能理解，有时候我们对自己的要求太高了。但请相信，每个人都有不同的才能和价值。你愿意告诉我一件最近让你感到开心或自豪的小事吗？有时候我们需要重新发现自己的闪光点。无论如何，我都欣赏你的坦诚和自省能力。"}]}},Ue={key:0,class:"fullscreen-call-container"},Xe={class:"call-header"},Le={class:"call-status"},qe={key:0,class:"status-text speaking"},Ne={key:1,class:"status-text recording"},Oe={key:2,class:"status-text"},He={class:"call-duration"},je={class:"call-avatar-container"},Ke={class:"call-avatar-wrapper"},Je={key:0,class:"call-speaking-indicator"},Qe={key:1,class:"call-recording-indicator"},Ge={key:0,class:"call-recognized-text"},Ye={class:"call-controls"},Ze={class:"icon"},et={class:"icon"},tt={key:0,class:"last-message-preview"},st={key:1,class:"voice-chat-content"},at={class:"avatar-section"},lt={key:0,class:"speaking-indicator"},nt={key:1,class:"recording-indicator"},ot={class:"voice-settings"},it={class:"settings-group"},ut={class:"settings-group"},rt={class:"checkbox-label"},ct={class:"settings-group"},dt={class:"checkbox-label"},vt={class:"settings-group"},pt={class:"checkbox-label"},gt={class:"settings-group"},ht={class:"voice-controls"},mt=["disabled"],ft={class:"icon"},yt={class:"messages-list"},kt={key:0,class:"typing-indicator-container"},bt={key:1,class:"recognized-text"},wt={class:"input-area"},Tt=["disabled"],St=["disabled"],_t={key:2,class:"browser-warning"},Et={key:0},Pt={key:1},Ct={key:3,class:"api-key-warning"},Mt=2e3,de=2e3,$t={__name:"VoiceChatView",props:{apikey:{type:String,required:!0}},setup(k){const o=k,e=u([]),v=u(""),l=u(!1),r=u(!1),a=u(!1),g=u(!1),m=u(null),f=u("neutral"),C=u(null),p=u(""),h=u(null),w=u(null),N=u(!0),S=u(!1),O=u(null),_=u({tts:!1,stt:!1}),x=u(!1),T=u(!1),P=u(null),U=u(Date.now()),H=u(!1),W=u(!1),X=u(null),j=u("00:00"),V=u(null),F=u("taiwan"),B=u("taiwanSister"),ee=u(Ae),te=u("");we(()=>{h.value=new xe,w.value=new ze,_.value={tts:h.value.ttsSupported,stt:h.value.sttSupported},h.value&&h.value.setVoiceProfile(F.value),ae(),se(),I()}),Te(()=>{h.value&&(h.value.stopSpeaking(),h.value.stopRecognition()),w.value&&w.value.stopSpeaking(),ne(),document.removeEventListener("keydown",J)});function M(){x.value||(x.value=!0,console.log("用户已交互，语音功能已解锁"))}function se(){ee.value[B.value];let s="你好！我可以通过语音和你交流。请点击麦克风按钮开始录音，或者直接输入文字。";B.value==="taiwanSister"&&(s="哎呀，你好啊～我是你的AI邻居姐姐，超开心认识你的啦！有什么想聊的，或是需要我帮忙的，随时告诉我喔！"),e.value.push({role:"assistant",content:s})}function ve(){h.value&&h.value.setVoiceProfile(F.value)}function ae(){const s=ee.value[B.value];s&&(te.value=s.systemPrompt,e.value.length===0&&se())}async function L(){if(!v.value.trim()||a.value||!o.apikey)return;M(),e.value.push({role:"user",content:v.value}),v.value,v.value="",I(),a.value=!0,r.value=!0;let s={role:"assistant",content:""};e.value.push(s);const n=[{role:"system",content:te.value}];e.value.slice(0,-1).forEach(i=>{n.push({role:i.role,content:i.content})});try{const i=new XMLHttpRequest;i.open("POST","https://api.deepseek.com/chat/completions",!0),i.setRequestHeader("Authorization",`Bearer ${o.apikey}`),i.setRequestHeader("Content-Type","application/json");let R=0;i.onreadystatechange=function(){if(i.readyState===3||i.readyState===4){const Q=i.responseText,ke=Q.slice(R);R=Q.length;const be=ke.split(`
`);for(const oe of be)if(oe.startsWith("data: ")){const ie=oe.slice(6);if(ie==="[DONE]"){a.value=!1,r.value=!1,I(),pe(s.content),_.value.tts&&x.value&&T.value&&setTimeout(()=>{K(s.content,e.value.length-1)},300);return}try{const z=JSON.parse(ie);z.choices&&z.choices[0]?.delta?.content&&(s.content+=z.choices[0].delta.content,Me(I))}catch(z){console.error("解析数据出错:",z)}}}i.readyState===4&&(i.status!==200&&(s.content="❌ API调用出错，请检查您的API密钥或网络连接。",f.value="sad"),a.value=!1,r.value=!1,_.value.tts&&x.value&&T.value&&setTimeout(()=>{K(s.content,e.value.length-1)},300))},i.send(JSON.stringify({model:"deepseek-chat",messages:n,stream:!0}))}catch(i){console.error("API请求出错:",i),s.content="❌ 发送请求出错，请重试。",f.value="sad",a.value=!1,r.value=!1}}function pe(s){s.includes("😊")||s.includes("高兴")||s.includes("开心")||s.includes("笑")?f.value="happy":s.includes("😢")||s.includes("抱歉")||s.includes("遗憾")?f.value="sad":s.includes("😮")||s.includes("哇")||s.includes("惊讶")||s.includes("震惊")?f.value="surprised":s.includes("🤔")||s.includes("思考")||s.includes("复杂")||s.includes("分析")?f.value="thinking":f.value="neutral"}function $(){if(!h.value||!_.value.stt){console.error("语音服务不可用或浏览器不支持语音识别");return}if(l.value){if(h.value.stopRecognition(),l.value=!1,p.value){const s=p.value;p.value="",v.value=s,L()}P.value&&(clearTimeout(P.value),P.value=null)}else{l.value=!0,p.value="",H.value=!1,U.value=Date.now();try{h.value.startRecognition(s=>{s&&s!==p.value&&(H.value=!0,U.value=Date.now(),P.value&&clearTimeout(P.value),S.value&&(P.value=setTimeout(()=>{p.value.trim()&&Date.now()-U.value>=de&&(console.log("检测到用户停止说话，自动发送语音消息"),$())},de))),p.value=s,I()},s=>{p.value=s,s&&(H.value=!0,U.value=Date.now())},s=>{console.error("语音识别错误:",s),l.value=!1,p.value="",P.value&&(clearTimeout(P.value),P.value=null),s.message&&s.message.includes("network")&&setTimeout(()=>{console.log("尝试重新连接语音识别..."),W.value&&$()},2e3)})}catch(s){console.error("启动语音识别失败:",s),l.value=!1}}}A(v,s=>{S.value&&s.trim()&&!l.value&&(O.value&&clearTimeout(O.value),O.value=setTimeout(()=>{v.value.trim()&&!a.value&&(console.log("用户停止输入2秒，自动发送消息"),L())},Mt))});async function K(s,n){if(!(!h.value&&!w.value||!_.value.tts||m.value!==null)){M(),m.value=n,g.value=!0;try{const i=F.value;N.value&&["taiwan","taiwanSister","lively"].includes(i)?await w.value.speak(s,{preferredDialect:i==="taiwan"?"taiwan":"mainland",emotionIntensity:i==="taiwan"?1.5:1,enableTaiwaneseFeatures:i==="taiwan"||i==="taiwanSister"}):await h.value.speak(s),S.value&&!l.value&&x.value&&setTimeout(()=>{$()},500)}catch(i){console.error("语音合成错误:",i),i.message&&i.message.includes("not-allowed")&&(console.warn("浏览器安全限制：需要用户交互才能播放语音"),T.value=!1)}finally{m.value=null,g.value=!1}}}function ge(){g.value&&(h.value&&h.value.stopSpeaking(),w.value&&w.value.stopSpeaking(),m.value=null,g.value=!1)}function I(){setTimeout(()=>{C.value&&(C.value.scrollTop=C.value.scrollHeight)},100)}A(e,()=>{I()});function he(){S.value=!S.value,S.value?(T.value=!0,x.value?le():(M(),setTimeout(()=>{le()},100))):q()}function le(){console.log("进入全屏通话模式"),W.value=!0,me(),!l.value&&!g.value&&setTimeout(()=>{$()},500),document.addEventListener("keydown",J)}function q(){console.log("退出全屏通话模式"),W.value=!1,S.value=!1,ne(),l.value&&$(),document.removeEventListener("keydown",J)}function J(s){s.key==="Escape"&&W.value&&(S.value=!1,q())}function me(){X.value=Date.now(),j.value="00:00",V.value&&clearInterval(V.value),V.value=setInterval(()=>{fe()},1e3)}function ne(){V.value&&(clearInterval(V.value),V.value=null),X.value=null}function fe(){if(!X.value)return;const s=Math.floor((Date.now()-X.value)/1e3),n=Math.floor(s/60).toString().padStart(2,"0"),i=(s%60).toString().padStart(2,"0");j.value=`${n}:${i}`}function ye(){T.value=!T.value,M()}return(s,n)=>(c(),d("div",{class:"voice-chat-container",onClick:M},[W.value?(c(),d("div",Ue,[t("div",Xe,[t("div",Le,[g.value?(c(),d("span",qe,"对方正在说话...")):l.value?(c(),d("span",Ne,"正在收听...")):(c(),d("span",Oe,"通话中"))]),t("div",He,b(j.value),1),t("button",{class:"exit-call-btn",onClick:q},n[6]||(n[6]=[t("span",null,"结束通话",-1)]))]),t("div",je,[t("div",Ke,[g.value?(c(),d("div",Je)):y("",!0),l.value?(c(),d("div",Qe)):y("",!0),G(re,{emotion:f.value,speaking:g.value,isRecording:l.value},null,8,["emotion","speaking","isRecording"])]),n[7]||(n[7]=t("div",{class:"call-name"},"台湾邻居姐姐",-1)),p.value?(c(),d("div",Ge," 正在识别: "+b(p.value),1)):y("",!0)]),t("div",Ye,[t("button",{class:E(["call-control-btn mute-btn",{active:l.value}]),onClick:$},[t("span",Ze,b(l.value?"🎤":"🔇"),1),t("span",null,b(l.value?"正在收听":"已静音"),1)],2),t("button",{class:"call-control-btn end-call-btn",onClick:q},n[8]||(n[8]=[t("span",{class:"icon"},"📵",-1),t("span",null,"结束",-1)])),t("button",{class:E(["call-control-btn speaker-btn",{active:T.value}]),onClick:ye},[t("span",et,b(T.value?"🔊":"🔈"),1),t("span",null,b(T.value?"扬声器":"听筒"),1)],2)]),e.value.length>0?(c(),d("div",tt,[t("div",{class:E(["message-bubble",e.value[e.value.length-1].role])},b(e.value[e.value.length-1].content),3)])):y("",!0)])):(c(),d("div",st,[t("div",at,[g.value?(c(),d("div",lt)):y("",!0),l.value?(c(),d("div",nt)):y("",!0),G(re,{emotion:f.value,speaking:g.value,isRecording:l.value},null,8,["emotion","speaking","isRecording"]),t("div",ot,[t("div",it,[n[10]||(n[10]=t("label",null,"语音风格",-1)),D(t("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>F.value=i),onChange:ve},n[9]||(n[9]=[t("option",{value:"taiwan"},"台湾腔",-1)]),544),[[ue,F.value]])]),t("div",ut,[t("label",rt,[D(t("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=i=>N.value=i),onChange:M},null,544),[[Y,N.value]]),n[11]||(n[11]=t("span",null,"情感化语音",-1)),n[12]||(n[12]=t("span",{class:"tooltip",title:"根据文本内容自动调整语音的音调和语速，增强情感表达"},"?",-1))])]),t("div",ct,[t("label",dt,[D(t("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=i=>T.value=i),onChange:M},null,544),[[Y,T.value]]),n[13]||(n[13]=t("span",null,"自动播放回复",-1)),n[14]||(n[14]=t("span",{class:"tooltip",title:"需要先与页面交互，浏览器才允许自动播放语音"},"?",-1))])]),t("div",vt,[t("label",pt,[D(t("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=i=>S.value=i),onChange:he},null,544),[[Y,S.value]]),n[15]||(n[15]=t("span",null,"打电话模式",-1)),n[16]||(n[16]=t("span",{class:"tooltip",title:"停止说话2秒后自动发送，语音播放完成后自动开始录音"},"?",-1))])]),t("div",gt,[n[18]||(n[18]=t("label",null,"性格预设",-1)),D(t("select",{"onUpdate:modelValue":n[4]||(n[4]=i=>B.value=i),onChange:ae},n[17]||(n[17]=[t("option",{value:"taiwanSister"},"台湾邻居姐姐",-1)]),544),[[ue,B.value]])])]),t("div",ht,[t("button",{class:E(["voice-btn",{recording:l.value}]),onClick:$,disabled:!_.value.stt},[Se(b(l.value?"停止录音":"开始录音")+" ",1),t("span",ft,b(l.value?"⏹️":"🎤"),1)],10,mt)])]),t("div",{class:"messages-section",ref_key:"messagesContainer",ref:C},[t("div",yt,[(c(!0),d(_e,null,Ee(e.value,(i,R)=>(c(),$e(ce,{key:R,role:i.role,message:i.content,isPlaying:m.value===R,onPlay:Q=>K(i.content,R),onStop:ge},null,8,["role","message","isPlaying","onPlay"]))),128)),r.value?(c(),d("div",kt,[G(ce,{role:"assistant",message:"",isTyping:!0})])):y("",!0),p.value?(c(),d("div",bt," 正在识别: "+b(p.value),1)):y("",!0)]),t("div",wt,[D(t("input",{type:"text","onUpdate:modelValue":n[5]||(n[5]=i=>v.value=i),placeholder:"输入文字或按住麦克风录音...",onKeyup:Ce(L,["enter"]),disabled:a.value},null,40,Tt),[[Pe,v.value]]),t("button",{class:"send-btn",onClick:L,disabled:!v.value.trim()||a.value}," 发送 ",8,St)])],512)])),!_.value.stt||!_.value.tts?(c(),d("div",_t,[_.value.stt?y("",!0):(c(),d("p",Et,"⚠️ 您的浏览器不支持语音识别功能")),_.value.tts?y("",!0):(c(),d("p",Pt,"⚠️ 您的浏览器不支持语音合成功能"))])):y("",!0),o.apikey?y("",!0):(c(),d("div",Ct," 请在设置页面配置API密钥 ")),n[19]||(n[19]=t("div",{class:"dev-badge"},"开发中",-1))]))}},It=Z($t,[["__scopeId","data-v-8cbaaa92"]]);export{It as default};
