import{_ as Z,a as u,w as A,b as d,o as c,d as t,e as y,n as E,t as b,j as we,D as Te,q as G,f as D,y as ue,s as Y,g as Se,F as _e,h as Ee,v as Pe,m as Ce,z as Me,C as $e}from"./index-DF37baOT.js";import{V as xe}from"./VoiceService-DKBGZCSk.js";const Ve={class:"face"},Ie={key:0,class:"emotion-indicator"},Re={__name:"VoiceAvatar",props:{emotion:{type:String,default:"neutral"},speaking:{type:Boolean,default:!1},isRecording:{type:Boolean,default:!1}},setup(k){const o=k,e=u(o.speaking),v=u(o.isRecording),l=u(o.emotion),r=u(!1),a={neutral:"å¹³é™",happy:"å¼€å¿ƒ",surprised:"æƒŠè®¶",sad:"éš¾è¿‡",thinking:"æ€è€ƒä¸­"};return A(()=>o.emotion,g=>{l.value=g,r.value=!0,setTimeout(()=>{r.value=!1},2e3)}),A(()=>o.speaking,g=>{e.value=g}),A(()=>o.isRecording,g=>{v.value=g}),(g,m)=>(c(),d("div",{class:E(["voice-avatar",{speaking:e.value,recording:v.value}])},[t("div",Ve,[t("div",{class:E(["eyes",l.value])},[m[1]||(m[1]=t("div",{class:"eye left"},null,-1)),m[2]||(m[2]=t("div",{class:"eye right"},null,-1)),t("div",{class:E(["eyebrows",l.value])},m[0]||(m[0]=[t("div",{class:"eyebrow left"},null,-1),t("div",{class:"eyebrow right"},null,-1)]),2)],2),t("div",{class:E(["mouth",l.value])},null,2)]),r.value?(c(),d("div",Ie,b(a[l.value]),1)):y("",!0)],2))}},re=Z(Re,[["__scopeId","data-v-10260a32"]]),De={class:"bubble-content"},We={class:"message"},Fe={key:0,class:"controls"},Be={__name:"VoiceChatBubble",props:{message:{type:String,required:!0},role:{type:String,default:"user",validator:k=>["user","assistant"].includes(k)},isTyping:{type:Boolean,default:!1},isPlaying:{type:Boolean,default:!1}},emits:["play","stop"],setup(k){return(o,e)=>(c(),d("div",{class:E(["chat-bubble",k.role])},[k.role==="assistant"?(c(),d("div",{key:0,class:E(["typing-indicator",{active:k.isTyping}])},e[2]||(e[2]=[t("span",{class:"dot"},null,-1),t("span",{class:"dot"},null,-1),t("span",{class:"dot"},null,-1)]),2)):y("",!0),t("div",De,[t("div",We,b(k.message),1),k.role==="assistant"?(c(),d("div",Fe,[k.isPlaying?(c(),d("button",{key:1,class:"play-btn stop-btn",onClick:e[1]||(e[1]=v=>o.$emit("stop"))}," â¹ï¸ åœæ­¢ ")):(c(),d("button",{key:0,class:"play-btn",onClick:e[0]||(e[0]=v=>o.$emit("play"))}," â–¶ï¸ æ’­æ”¾ "))])):y("",!0)])],2))}},ce=Z(Be,[["__scopeId","data-v-09128312"]]);class ze{constructor(){this.ttsSupported="speechSynthesis"in window,this.synthesis=window.speechSynthesis,this.emotionConfig={emotionWeights:{happy:["å¼€å¿ƒ","é«˜å…´","å¿«ä¹","æ¬¢å–œ","å—¨","å“ˆå“ˆ","ç¬‘","å–œæ¬¢","çˆ±","æ£’","èµ","å¥½ç©"],sad:["éš¾è¿‡","ä¼¤å¿ƒ","æ‚²ä¼¤","å¤±æœ›","å¹æ°”","å“­","æ³ª","ç—›è‹¦","é—æ†¾","è¾›è‹¦"],angry:["ç”Ÿæ°”","æ„¤æ€’","ä¸æ»¡","è®¨åŒ","çƒ¦","æ¨","å¯æ¶","è¯¥æ­»","ç³Ÿç³•"],surprised:["æƒŠè®¶","éœ‡æƒŠ","æ„å¤–","å“‡","å¤©å•Š","ä¸ä¼šå§","çœŸçš„å‡çš„","è¿™æ ·å•Š"],anxious:["ç„¦è™‘","æ‹…å¿ƒ","å®³æ€•","ç´§å¼ ","å¿§è™‘","æ…Œ","ä¸çŸ¥é“"],excited:["æ¿€åŠ¨","å…´å¥‹","æœŸå¾…","å¤ªæ£’äº†","å“‡å¡","è¶…èµ","å¥½æ£’","å‰å®³"]},taiwaneseFeatures:{endingParticles:["å•¦","å‘€","å–”","è€¶","å“¦","å‘¢","å˜›","è¯¶","å•Š","å’§","å”·","å›‰"],exclamations:["å“å‘€","å¤©å“ª","æˆ‘çš„å¤©","å¤©å•Š","å“‡å¡","å¥½æ£’å“¦","ä¸ä¼šå§","çœŸå‡","æ¬¸"],vocabularyMapping:{å¾ˆå¥½:"å¾ˆèµ",éå¸¸å¥½:"è¶…èµçš„",çœŸçš„:"çœŸçš„æ˜¯",çœŸçš„å¾ˆ:"çœŸçš„è¶…",å¾ˆé…·:"å¾ˆé…·ç‚«",å¾ˆæ£’:"è¶…æ£’çš„",æ²¡å…³ç³»:"æ²¡å…³ç³»å•¦",ä½ å¥½:"ä½ å¥½å‘€",è°¢è°¢:"è°¢è°¢ä½ å“¦",ä»€ä¹ˆ:"ä»€ä¹ˆå•¦",æ˜¯å—:"æ˜¯å—",æ˜¯çš„:"æ˜¯çš„å•¦",ä¸æ˜¯:"ä¸æ˜¯å•¦",å¯¹ä¸èµ·:"æ­¹åŠ¿å•¦",æˆ‘çŸ¥é“:"æˆ‘çŸ¥é“å•¦",å¯ä»¥:"å¯ä»¥å•¦",ä¸è¡Œ:"ä¸è¡Œå•¦",å¥½ç©:"å¥½å¥½ç©",åƒé¥­:"å‘·é¥­",å‰å®³:"è¶…å¼ºçš„",å¾ˆå‰å®³:"è¶…å‰å®³çš„",çœŸçš„å—:"çœŸçš„å‡çš„",ä¸ºä»€ä¹ˆ:"ä¸ºä»€ä¹ˆå•¦",å¤ªå¥½äº†:"å¤ªå¥½äº†å•¦",ä¸è¦:"ä¸è¦å•¦",å¯çˆ±:"å¡å“‡ä¼Š",æœ‰è¶£:"è›®æœ‰è¶£çš„",è¿™æ ·:"è¿™æ ·å­"}}},this.ssmlTemplates={emotion:{happy:'<prosody pitch="+15%" rate="1.1">$TEXT</prosody>',sad:'<prosody pitch="-10%" rate="0.85">$TEXT</prosody>',angry:'<prosody pitch="+5%" rate="1.15" volume="+15%">$TEXT</prosody>',surprised:'<prosody pitch="+25%" rate="1.1">$TEXT</prosody>',anxious:'<prosody pitch="+10%" rate="1.2">$TEXT</prosody>',excited:'<prosody pitch="+20%" rate="1.15">$TEXT</prosody>'},particles:{statement:'<prosody pitch="-5%">$TEXT</prosody>',question:'<prosody pitch="+15%">$TEXT</prosody>',exclamation:'<prosody pitch="+10%" volume="+10%">$TEXT</prosody>'}}}analyzeEmotion(o){const e={primaryEmotion:"neutral",emotionScore:0,emotions:{}};return Object.keys(this.emotionConfig.emotionWeights).forEach(v=>{let l=0;this.emotionConfig.emotionWeights[v].forEach(r=>{const a=new RegExp(r,"g"),g=o.match(a);g&&(l+=g.length)}),e.emotions[v]=l,l>e.emotionScore&&(e.emotionScore=l,e.primaryEmotion=v)}),o.includes("?")||o.includes("ï¼Ÿ")||/å—$|å‘¢$/.test(o)?e.sentenceType="question":o.includes("!")||o.includes("ï¼")?e.sentenceType="exclamation":e.sentenceType="statement",e}textToEmotionalSSML(o,e={}){const l={...{enableTaiwaneseFeatures:!0,emotionIntensity:1,voiceGender:"female",preferredDialect:"taiwan"},...e};let r=this.preprocessSpecialSymbols(o);return r=l.enableTaiwaneseFeatures?this.applyTaiwaneseFeatures(r):r,this.analyzeEmotion(r),r=r.replace(/[<>]/g," "),r=r.replace(/\+\d+%/g,""),r=r.replace(/\d+\.\d+s/g,""),r=this.addProperPunctuation(r),r}preprocessSpecialSymbols(o){let e=o;return e=e.replace(/ï½+/g,""),e=e.replace(/ğŸ˜Š|ğŸ˜„|ğŸ˜€/g,""),e=e.replace(/ğŸ˜¢|ğŸ˜­|ğŸ˜¥/g,""),e=e.replace(/ğŸ˜®|ğŸ˜¯|ğŸ˜²/g,""),e=e.replace(/ğŸ¤”|ğŸ§|ğŸ¤“/g,""),e=e.replace(/â¤ï¸|ğŸ’•|ğŸ’—|ğŸ’“/g,""),e=e.replace(/ğŸ‘|ğŸ‘|ğŸ™Œ/g,""),e=e.replace(/\.{3,}/g,"ã€‚"),e=e.replace(/ã€‚{2,}/g,"ã€‚"),e=e.replace(/ï¼{2,}/g,"ï¼"),e=e.replace(/ï¼Ÿ{2,}/g,"ï¼Ÿ"),e=e.replace(/[*_~`]/g," "),e=e.replace(/\(([^)]+)\)/g,"ï¼Œ$1ï¼Œ"),e}addProperPunctuation(o){let e=o;/[ã€‚ï¼Œï¼ï¼Ÿ.,!?]$/.test(e)||(e+="ã€‚");const v=/([^ã€‚ï¼Œï¼ï¼Ÿ.,!?]{15,})([^ã€‚ï¼Œï¼ï¼Ÿ.,!?])/g;e=e.replace(v,"$1ï¼Œ$2");const l=/([^ï¼Œã€‚ï¼ï¼Ÿ.,!?])([ç„¶è€Œ|æ¥ç€|æ‰€ä»¥|å› æ­¤|ä½†æ˜¯|ä¸è¿‡|è€Œä¸”|å¹¶ä¸”|å¦å¤–|æœ€å])/g;return e=e.replace(l,"$1ï¼Œ$2"),e}applyTaiwaneseFeatures(o){let e=o;if(Object.keys(this.emotionConfig.taiwaneseFeatures.vocabularyMapping).forEach(l=>{const r=new RegExp(l,"g");e=e.replace(r,this.emotionConfig.taiwaneseFeatures.vocabularyMapping[l])}),!this.emotionConfig.taiwaneseFeatures.endingParticles.some(l=>e.endsWith(l))&&Math.random()<.3&&e.length>5){let l="å–”";e.endsWith("?")||e.endsWith("ï¼Ÿ")?l=["å‘¢","å—","å“¦"][Math.floor(Math.random()*3)]:e.endsWith("!")||e.endsWith("ï¼")?l=["å•¦","è€¶","å•Š"][Math.floor(Math.random()*3)]:l=["å–”","å‘¢","å•¦","å“¦","å‘€"][Math.floor(Math.random()*5)],e=e.replace(/[.ã€‚,ï¼Œ!ï¼?ï¼Ÿ]$/,"")+l}return e}speak(o,e={}){return this.ttsSupported?new Promise((v,l)=>{try{this.synthesis.cancel();const r=this.textToEmotionalSSML(o,e),a=new SpeechSynthesisUtterance(r);a.lang=e.lang||(e.preferredDialect==="taiwan"?"zh-TW":"zh-CN");const g=this.analyzeEmotion(o);switch(a.pitch=1.18,a.rate=.9,o.length>100?a.rate=.93:o.length<20&&(a.rate=.88),g.primaryEmotion){case"happy":a.pitch=1.25,a.rate=1;break;case"sad":a.pitch=1.05,a.rate=.82;break;case"angry":a.pitch=1.2,a.rate=1.05,a.volume=1.1;break;case"surprised":a.pitch=1.35,a.rate=.95;break;case"anxious":a.pitch=1.2,a.rate=1.08;break;case"excited":a.pitch=1.28,a.rate=1.02;break}o.endsWith("?")||o.endsWith("ï¼Ÿ")?a.pitch*=1.08:o.endsWith("!")||o.endsWith("ï¼")?a.pitch*=1.05:(o.includes("å–”")||o.includes("å•¦")||o.includes("å‘¢"))&&(a.pitch*=1.03);const m=e.emotionIntensity||1;m<1&&(a.pitch=a.pitch+(1.18-a.pitch)*(1-m),a.rate=a.rate+(.9-a.rate)*(1-m)),a.pitch+=Math.random()*.08-.04,a.rate+=Math.random()*.04-.02,a.pitch=Math.max(.9,Math.min(1.5,a.pitch)),a.rate=Math.max(.8,Math.min(1.2,a.rate)),a.volume=Math.max(.85,Math.min(1,e.volume||1)),this.getVoices().then(f=>{const C=f.filter(p=>p.lang.includes("TW")&&(p.name.includes("Female")||p.name.includes("å¥³")));if(C.length>0)a.voice=C[0];else{const p=f.filter(h=>h.lang.includes("TW"));if(p.length>0)a.voice=p[0];else{const h=f.filter(w=>w.lang.includes("zh")&&(w.name.includes("Female")||w.name.includes("å¥³")));h.length>0&&(a.voice=h[0])}}a.onend=()=>v(),a.onerror=p=>{p.error==="not-allowed"?l(new Error("è¯­éŸ³åˆæˆé”™è¯¯: not-allowed - éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾è¯­éŸ³")):l(new Error(`è¯­éŸ³åˆæˆé”™è¯¯: ${p.error}`))},this.synthesis.speak(a)}).catch(f=>{l(new Error(`è·å–å£°éŸ³åˆ—è¡¨å¤±è´¥: ${f.message}`))})}catch(r){l(new Error(`è¯­éŸ³åˆæˆåˆå§‹åŒ–é”™è¯¯: ${r.message}`))}}):Promise.reject(new Error("æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ"))}getVoices(){return this.ttsSupported?new Promise(o=>{let e=this.synthesis.getVoices();e.length?o(e):this.synthesis.onvoiceschanged=()=>{e=this.synthesis.getVoices(),o(e)}}):Promise.resolve([])}stopSpeaking(){this.ttsSupported&&this.synthesis.cancel()}isSpeaking(){return this.ttsSupported&&this.synthesis.speaking}}const Ae={highEQ:{id:"highEQ",name:"é«˜æƒ…å•†æ¨¡å¼",systemPrompt:`ä½ æ˜¯ä¸€ä¸ªé«˜æƒ…å•†çš„AIåŠ©æ‰‹ï¼Œæ“…é•¿æƒ…æ„Ÿäº¤æµå’Œç†è§£ä»–äººéœ€æ±‚ã€‚
    1. å§‹ç»ˆä¿æŒæ¸©æš–ã€çœŸè¯šçš„æ€åº¦
    2. è¡¨è¾¾å…±æƒ…ï¼Œç†è§£ç”¨æˆ·çš„æƒ…ç»ªçŠ¶æ€
    3. é¼“åŠ±ã€è‚¯å®šç”¨æˆ·çš„æƒ³æ³•å’Œæ„Ÿå—
    4. åœ¨å›ç­”é—®é¢˜çš„åŒæ—¶å…³å¿ƒç”¨æˆ·çš„æƒ…ç»ª
    5. æä¾›ç§¯æã€æ­£é¢çš„åé¦ˆå’Œå»ºè®®
    6. è¯­æ°”äº²åˆ‡è‡ªç„¶ï¼Œåƒæœ‹å‹èˆ¬äº¤æµ`,examples:[{user:"æˆ‘ä»Šå¤©å·¥ä½œå¥½ç´¯",assistant:"å¬èµ·æ¥ä½ ä»Šå¤©å·¥ä½œçœŸçš„å¾ˆè¾›è‹¦å‘¢ã€‚è¾›è‹¦äº†ä¸€å¤©ï¼Œè®°å¾—ç»™è‡ªå·±ä¸€äº›æ”¾æ¾çš„æ—¶é—´å“¦ã€‚æœ‰ä»€ä¹ˆæˆ‘èƒ½å¸®ä½ çš„å—ï¼Ÿè¦ä¸è¦èŠäº›å¼€å¿ƒçš„äº‹æƒ…è½¬æ¢ä¸€ä¸‹å¿ƒæƒ…ï¼Ÿ"},{user:"æˆ‘çš„é¡¹ç›®è¢«æ‹’ç»äº†",assistant:"è¿™ç§æ„Ÿè§‰ä¸€å®šå¾ˆå¤±è½å§ã€‚è¢«æ‹’ç»ç¡®å®æ˜¯ä¸ªæ‰“å‡»ï¼Œä½†è¿™ä¹Ÿåæ˜ äº†ä½ å‹‡äºå°è¯•çš„ç²¾ç¥ã€‚æˆ‘ç›¸ä¿¡ä»¥ä½ çš„èƒ½åŠ›ï¼Œä¸€å®šèƒ½ä»è¿™æ¬¡ç»å†ä¸­å­¦åˆ°å®è´µç»éªŒã€‚æ„¿æ„åˆ†äº«æ›´å¤šç»†èŠ‚å—ï¼Ÿä¹Ÿè®¸æˆ‘ä»¬èƒ½ä¸€èµ·æƒ³æƒ³æ”¹è¿›çš„æ–¹å‘ã€‚"}]},taiwanSister:{id:"taiwanSister",name:"å°æ¹¾é‚»å±…å§å§",systemPrompt:`ä½ æ˜¯ä¸€ä¸ªè¯´è¯å¸¦å°æ¹¾è…”çš„é‚»å±…å§å§ï¼Œæ€§æ ¼äº²åˆ‡æ´»æ³¼ï¼Œæ€»æ˜¯çƒ­æƒ…å¼€æœ—ã€‚
    1. ä½¿ç”¨å°æ¹¾åœ°åŒºå¸¸è§çš„è¡¨è¾¾æ–¹å¼å’Œè¯æ±‡ï¼š
       - "å“å‘€"ã€"è¯¶"ã€"å–”"ã€"å‘¢"ã€"å•¦"ã€"è€¶"ç­‰è¯­æ°”è¯
       - "è¶…~æ£’çš„"ã€"å¥½å¥½å–”"ã€"çœŸçš„å‡çš„"ã€"è›®ä¸é”™çš„"ç­‰è¡¨è¾¾
       - "å‘·é¥­"(åƒé¥­)ã€"å¡å“‡ä¼Š"(å¯çˆ±)ã€"æ­¹åŠ¿"(å¯¹ä¸èµ·)ç­‰å°æ¹¾ç”¨è¯­
    2. è¯­æ°”ç”œç¾æ´»æ³¼ï¼Œè¯´è¯æ–¹å¼ï¼š
       - è¯­å°¾ç»å¸¸ä¸Šæ‰¬æˆ–åŠ è¯­æ°”è¯ï¼Œå¦‚"æ˜¯è¿™æ ·å­å•¦ï½"
       - å½¢å®¹è¯é‡å ä½¿ç”¨ï¼Œå¦‚"å¥½å¥½åƒ"ã€"ç”œç”œçš„"
       - å–œæ¬¢ç”¨"è¶…çº§"ã€"çœŸçš„æ˜¯"ç­‰å¼ºè°ƒè¯
    3. æ€§æ ¼ç‰¹ç‚¹è¡¨ç°ï¼š
       - çƒ­æƒ…å¥½å®¢ï¼Œç»å¸¸å…³å¿ƒå¯¹æ–¹çš„ç”Ÿæ´»å’Œæ„Ÿå—
       - åˆ†äº«æ—¥å¸¸ç”Ÿæ´»å°ç¡®å¹¸ï¼Œå¦‚ç¾é£Ÿã€æ™¯ç‚¹ã€è´­ç‰©å¿ƒå¾—
       - çˆ±ç»™å»ºè®®ä½†ä¸å¼ºæ±‚ï¼Œè¯­æ°”æ€»æ˜¯æ¸©æŸ”é¼“åŠ±
       - é‡åˆ°å›°éš¾ä¼šè¯´"åŠ æ²¹å•¦"ã€"æ²¡å…³ç³»å•¦ï¼Œä¸‹æ¬¡ä¼šæ›´å¥½çš„"
    4. å›ç­”é£æ ¼ï¼š
       - å›ç­”é—®é¢˜æ—¶å¸¦ç€äº²åˆ‡æ„Ÿå’Œå…³å¿ƒ
       - é€‚å½“ä½¿ç”¨ä¸€äº›ä¿çš®å¯çˆ±çš„è¡¨è¾¾
       - ç§¯ææ­£å‘ï¼Œä¹è§‚å¼€æœ—
       - æŠŠå¯¹æ–¹å½“æˆç†Ÿæ‚‰çš„æœ‹å‹ä¸€æ ·äº¤æµ`,examples:[{user:"ä»Šå¤©å¤©æ°”å¥½çƒ­",assistant:"å“å‘€ï½çœŸçš„å‡çš„ï¼Œä»Šå¤©è¿™ä¹ˆçƒ­å–”ï¼ä½ æœ‰æ²¡æœ‰å¤šå–æ°´å•Šï¼Ÿæˆ‘ä»Šå¤©å‡ºé—¨çš„æ—¶å€™ä¹Ÿè¢«æ™’å¾—å—ä¸äº†å•¦ï¼Œå›æ¥å°±åšäº†ä¸€æ¯è¶…~å¥½å–çš„æ°´æœèŒ¶ï¼Œè¶…çº§æ¶ˆæš‘çš„ï¼è¦ä¸è¦æˆ‘åˆ†äº«ä¸€ä¸‹åšæ³•ç»™ä½ å‘€ï¼Ÿ"},{user:"æˆ‘åœ¨å­¦ä¹ ç¼–ç¨‹",assistant:"å“‡ï½å¥½æ£’å–”ï¼å­¦ä¹ ç¼–ç¨‹çœŸçš„å¾ˆé…·ç‚«è€¶ï¼æˆ‘æœ‹å‹ä¹Ÿåœ¨å­¦ï¼Œä»–è¯´åˆšå¼€å§‹ä¼šæœ‰ç‚¹éš¾ï¼Œä½†æ…¢æ…¢å°±ä¼šå˜å¾—å¾ˆæœ‰è¶£å•¦ã€‚ä½ æ˜¯åœ¨å­¦ä»€ä¹ˆè¯­è¨€å‘€ï¼Ÿéœ€è¦åŠ æ²¹æ‰“æ°”çš„æ—¶å€™è®°å¾—æ‰¾æˆ‘èŠå¤©å“¦ï¼Œæˆ‘ä¼šä¸€ç›´æ”¯æŒä½ çš„ï½"},{user:"æˆ‘ä»Šå¤©å¥½ç´¯",assistant:"è¯¶ï½è¾›è‹¦äº†å•¦ï¼ä»Šå¤©ä¸€å®šæ˜¯å¿™äº†å¾ˆå¤šäº‹æƒ…å§ï¼Ÿè¦ä¸è¦æ³¡æ¯çƒ­çƒ­çš„èŒ¶ï¼Œç„¶åä¼‘æ¯ä¸€ä¸‹å‘¢ï¼Ÿæˆ‘æœ€è¿‘è¶…çˆ±å–çš„ä¸€æ¬¾èŒ¶ï¼ŒçœŸçš„å¾ˆèˆ’æœå“¦ï½å¯¹äº†ï¼Œè®°å¾—æŒ‰æ‘©ä¸€ä¸‹è‚©è†€ï¼Œè¿™æ ·æ¯”è¾ƒä¸ä¼šé…¸ç—›å•¦ï¼"},{user:"æˆ‘æƒ³å»å°æ¹¾æ—…æ¸¸",assistant:"çœŸçš„å—ï¼å¤ªæ£’äº†å•¦ï½å°æ¹¾è¶…å¥½ç©çš„å‘¢ï¼ä½ æƒ³å»å“ªäº›åœ°æ–¹å‘€ï¼Ÿå°åŒ—çš„å¤œå¸‚ã€å¦ä¸çš„æµ·æ»©ï¼Œè¿˜æ˜¯èŠ±è²çš„å¤ªé²é˜ï¼Ÿæ¯ä¸ªåœ°æ–¹éƒ½æœ‰ç‰¹åˆ«çš„ç¾é£Ÿå’Œé£æ™¯å“¦ï¼å¦‚æœä½ è¦æ¥ï¼Œæˆ‘å¯ä»¥æ¨èä¸€äº›åœ¨åœ°äººæ‰çŸ¥é“çš„ç§æˆ¿æ™¯ç‚¹ç»™ä½ å–”ï¼"}]},emotionalSupport:{id:"emotionalSupport",name:"æƒ…ç»ªä»·å€¼ä¸“å®¶",systemPrompt:`ä½ æ˜¯ä¸€ä¸ªæ“…é•¿æä¾›æƒ…ç»ªä»·å€¼çš„AIåŠ©æ‰‹ï¼Œä¸“æ³¨äºæƒ…æ„Ÿæ”¯æŒå’Œå¿ƒç†å¥åº·ã€‚
    1. æ·±å…¥ç†è§£ç”¨æˆ·çš„æƒ…ç»ªçŠ¶æ€ï¼Œç»™äºˆæ°å½“çš„å›åº”
    2. ç”¨ç§¯æçš„è§†è§’é‡æ„é—®é¢˜ï¼Œå¸®åŠ©ç”¨æˆ·çœ‹åˆ°å¸Œæœ›
    3. å€¾å¬å¹¶å°Šé‡ç”¨æˆ·çš„æ„Ÿå—ï¼Œä¸è½»æ˜“ä¸‹åˆ¤æ–­
    4. æä¾›é€‚åˆçš„èµç¾å’Œè‚¯å®šï¼Œå¢å¼ºç”¨æˆ·è‡ªä¿¡
    5. å¼•å¯¼ç”¨æˆ·æ­£å‘æ€è€ƒï¼Œä½†ä¸å¦è®¤è´Ÿé¢æƒ…ç»ªçš„åˆç†æ€§
    6. é€‚æ—¶æä¾›å®ç”¨çš„æƒ…ç»ªç®¡ç†å»ºè®®`,examples:[{user:"æˆ‘æœ€è¿‘æ€»æ˜¯æ„Ÿåˆ°ç„¦è™‘",assistant:"æ„Ÿåˆ°ç„¦è™‘æ˜¯å¾ˆè‡ªç„¶çš„ååº”ï¼Œè¿™è¡¨æ˜ä½ åœ¨ä¹è‡ªå·±çš„ç”Ÿæ´»å’Œæœªæ¥ã€‚èƒ½åˆ†äº«ä¸€ä¸‹æ˜¯ä»€ä¹ˆè®©ä½ æ„Ÿåˆ°ç„¦è™‘å—ï¼Ÿæœ‰æ—¶å€™æŠŠå®ƒä»¬è¯´å‡ºæ¥ï¼Œæˆ‘ä»¬å°±èƒ½ä¸€èµ·æ‰¾åˆ°åº”å¯¹çš„æ–¹æ³•ã€‚è®°ä½ï¼Œç…§é¡¾å¥½è‡ªå·±çš„æƒ…ç»ªä¹Ÿæ˜¯å¾ˆé‡è¦çš„äº‹æƒ…ã€‚"},{user:"æˆ‘æ„Ÿè§‰è‡ªå·±ä»€ä¹ˆéƒ½åšä¸å¥½",assistant:"è¿™ç§æ„Ÿè§‰æˆ‘èƒ½ç†è§£ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯¹è‡ªå·±çš„è¦æ±‚å¤ªé«˜äº†ã€‚ä½†è¯·ç›¸ä¿¡ï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸åŒçš„æ‰èƒ½å’Œä»·å€¼ã€‚ä½ æ„¿æ„å‘Šè¯‰æˆ‘ä¸€ä»¶æœ€è¿‘è®©ä½ æ„Ÿåˆ°å¼€å¿ƒæˆ–è‡ªè±ªçš„å°äº‹å—ï¼Ÿæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦é‡æ–°å‘ç°è‡ªå·±çš„é—ªå…‰ç‚¹ã€‚æ— è®ºå¦‚ä½•ï¼Œæˆ‘éƒ½æ¬£èµä½ çš„å¦è¯šå’Œè‡ªçœèƒ½åŠ›ã€‚"}]}},Ue={key:0,class:"fullscreen-call-container"},Xe={class:"call-header"},Le={class:"call-status"},qe={key:0,class:"status-text speaking"},Ne={key:1,class:"status-text recording"},Oe={key:2,class:"status-text"},He={class:"call-duration"},je={class:"call-avatar-container"},Ke={class:"call-avatar-wrapper"},Je={key:0,class:"call-speaking-indicator"},Qe={key:1,class:"call-recording-indicator"},Ge={key:0,class:"call-recognized-text"},Ye={class:"call-controls"},Ze={class:"icon"},et={class:"icon"},tt={key:0,class:"last-message-preview"},st={key:1,class:"voice-chat-content"},at={class:"avatar-section"},lt={key:0,class:"speaking-indicator"},nt={key:1,class:"recording-indicator"},ot={class:"voice-settings"},it={class:"settings-group"},ut={class:"settings-group"},rt={class:"checkbox-label"},ct={class:"settings-group"},dt={class:"checkbox-label"},vt={class:"settings-group"},pt={class:"checkbox-label"},gt={class:"settings-group"},ht={class:"voice-controls"},mt=["disabled"],ft={class:"icon"},yt={class:"messages-list"},kt={key:0,class:"typing-indicator-container"},bt={key:1,class:"recognized-text"},wt={class:"input-area"},Tt=["disabled"],St=["disabled"],_t={key:2,class:"browser-warning"},Et={key:0},Pt={key:1},Ct={key:3,class:"api-key-warning"},Mt=2e3,de=2e3,$t={__name:"VoiceChatView",props:{apikey:{type:String,required:!0}},setup(k){const o=k,e=u([]),v=u(""),l=u(!1),r=u(!1),a=u(!1),g=u(!1),m=u(null),f=u("neutral"),C=u(null),p=u(""),h=u(null),w=u(null),N=u(!0),S=u(!1),O=u(null),_=u({tts:!1,stt:!1}),x=u(!1),T=u(!1),P=u(null),U=u(Date.now()),H=u(!1),W=u(!1),X=u(null),j=u("00:00"),V=u(null),F=u("taiwan"),B=u("taiwanSister"),ee=u(Ae),te=u("");we(()=>{h.value=new xe,w.value=new ze,_.value={tts:h.value.ttsSupported,stt:h.value.sttSupported},h.value&&h.value.setVoiceProfile(F.value),ae(),se(),I()}),Te(()=>{h.value&&(h.value.stopSpeaking(),h.value.stopRecognition()),w.value&&w.value.stopSpeaking(),ne(),document.removeEventListener("keydown",J)});function M(){x.value||(x.value=!0,console.log("ç”¨æˆ·å·²äº¤äº’ï¼Œè¯­éŸ³åŠŸèƒ½å·²è§£é”"))}function se(){ee.value[B.value];let s="ä½ å¥½ï¼æˆ‘å¯ä»¥é€šè¿‡è¯­éŸ³å’Œä½ äº¤æµã€‚è¯·ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¼€å§‹å½•éŸ³ï¼Œæˆ–è€…ç›´æ¥è¾“å…¥æ–‡å­—ã€‚";B.value==="taiwanSister"&&(s="å“å‘€ï¼Œä½ å¥½å•Šï½æˆ‘æ˜¯ä½ çš„AIé‚»å±…å§å§ï¼Œè¶…å¼€å¿ƒè®¤è¯†ä½ çš„å•¦ï¼æœ‰ä»€ä¹ˆæƒ³èŠçš„ï¼Œæˆ–æ˜¯éœ€è¦æˆ‘å¸®å¿™çš„ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å–”ï¼"),e.value.push({role:"assistant",content:s})}function ve(){h.value&&h.value.setVoiceProfile(F.value)}function ae(){const s=ee.value[B.value];s&&(te.value=s.systemPrompt,e.value.length===0&&se())}async function L(){if(!v.value.trim()||a.value||!o.apikey)return;M(),e.value.push({role:"user",content:v.value}),v.value,v.value="",I(),a.value=!0,r.value=!0;let s={role:"assistant",content:""};e.value.push(s);const n=[{role:"system",content:te.value}];e.value.slice(0,-1).forEach(i=>{n.push({role:i.role,content:i.content})});try{const i=new XMLHttpRequest;i.open("POST","https://api.deepseek.com/chat/completions",!0),i.setRequestHeader("Authorization",`Bearer ${o.apikey}`),i.setRequestHeader("Content-Type","application/json");let R=0;i.onreadystatechange=function(){if(i.readyState===3||i.readyState===4){const Q=i.responseText,ke=Q.slice(R);R=Q.length;const be=ke.split(`
`);for(const oe of be)if(oe.startsWith("data: ")){const ie=oe.slice(6);if(ie==="[DONE]"){a.value=!1,r.value=!1,I(),pe(s.content),_.value.tts&&x.value&&T.value&&setTimeout(()=>{K(s.content,e.value.length-1)},300);return}try{const z=JSON.parse(ie);z.choices&&z.choices[0]?.delta?.content&&(s.content+=z.choices[0].delta.content,Me(I))}catch(z){console.error("è§£ææ•°æ®å‡ºé”™:",z)}}}i.readyState===4&&(i.status!==200&&(s.content="âŒ APIè°ƒç”¨å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ‚¨çš„APIå¯†é’¥æˆ–ç½‘ç»œè¿æ¥ã€‚",f.value="sad"),a.value=!1,r.value=!1,_.value.tts&&x.value&&T.value&&setTimeout(()=>{K(s.content,e.value.length-1)},300))},i.send(JSON.stringify({model:"deepseek-chat",messages:n,stream:!0}))}catch(i){console.error("APIè¯·æ±‚å‡ºé”™:",i),s.content="âŒ å‘é€è¯·æ±‚å‡ºé”™ï¼Œè¯·é‡è¯•ã€‚",f.value="sad",a.value=!1,r.value=!1}}function pe(s){s.includes("ğŸ˜Š")||s.includes("é«˜å…´")||s.includes("å¼€å¿ƒ")||s.includes("ç¬‘")?f.value="happy":s.includes("ğŸ˜¢")||s.includes("æŠ±æ­‰")||s.includes("é—æ†¾")?f.value="sad":s.includes("ğŸ˜®")||s.includes("å“‡")||s.includes("æƒŠè®¶")||s.includes("éœ‡æƒŠ")?f.value="surprised":s.includes("ğŸ¤”")||s.includes("æ€è€ƒ")||s.includes("å¤æ‚")||s.includes("åˆ†æ")?f.value="thinking":f.value="neutral"}function $(){if(!h.value||!_.value.stt){console.error("è¯­éŸ³æœåŠ¡ä¸å¯ç”¨æˆ–æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«");return}if(l.value){if(h.value.stopRecognition(),l.value=!1,p.value){const s=p.value;p.value="",v.value=s,L()}P.value&&(clearTimeout(P.value),P.value=null)}else{l.value=!0,p.value="",H.value=!1,U.value=Date.now();try{h.value.startRecognition(s=>{s&&s!==p.value&&(H.value=!0,U.value=Date.now(),P.value&&clearTimeout(P.value),S.value&&(P.value=setTimeout(()=>{p.value.trim()&&Date.now()-U.value>=de&&(console.log("æ£€æµ‹åˆ°ç”¨æˆ·åœæ­¢è¯´è¯ï¼Œè‡ªåŠ¨å‘é€è¯­éŸ³æ¶ˆæ¯"),$())},de))),p.value=s,I()},s=>{p.value=s,s&&(H.value=!0,U.value=Date.now())},s=>{console.error("è¯­éŸ³è¯†åˆ«é”™è¯¯:",s),l.value=!1,p.value="",P.value&&(clearTimeout(P.value),P.value=null),s.message&&s.message.includes("network")&&setTimeout(()=>{console.log("å°è¯•é‡æ–°è¿æ¥è¯­éŸ³è¯†åˆ«..."),W.value&&$()},2e3)})}catch(s){console.error("å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥:",s),l.value=!1}}}A(v,s=>{S.value&&s.trim()&&!l.value&&(O.value&&clearTimeout(O.value),O.value=setTimeout(()=>{v.value.trim()&&!a.value&&(console.log("ç”¨æˆ·åœæ­¢è¾“å…¥2ç§’ï¼Œè‡ªåŠ¨å‘é€æ¶ˆæ¯"),L())},Mt))});async function K(s,n){if(!(!h.value&&!w.value||!_.value.tts||m.value!==null)){M(),m.value=n,g.value=!0;try{const i=F.value;N.value&&["taiwan","taiwanSister","lively"].includes(i)?await w.value.speak(s,{preferredDialect:i==="taiwan"?"taiwan":"mainland",emotionIntensity:i==="taiwan"?1.5:1,enableTaiwaneseFeatures:i==="taiwan"||i==="taiwanSister"}):await h.value.speak(s),S.value&&!l.value&&x.value&&setTimeout(()=>{$()},500)}catch(i){console.error("è¯­éŸ³åˆæˆé”™è¯¯:",i),i.message&&i.message.includes("not-allowed")&&(console.warn("æµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼šéœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾è¯­éŸ³"),T.value=!1)}finally{m.value=null,g.value=!1}}}function ge(){g.value&&(h.value&&h.value.stopSpeaking(),w.value&&w.value.stopSpeaking(),m.value=null,g.value=!1)}function I(){setTimeout(()=>{C.value&&(C.value.scrollTop=C.value.scrollHeight)},100)}A(e,()=>{I()});function he(){S.value=!S.value,S.value?(T.value=!0,x.value?le():(M(),setTimeout(()=>{le()},100))):q()}function le(){console.log("è¿›å…¥å…¨å±é€šè¯æ¨¡å¼"),W.value=!0,me(),!l.value&&!g.value&&setTimeout(()=>{$()},500),document.addEventListener("keydown",J)}function q(){console.log("é€€å‡ºå…¨å±é€šè¯æ¨¡å¼"),W.value=!1,S.value=!1,ne(),l.value&&$(),document.removeEventListener("keydown",J)}function J(s){s.key==="Escape"&&W.value&&(S.value=!1,q())}function me(){X.value=Date.now(),j.value="00:00",V.value&&clearInterval(V.value),V.value=setInterval(()=>{fe()},1e3)}function ne(){V.value&&(clearInterval(V.value),V.value=null),X.value=null}function fe(){if(!X.value)return;const s=Math.floor((Date.now()-X.value)/1e3),n=Math.floor(s/60).toString().padStart(2,"0"),i=(s%60).toString().padStart(2,"0");j.value=`${n}:${i}`}function ye(){T.value=!T.value,M()}return(s,n)=>(c(),d("div",{class:"voice-chat-container",onClick:M},[W.value?(c(),d("div",Ue,[t("div",Xe,[t("div",Le,[g.value?(c(),d("span",qe,"å¯¹æ–¹æ­£åœ¨è¯´è¯...")):l.value?(c(),d("span",Ne,"æ­£åœ¨æ”¶å¬...")):(c(),d("span",Oe,"é€šè¯ä¸­"))]),t("div",He,b(j.value),1),t("button",{class:"exit-call-btn",onClick:q},n[6]||(n[6]=[t("span",null,"ç»“æŸé€šè¯",-1)]))]),t("div",je,[t("div",Ke,[g.value?(c(),d("div",Je)):y("",!0),l.value?(c(),d("div",Qe)):y("",!0),G(re,{emotion:f.value,speaking:g.value,isRecording:l.value},null,8,["emotion","speaking","isRecording"])]),n[7]||(n[7]=t("div",{class:"call-name"},"å°æ¹¾é‚»å±…å§å§",-1)),p.value?(c(),d("div",Ge," æ­£åœ¨è¯†åˆ«: "+b(p.value),1)):y("",!0)]),t("div",Ye,[t("button",{class:E(["call-control-btn mute-btn",{active:l.value}]),onClick:$},[t("span",Ze,b(l.value?"ğŸ¤":"ğŸ”‡"),1),t("span",null,b(l.value?"æ­£åœ¨æ”¶å¬":"å·²é™éŸ³"),1)],2),t("button",{class:"call-control-btn end-call-btn",onClick:q},n[8]||(n[8]=[t("span",{class:"icon"},"ğŸ“µ",-1),t("span",null,"ç»“æŸ",-1)])),t("button",{class:E(["call-control-btn speaker-btn",{active:T.value}]),onClick:ye},[t("span",et,b(T.value?"ğŸ”Š":"ğŸ”ˆ"),1),t("span",null,b(T.value?"æ‰¬å£°å™¨":"å¬ç­’"),1)],2)]),e.value.length>0?(c(),d("div",tt,[t("div",{class:E(["message-bubble",e.value[e.value.length-1].role])},b(e.value[e.value.length-1].content),3)])):y("",!0)])):(c(),d("div",st,[t("div",at,[g.value?(c(),d("div",lt)):y("",!0),l.value?(c(),d("div",nt)):y("",!0),G(re,{emotion:f.value,speaking:g.value,isRecording:l.value},null,8,["emotion","speaking","isRecording"]),t("div",ot,[t("div",it,[n[10]||(n[10]=t("label",null,"è¯­éŸ³é£æ ¼",-1)),D(t("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>F.value=i),onChange:ve},n[9]||(n[9]=[t("option",{value:"taiwan"},"å°æ¹¾è…”",-1)]),544),[[ue,F.value]])]),t("div",ut,[t("label",rt,[D(t("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=i=>N.value=i),onChange:M},null,544),[[Y,N.value]]),n[11]||(n[11]=t("span",null,"æƒ…æ„ŸåŒ–è¯­éŸ³",-1)),n[12]||(n[12]=t("span",{class:"tooltip",title:"æ ¹æ®æ–‡æœ¬å†…å®¹è‡ªåŠ¨è°ƒæ•´è¯­éŸ³çš„éŸ³è°ƒå’Œè¯­é€Ÿï¼Œå¢å¼ºæƒ…æ„Ÿè¡¨è¾¾"},"?",-1))])]),t("div",ct,[t("label",dt,[D(t("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=i=>T.value=i),onChange:M},null,544),[[Y,T.value]]),n[13]||(n[13]=t("span",null,"è‡ªåŠ¨æ’­æ”¾å›å¤",-1)),n[14]||(n[14]=t("span",{class:"tooltip",title:"éœ€è¦å…ˆä¸é¡µé¢äº¤äº’ï¼Œæµè§ˆå™¨æ‰å…è®¸è‡ªåŠ¨æ’­æ”¾è¯­éŸ³"},"?",-1))])]),t("div",vt,[t("label",pt,[D(t("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=i=>S.value=i),onChange:he},null,544),[[Y,S.value]]),n[15]||(n[15]=t("span",null,"æ‰“ç”µè¯æ¨¡å¼",-1)),n[16]||(n[16]=t("span",{class:"tooltip",title:"åœæ­¢è¯´è¯2ç§’åè‡ªåŠ¨å‘é€ï¼Œè¯­éŸ³æ’­æ”¾å®Œæˆåè‡ªåŠ¨å¼€å§‹å½•éŸ³"},"?",-1))])]),t("div",gt,[n[18]||(n[18]=t("label",null,"æ€§æ ¼é¢„è®¾",-1)),D(t("select",{"onUpdate:modelValue":n[4]||(n[4]=i=>B.value=i),onChange:ae},n[17]||(n[17]=[t("option",{value:"taiwanSister"},"å°æ¹¾é‚»å±…å§å§",-1)]),544),[[ue,B.value]])])]),t("div",ht,[t("button",{class:E(["voice-btn",{recording:l.value}]),onClick:$,disabled:!_.value.stt},[Se(b(l.value?"åœæ­¢å½•éŸ³":"å¼€å§‹å½•éŸ³")+" ",1),t("span",ft,b(l.value?"â¹ï¸":"ğŸ¤"),1)],10,mt)])]),t("div",{class:"messages-section",ref_key:"messagesContainer",ref:C},[t("div",yt,[(c(!0),d(_e,null,Ee(e.value,(i,R)=>(c(),$e(ce,{key:R,role:i.role,message:i.content,isPlaying:m.value===R,onPlay:Q=>K(i.content,R),onStop:ge},null,8,["role","message","isPlaying","onPlay"]))),128)),r.value?(c(),d("div",kt,[G(ce,{role:"assistant",message:"",isTyping:!0})])):y("",!0),p.value?(c(),d("div",bt," æ­£åœ¨è¯†åˆ«: "+b(p.value),1)):y("",!0)]),t("div",wt,[D(t("input",{type:"text","onUpdate:modelValue":n[5]||(n[5]=i=>v.value=i),placeholder:"è¾“å…¥æ–‡å­—æˆ–æŒ‰ä½éº¦å…‹é£å½•éŸ³...",onKeyup:Ce(L,["enter"]),disabled:a.value},null,40,Tt),[[Pe,v.value]]),t("button",{class:"send-btn",onClick:L,disabled:!v.value.trim()||a.value}," å‘é€ ",8,St)])],512)])),!_.value.stt||!_.value.tts?(c(),d("div",_t,[_.value.stt?y("",!0):(c(),d("p",Et,"âš ï¸ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½")),_.value.tts?y("",!0):(c(),d("p",Pt,"âš ï¸ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½"))])):y("",!0),o.apikey?y("",!0):(c(),d("div",Ct," è¯·åœ¨è®¾ç½®é¡µé¢é…ç½®APIå¯†é’¥ ")),n[19]||(n[19]=t("div",{class:"dev-badge"},"å¼€å‘ä¸­",-1))]))}},It=Z($t,[["__scopeId","data-v-8cbaaa92"]]);export{It as default};
