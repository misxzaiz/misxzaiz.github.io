<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/element.css" />
    <script src="js/vue@3.js"></script>
    <script src="js/element-plus.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="js/icon-element.js"></script>
    <script src="index.js"></script>
</head>

<body>
    
    <div id="app">
        <el-button @click="href('../nav/index.html')">返回</el-button>


        <el-collapse>
            <el-collapse-item title="测试说明" icon-position="right">
                <p>文档位置：<a href="../blog/index.html" target="_blank">点击查看</a></p></p>
                <p>代码位置：<a href="https://github.com/misxzaiz/misxzaiz.github.io/tree/main/demo/server/redis-demo" target="_blank">https://github.com/misxzaiz/misxzaiz.github.io/tree/main/demo/server/redis-demo</a></p>
            </el-collapse-item>
            <el-collapse-item title="登录测试" icon-position="right">
                <el-button @click="href('./pages/login/index.html')">登录</el-button>
                <el-button @click="logout()">注销</el-button>
                <el-button @click="testLoginIntercept()">测试登录</el-button>
            </el-collapse-item>
            <el-collapse-item title="缓存测试" icon-position="right">
                <p>缓存穿透：空值（√）、布隆过滤器</p>
                <p>缓存击穿：逻辑过期（√）、互斥锁</p>
                <p>缓存雪崩：随机 TTL、限流降级</p>
                <p>这里为了测试，空值和逻辑过期的过期时间只设置为10s</p>
                <el-button @click="getUserList()">获取所有用户id</el-button>
                <p>测试 id：
                    <span v-for="(item,index) in userList" :key="index"><br>{{item.id}}</span>
                </p>
                <input type="text" placeholder="输入用户 id" v-model="userId" style="width: 20%; margin-right: 3%;">
                <el-button @click="getUserByIdWithRedisLocalExpire()">获取用户信息</el-button>
                <div v-if="userForm!=null">
                    <div v-if="userForm.id!=null">id：{{userForm.id}}</div>
                    <div v-if="userForm.phone!=null">phone：{{userForm.phone}}</div>
                    <div v-if="userForm.email!=null">email：{{userForm.email}}</div>
                    <div v-if="userForm.nickName!=null">nickName：{{userForm.nickName}}</div>
                    <div v-if="userForm.icon!=null & userForm.icon!=''">icon：{{userForm.icon}}</div>
                </div>
            </el-collapse-item>
            <!-- <el-collapse-item title="优惠卷测试" icon-position="right">
                <el-button @click="href('./pages/coupons/index.html')">优惠卷测试</el-button>
            </el-collapse-item> -->
            <el-collapse-item title="文件测试" icon-position="right">
                <el-button @click="href('./pages/file/index.html')">文件</el-button>
            </el-collapse-item>
        </el-collapse>
    </div>

    <script>
        const App = {
            data() {
                return {
                    userId: null,
                    userForm: {},
                    userList: []
                }
            },
            methods: {
                href(url) {
                    window.location.href=url
                },
                testLoginIntercept(){
                    axios.get("/user/test/login/intercept")
                        .then(res => {
                            console.log(res);
                            this.$message.success(res.data.message)
                        })
                        .catch(err => {
                            console.log(err);
                            this.$message.error(err)
                        });
                },
                getUserByIdWithRedisLocalExpire() {
                    let that = this;
                    axios.get("/user/"+this.userId)
                        .then(res => {
                            if(!res.data.errorMsg){
                                this.$message.success(res.data.message)
                            }else {
                                this.$message.error(res.data.message)
                            }
                            that.userForm = res.data.data
                        })
                        .catch(err => {
                            console.log(err);
                            this.$message.error(err)
                        });
                },
                getUserList(){
                    let that = this;
                    axios.get("/user")
                        .then(res => {
                            that.userList = res.data.data
                        })
                        .catch(err => {
                            this.$message.error(err)
                        });
                },
                logout(){
                    let that = this;
                    axios.get("/user/logout")
                        .then(res => {
                            this.$message.success(res.data.message);
                            sessionStorage.removeItem("token");
                        })
                        .catch(err => {
                            this.$message.error(err)
                        });
                }
            },
            mounted() {

            }
        };
        const app = Vue.createApp(App);
        app.use(ElementPlus);
        app.mount("#app");

    </script>
</body>
</html>